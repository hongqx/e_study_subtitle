/*! estudysubtitle version1.1.0  2016-07-25  06:20:20*/
define(["jquery","peaks"],function(a,b){var c={},d=function(a){if(!orderedSegments.length)return a.pos=0,void orderedSegments.push(a);a.segmentId||(a.segmentId="b_"+(new Date).getTime());for(var b=0,c=orderedSegments.length;b<c&&a.startTime>orderedSegments[b].startTime;)b++;for(var d=c-1;d>=b;d--)orderedSegments[d+1]=orderedSegments[d],orderedSegments[d+1].pos=d+1;a.pos=b,orderedSegments[b]=a};return c.sortSegments=function(a){orderedSegments=[];for(var b=a.segments.getSegments(),c=0,e=b.length;c<e;c++){var f=b[c];d(f)}return orderedSegments},c.processSegments=function(a,b){for(var c=b.startTime,d=b.endTime,e=0,f=orderedSegments.length;e<f;e++){var g=orderedSegments[e],h="";if(orderedSegments[e+1]&&(h=orderedSegments[e+1]),c<g.endTime&&c>g.startTime)if(h&&d<h.endTime&&d>h.startTime){if(!confirm("是否删除前后两个片段？"))return!1;this.deleteSegment(a,g.segmentId),f--,this.deleteSegment(a,h.segmentId),f--}else{if(!confirm("是否删除前一个片段？"))return!1;this.deleteSegment(a,g.segmentId),f--}if(d<g.endTime&&d>g.startTime){if(!confirm("空白区域不足1s钟，是否删除后一个片段？"))return!1;this.deleteSegment(a,g.segmentId),f--}}return!0},c.addSegment=function(a,b){b||(b={startTime:a.time.getCurrentTime(),endTime:a.time.getCurrentTime()+1,editable:!0});var c=(b.startTime,b.endTime,a.segments.getSegments());this.processSegments(a,b)&&a.segments.add([b]);for(var d=0,e=c.length;d<e;d++)c[d].segmentId||(c[d].segmentId="b_"+(new Date).getTime());this.sortSegments(a),Control.subtitleAxis.addSubtitle()},c.deleteSegment=function(a,b){for(var c=a.segments.getSegments(),d=0,e=c.length;d<e;d++){var f=c[d];b===f.segmentId&&(a.segments.remove(f),this.sortSegments(a),e--)}},c.getNeighborSegment=function(a,b){b||(b=1);var c=a.pos+b;return c<0||c>=orderedSegments.length?"":orderedSegments[c]},c.moveSegment=function(a,b){a.segments.getSegments();this.sortSegments(a);var c=this.getNeighborSegment(b,-1),d=this.getNeighborSegment(b,1);if(c){if(b.startTime<=c.endTime)return b.zoom.inMarker.attrs.draggable=!1,!1;b.zoom.inMarker.attrs.draggable=!0}if(d){if(b.endTime>=d.startTime)return b.zoom.outMarker.attrs.draggable=!1,!1;b.zoom.outMarker.attrs.draggable=!0}return!0},c.draggSegment=function(a,b){this.moveSegment(a,b)&&Control.subtitleAxis.updateSubtitle(b)},c});