/*version 1.0*/
define(["jquery","peaks"],function(f,b){var e={};var c={getTime:function(h){var k="";var g=Math.floor(h/3600);var j=Math.floor(h/60);var i=Math.round(h%60*100)/100;if(g&&g<10){k="0"+g+":"}else{k=g+":"}if(j<10){k+="0"+j+":"}else{k+=j+":"}k+=i>=10?i:"0"+i;return k}};var d=function(l){var k={};var h=l.segments.getSegments();var m=h[h.length-1];var j=m.startTime;var i=m.endTime;var n="text_"+(m.id||"segment");k.textId=n;k.startTime=c.getTime(j);k.alltime=Math.round((i-j)*100)/100;k.wordsCount=0;var g=['<li class="active" data-pindex="29" data-index="29" id="{@textId}">','<div class="subtitle">','<div class="subspan">','<span class="start-time">{@startTime}</span>',"</div>",'<div class="sub-content">','<div class="txt">Koreanclass101.com Hanna Hanna Hangul</div>','<textarea name="" cols="30" rows="10" placeholder="edit..."></textarea>',"</div>",'<div class="subspan">','<span class="js_wps">{@wps}</span>','<span class="js_alltime">{@alltime}seconds</span>','<span class="js_wordsCount">0word</span>','<span class="delete-icon">——</span>',"</div>","</div>",'<div class="buttomline"></div>',"</li>"].join("");g=g.replace("{@startTime}",k.startTime).replace("{@alltime}",k.alltime).replace("{@textId}",k.textId).replace("{@wps}","0WPS");f("#contentList").prepend(g);globalSegments[n]=k;f("#"+n+" textarea").on("propertychange input",function(){var p=f(this).val().replace(/\s+$/,"").split(/\s+/).length;globalSegments[n].wordsCount=p;var q=globalSegments[n].alltime;var o=q?Math.round(p/q*100)/100:0;f(this).parent().parent().find(".js_wordsCount").html(p+"words");f(this).parent().parent().find(".js_wps").html(o+"WPS")}).blur(function(){localStorage.setItem("textId",f(this).val())})};var a=function(l){if(!orderedSegments.length){l.pos=0;orderedSegments.push(l);return}if(!l.segmentId){l.segmentId="b"+new Date().getTime()}var k=0,g=orderedSegments.length;while(k<g&&l.startTime>orderedSegments[k].startTime){k++}for(var h=g-1;h>=k;h--){orderedSegments[h+1]=orderedSegments[h];orderedSegments[h+1].pos=h+1}l.pos=k;orderedSegments[k]=l};e.sortSegments=function(j){orderedSegments=[];var h=j.segments.getSegments();for(var l=0,g=h.length;l<g;l++){var k=h[l];a(k)}return orderedSegments};e.processSegments=function(h,n){var m=n.startTime;var k=n.endTime;for(var l=0,g=orderedSegments.length;l<g;l++){var j=orderedSegments[l];var o="";if(orderedSegments[l+1]){o=orderedSegments[l+1]}if(m<j.endTime&&m>j.startTime){if(o&&k<o.endTime&&k>o.startTime){if(confirm("是否删除前后两个片段？")){this.deleteSegment(h,j.segmentId);g--;this.deleteSegment(h,o.segmentId);g--}else{return false}}else{if(confirm("是否删除前一个片段？")){this.deleteSegment(h,j.segmentId);g--}else{return false}}}if(k<j.endTime&&k>j.startTime){if(confirm("空白区域不足1s钟，是否删除后一个片段？")){this.deleteSegment(h,j.segmentId);g--}else{return false}}}return true};e.addSegment=function(j,n){if(!n){n={startTime:j.time.getCurrentTime(),endTime:j.time.getCurrentTime()+1,editable:true}}var m=n.startTime;var k=n.endTime;var h=j.segments.getSegments();if(this.processSegments(j,n)){j.segments.add([n])}for(var l=0,g=h.length;l<g;l++){if(!h[l].segmentId){h[l].segmentId="b"+new Date().getTime()}}this.sortSegments(j);Control.subtitleAxis.addSubtitle()};e.deleteSegment=function(j,l){var h=j.segments.getSegments();for(var m=0,g=h.length;m<g;m++){var k=h[m];if(l===k.segmentId){j.segments.remove(k);this.sortSegments(j);g--}}};e.getNeighborSegment=function(i,g){if(!g){g=1}var h=i.pos+g;if(h<0||h>=orderedSegments.length){return""}else{return orderedSegments[h]}};e.moveSegment=function(h,j){var g=h.segments.getSegments();this.sortSegments(h);var i=this.getNeighborSegment(j,-1);var k=this.getNeighborSegment(j,1);if(i){if(j.startTime<=i.endTime){j.zoom.inMarker.attrs.draggable=false;return false}j.zoom.inMarker.attrs.draggable=true}if(k){if(j.endTime>=k.startTime){j.zoom.outMarker.attrs.draggable=false;return false}j.zoom.outMarker.attrs.draggable=true}return true};e.draggSegment=function(g,h){if(this.moveSegment(g,h)){Control.subtitleAxis.updateSubtitle(h)}};return e});