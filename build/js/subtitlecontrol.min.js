/*! estudysubtitle version1.1.0  2016-08-01  05:17:04*/
function videoPlayer(a){this.containerId=a,this.startTime=0,this.options={autoPlay:!1,onDataError:null,onDataOk:null,onEnd:null,onUpdate:null}}function Course(){this.interUrl={courseUrl:"http://m.yxgapp.com/d/mooc/PutOpenCourseRecord.json",videoUrl:"http://m.yxgapp.com/d/mooc/GetVideo.json"},this.options={}}var LocalStorage={ifsupport:!!window.localStorage,setItem:function(a,b){try{window.localStorage.setItem(a,b)}catch(c){}},getItem:function(a){try{return window.localStorage.getItem(a)}catch(b){return null}},removeItem:function(a){try{window.localStorage.removeItem(a)}catch(b){}},checkStorage:function(a,b){},appendItem:function(a,b){try{var c=window.localStorage.getItem(a);if(!c)return void this.setItem(a,b);var d=c.length>0?c.split(","):[];if(d.length>2)for(var e=0;e<d.length-2;e++){var f=d.shift();f!==b&&(this.removeItem(f+"_subtitle"),this.removeItem(f+"_remainTitles"),this.removeItem(f+"_SUBTITLEAXIS"),this.removeItem(f+"_SUBTITLEAXIS_REMAIN"))}c=d.join(","),c.indexOf(b)<0&&d.push(b),window.localStorage.setItem(a,d.join(","))}catch(g){}}},Cookie={set:function(a,b,c){this.remove(a);var d="";if(c){var e=(new Date).getTime();e+=c,d=";expires="+new Date(e).toGMTString()}var f=";domain=yxgapp.com";document.cookie=a+"="+encodeURIComponent(b)+d+f},get:function(a){if(document.cookie.length>0){var b=document.cookie.indexOf(a+"=");if(b>-1){b=b+a.length+1;var c=document.cookie.indexOf(";",b);return c===-1&&(c=document.cookie.length),decodeURIComponent(document.cookie.substring(b,c))}}return""},remove:function(a){if(document.cookie.length>0)for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]===a){b.pop(c);break}}}};videoPlayer.init=function(a,b,c){var d=new videoPlayer(a);return d.data=c,d.container=$("#"+a),d.width=d.container.width(),d.height=9*d.width/16,d.container.height(d.height),d.video=d.container.find("video")[0],d.options=b,d.controlBtn=$(d.container).find(".play-btn")[0],d.trigger=$(d.container).find(".video-trigger")[0],d.mask=$(d.container).find(".video-mask")[0],d.startPlay=!1,$(d.video).attr("preload","auto"),d.startTime=0,d.endTime=0,d.initData(c),d},videoPlayer.prototype={changeVideo:function(a,b){this.dataIsok=!1,this.startPlay=!1,this.videoId=b,this.currentTime=0,this.totalTime=0,this.data=a},initData:function(a,b){a?this.dataIsok||(this.dataIsok=!0,this.data=a,this.options.onDataok&&this.options.onDataok(this.data),this.eventIfOk||(this.eventIfOk=!0,this.addEvent()),this.initPlayer(),b&&b(a)):this.options.onDataError&&this.options.onDataError(a)},initPlayer:function(){this.poster=document.createElement("img"),this.poster.src=this.data.coverUrl,$(this.video).after(this.poster),this.video.src=this.data.url,this.video.load(),$(this.video).show(),this.totalTime=this.data.durationHour,this.options.autoPlay&&this.video.play()},addEvent:function(){function a(a,b){var c=Array.prototype.slice.call(arguments).slice(2);return function(d){return b.apply(a,[d||window.event].concat(c))}}var b=this;$(this.controlBtn).on("click",function(){return b.play(),!1}),$(this.trigger).on("mouseenter",function(a){b.showControl()}),$(this.trigger).on("mouseleave",function(a){b.hideControl()}),$(this.trigger).on("click",function(){b.showControl()});var c={play:"onPlay",pause:"onPause",timeupdate:"onTimeUpdate",error:"onError",ended:"onEnded",seeking:"onSeeking",seeked:"onSeeked",waiting:"onWating"};for(var d in c){var e=a(this,this[c[d]]);$(this.video).on(d,e)}},hideControl:function(){this.startPlay&&!this.video.paused&&"none"!==$(this.controlBtn).css("display")&&($(this.controlBtn).fadeOut(),$(this.mask).fadeOut())},showControl:function(){this.startPlay&&($(this.controlBtn).fadeIn(),$(this.mask).fadeIn())},showLoading:function(){$(".loading")&&$(".loading").show()},hideLoading:function(){$(".loading")&&$(".loading").hide()},changeBtnState:function(a){a?($(this.trigger).removeClass("playbtn"),$(this.trigger).addClass("pausebtn")):($(this.trigger).addClass("playbtn"),$(this.trigger).removeClass("pausebtn"))},removeEvent:function(){},onPlay:function(){this.startPlay=!0,$(this.poster).fadeOut("slow"),this.changeBtnState(!0),this.hideControl()},onPlaying:function(){},onEnded:function(){this.showControl(),this.changeBtnState(!1),this.options.onEnd&&this.options.onEnd()},onPause:function(){this.changeBtnState(!1),this.showControl()},onWating:function(){this.showLoading()},onTimeUpdate:function(){this.hideLoading(),this.currentTime=this.video.currentTime,this.endTime&&this.endTime>0&&this.currentTime>=this.endTime&&(this.pause(),this.endTime=-1),this.options.onUpdate?this.options.onUpdate(this.video.currentTime):""},onError:function(){alert("the video play is error")},onSeeking:function(a){},onSeeked:function(a){this.showLoading()},play:function(){this.startPlay?this.video.paused?this.video.play():this.video.pause():(this.startTime>0&&(this.video.currentTime=this.startTime),this.video.play())},pause:function(){this.video.pause()},isPause:function(){return this.video.paused},seek:function(a,b){this.video.currentTime=a,b&&b(this.currentTime),this.video.play()},setStartTime:function(a){this.startTime=a},setPlayTime:function(a,b){this.video.currentTime=a;$(this.video).on("canPlay",function(){this.currentTime=a})}};var userInfo=function(){var a=Cookie.get("nickname"),b=Cookie.get("avatarUrl");return a&&$("#js_nickname").html(a),b&&$("#js_userpic").attr("src",b),{avatarUrl:Cookie.get("avatarUrl"),nickname:decodeURI(Cookie.get("nickname")),username:decodeURI(Cookie.get("userId")),token:Cookie.get("token"),videoId:Cookie.get("videoId"),courseId:Cookie.get("courseId"),language:Cookie.get("language"),action:Cookie.get("action")}};Course.init=function(a,b){var c=new Course;return c.options=a,c.data=b,c.videoData=null,c.courseData=null,c.getData(),c.player=null,c},Course.prototype={showLoadNote:function(a){$("#js_mask").show(),a&&$("#js_note .layui-layer-content").html(a),$("#js_note .layui-layer-btn").hide(),$("#js_note").show()},hideLoadNote:function(){$("#js_mask").hide(),$("#js_note").hide()},showErrorNote:function(a){this.hideLoadNote(),a=a?a:"登陆状态失效，请重新扫描二维码进行登录";var b="http://t.yxgapp.com/index.html";$("#js_mask").show();var c=$("#js_note .layui-layer-btn0");$("#js_note .layui-layer-content").html(a);c.html("前往扫描二维码"),c.attr("href",b),$("#js_note .layui-layer-btn").show(),$("#js_note").show(),window.tokenError=!0},getAjax:function(a,b,c,d){$.ajax({url:a,data:b,type:"GET",dataType:"json",context:this,success:function(a){c?this[c](a):console.log("get data success")},error:function(a){d?this[d](a):console.error(" get data error||"+a)}})},getData:function(){var a={username:this.options.username,token:this.options.token,courseId:this.options.courseId,command:"command_detail"};this.getAjax(this.interUrl.courseUrl,a,"courseCallback");var b={videoId:this.options.videoId,token:this.options.token,username:this.options.username};this.getAjax(this.interUrl.videoUrl,b,"videoInfoCallback")},courseCallback:function(a){a.result.result?(this.courseData=a.data,this.courseData.videoNumber>1?$("#js_coursetitle").html(this.courseData.name):$("#js_coursetitle").html(this.courseData.enName),this.showUniversity()):this.showErrorNote()},videoInfoCallback:function(a){a.result.result?(this.videoData=a.video,this.showVideoInfo(),this.createPLayer()):this.showErrorNote()},createPLayer:function(){var a={onStartPlay:null,onEnd:function(){},onError:null,onDataError:null,onPause:null,onDataok:function(a){},onUpdate:function(a){}};this.player=videoPlayer.init("video_container",a,this.videoData)},showUniversity:function(){if(this.courseData.joinNumber&&$("#js_joinCount").html(this.courseData.joinNumber+"次"),this.courseData.university||this.courseData.authors){if(this.courseData.university){var a=document.createElement("img");$(a).attr("src",this.courseData.university.iconUrl);var b=document.createElement("span");$(b).html(this.courseData.university.name);var c=$("#js_courseinfo .unit");c.append(a),c.append(b)}var d=document.createElement("div");$(d).attr("class","teacher-info");var e=$("#js_courseinfo .teacher"),f=document.createElement("img");if(this.courseData.authors.length>0){var g=this.courseData.authors[0];$(f).attr("src",g.iconUrl),$(d).html('<div class="name">'+g.name+'</div><div class="rank">'+g.jobTitle+"</div>"),e.append(f),e.append(d)}else $(d).html('<div style="margin:11px 0 0 4px;" class="name">迷你课</div>'),$(f).attr("src",this.courseData.marketCoverUrl),e.append(f),e.append(d)}else $("#js_courseInfo").hide()},showVideoInfo:function(a){$("#js_videotitle").html(this.videoData.name);var b=this.getTimeModel(this.videoData.durationHour);$("#js_totaltime").html(b)},getTimeModel:function(a){var b=a,c=parseInt(b/60),d=parseInt(c/60);return c=c>9?c:"0"+c,b%=60,_secondStr=b>9?b:"0"+b,d>0?d+":"+c+":"+_secondStr:c+":"+_secondStr},changePlayerTime:function(a,b){this.player&&this.player.setPlayTime(a,b)}};var Control;require(["subtitleAxis"],function(a){function b(){Control={};var b=userInfo(),c={courseId:b.courseId,videoId:b.videoId,token:b.token,username:b.username};Control.course=Course.init(c),Control.userInfo=b;var d={videoId:b.videoId,token:b.token,username:b.username,nickname:b.nickname,language:b.language,errorCallBack:Control.course.showErrorNote};return Control.subtitleAxis=a.init(d,"#subTitleDom"),Control}b()});