/*version 1.0*/
var LocalStorage={ifsupport:window.localStorage?true:false,setItem:function(a,b){try{window.localStorage.setItem(a,b)}catch(c){}},getItem:function(a){try{return window.localStorage.getItem(a)}catch(b){return null}},removeItem:function(a){try{window.localStorage.removeItem(a)}catch(b){}},checkStorage:function(a,b){},appendItem:function(d,g){try{var b=window.localStorage.getItem(d);if(!b){this.setItem(d,g);return}var a=b.length>0?b.split(","):[];if(a.length>2){for(var c=0;c<a.length-2;c++){var f=a.shift();if(f!==g){this.removeItem(f+"_subtitle");this.removeItem(f+"_remainTitles");this.removeItem(f+"_SUBTITLEAXIS");this.removeItem(f+"_SUBTITLEAXIS_REMAIN")}}}b=a.join(",");if(b.indexOf(g)<0){a.push(g)}window.localStorage.setItem(d,a.join(","))}catch(h){}}};var Cookie={set:function(d,e,b){this.remove(d);var c="";if(b){var f=new Date().getTime();f+=b;c=";expires="+new Date(f).toGMTString()}var a=";domain=yxgapp.com";document.cookie=d+"="+encodeURIComponent(e)+c+a},get:function(a){if(document.cookie.length>0){var b=document.cookie.indexOf(a+"=");if(b>-1){b=b+a.length+1;var c=document.cookie.indexOf(";",b);if(c===-1){c=document.cookie.length}return decodeURIComponent(document.cookie.substring(b,c))}}return""},remove:function(d){if(document.cookie.length>0){var a=document.cookie.split(";");for(var c=0;c<a.length;c++){var b=a[c].split("=");if(b[0]===d){a.pop(c);break}}}}};function videoPlayer(a){this.containerId=a;this.startTime=0;this.options={autoPlay:false,onDataError:null,onDataOk:null,onEnd:null,onUpdate:null}}videoPlayer.init=function(b,c,d){var a=new videoPlayer(b);a.data=d;a.container=$("#"+b);a.width=a.container.width();a.height=a.width*9/16;a.container.height(a.height);a.video=a.container.find("video")[0];a.options=c;a.controlBtn=$(a.container).find(".play-btn")[0];a.trigger=$(a.container).find(".video-trigger")[0];a.mask=$(a.container).find(".video-mask")[0];a.startPlay=false;$(a.video).attr("preload","auto");a.startTime=0;a.endTime=0;a.initData(d);return a};videoPlayer.prototype={changeVideo:function(a,b){this.dataIsok=false;this.startPlay=false;this.videoId=b;this.currentTime=0;this.totalTime=0;this.data=a},initData:function(a,b){if(!a){if(this.options.onDataError){this.options.onDataError(a)}}else{if(!this.dataIsok){this.dataIsok=true;this.data=a;if(this.options.onDataok){this.options.onDataok(this.data)}if(!this.eventIfOk){this.eventIfOk=true;this.addEvent()}this.initPlayer();if(b){b(a)}}}},initPlayer:function(){this.poster=document.createElement("img");this.poster.src=this.data.coverUrl;$(this.video).after(this.poster);this.video.src=this.data.url;this.video.load();$(this.video).show();this.totalTime=this.data.durationHour;if(this.options.autoPlay){this.video.play()}},addEvent:function(){var a=this;$(this.controlBtn).on("click",function(){a.play();return false});$(this.trigger).on("mouseenter",function(f){a.showControl()});$(this.trigger).on("mouseleave",function(f){a.hideControl()});$(this.trigger).on("click",function(){a.showControl()});var d={"play":"onPlay","pause":"onPause","timeupdate":"onTimeUpdate","error":"onError","ended":"onEnded","seeking":"onSeeking","seeked":"onSeeked","waiting":"onWating"};function e(h,f){var g=Array.prototype.slice.call(arguments).slice(2);return function(i){return f.apply(h,[i||window.event].concat(g))}}for(var b in d){var c=e(this,this[d[b]]);$(this.video).on(b,c)}},hideControl:function(){if(!this.startPlay||this.video.paused||$(this.controlBtn).css("display")==="none"){return}$(this.controlBtn).fadeOut();$(this.mask).fadeOut()},showControl:function(){if(this.startPlay){$(this.controlBtn).fadeIn();$(this.mask).fadeIn()}},showLoading:function(){if($(".loading")){$(".loading").show()}},hideLoading:function(){if($(".loading")){$(".loading").hide()}},changeBtnState:function(a){if(a){$(this.trigger).removeClass("playbtn");$(this.trigger).addClass("pausebtn")}else{$(this.trigger).addClass("playbtn");$(this.trigger).removeClass("pausebtn")}},removeEvent:function(){},onPlay:function(){this.startPlay=true;$(this.poster).fadeOut("slow");this.changeBtnState(true);this.hideControl()},onPlaying:function(){},onEnded:function(){this.showControl();this.changeBtnState(false);if(this.options.onEnd){this.options.onEnd()}},onPause:function(){this.changeBtnState(false);this.showControl()},onWating:function(){this.showLoading()},onTimeUpdate:function(){this.hideLoading();this.currentTime=this.video.currentTime;if(this.endTime&&this.endTime>0&&this.currentTime>=this.endTime){this.pause();this.endTime=-1}this.options.onUpdate?this.options.onUpdate(this.video.currentTime):""},onError:function(){alert("the video play is error")},onSeeking:function(a){},onSeeked:function(a){this.showLoading()},play:function(){if(!this.startPlay){if(this.startTime>0){this.video.currentTime=this.startTime}this.video.play()}else{if(this.video.paused){this.video.play()}else{this.video.pause()}}},pause:function(){this.video.pause()},isPause:function(){return this.video.paused},seek:function(a,b){this.video.currentTime=a;
if(b){b(this.currentTime)}this.video.play()},setStartTime:function(a){this.startTime=a},setPlayTime:function(b,c){this.video.currentTime=b;var a=this;$(this.video).on("canPlay",function(){this.currentTime=b})}};var userInfo=function(){var a=Cookie.get("nickname"),b=Cookie.get("avatarUrl");if(a){$("#js_nickname").html(a)}if(b){$("#js_userpic").attr("src",b)}return{avatarUrl:Cookie.get("avatarUrl"),nickname:decodeURI(Cookie.get("nickname")),username:decodeURI(Cookie.get("userId")),token:Cookie.get("token"),videoId:Cookie.get("videoId"),courseId:Cookie.get("courseId"),language:Cookie.get("language"),action:Cookie.get("action")}};function Course(){this.interUrl={courseUrl:"http://m.yxgapp.com/d/mooc/PutOpenCourseRecord.json",videoUrl:"http://m.yxgapp.com/d/mooc/GetVideo.json"};this.options={}}Course.init=function(b,c){var a=new Course();a.options=b;a.data=c;a.videoData=null;a.courseData=null;a.getData();a.player=null;return a};Course.prototype={showLoadNote:function(a){$("#js_mask").show();if(a){$("#js_note .layui-layer-content").html(a)}$("#js_note .layui-layer-btn").hide();$("#js_note").show()},hideLoadNote:function(){$("#js_mask").hide();$("#js_note").hide()},showErrorNote:function(d){this.hideLoadNote();d=d?d:"登陆状态失效，请重新扫描二维码进行登录";var b="http://t.yxgapp.com/index.html";$("#js_mask").show();var c=$("#js_note .layui-layer-btn0");var a=$("#js_note .layui-layer-content").html(d);c.html("前往扫描二维码");c.attr("href",b);$("#js_note .layui-layer-btn").show();$("#js_note").show();window.tokenError=true},getAjax:function(e,d,b,c){var a=this;$.ajax({url:e,data:d,type:"GET",dataType:"json",context:this,success:function(f){b?this[b](f):console.log("get data success")},error:function(f){c?this[c](f):console.error(" get data error||"+f)}})},getData:function(){var b=this;var a={username:this.options.username,token:this.options.token,courseId:this.options.courseId,command:"command_detail"};this.getAjax(this.interUrl.courseUrl,a,"courseCallback");var c={videoId:this.options.videoId,token:this.options.token,username:this.options.username};this.getAjax(this.interUrl.videoUrl,c,"videoInfoCallback")},courseCallback:function(a){if(!a.result.result){this.showErrorNote()}else{this.courseData=a.data;if(this.courseData.videoNumber>1){$("#js_coursetitle").html(this.courseData.name)}else{$("#js_coursetitle").html(this.courseData.enName)}this.showUniversity()}},videoInfoCallback:function(a){if(!a.result.result){this.showErrorNote()}else{this.videoData=a.video;this.showVideoInfo();this.createPLayer()}},createPLayer:function(){var a={onStartPlay:null,onEnd:function(){},onError:null,onDataError:null,onPause:null,onDataok:function(b){},onUpdate:function(b){}};this.player=videoPlayer.init("video_container",a,this.videoData)},showUniversity:function(){if(this.courseData.joinNumber){$("#js_joinCount").html(this.courseData.joinNumber+"次")}if(!this.courseData.university&&!this.courseData.authors){$("#js_courseInfo").hide()}else{if(this.courseData.university){var a=document.createElement("img");$(a).attr("src",this.courseData.university.iconUrl);var e=document.createElement("span");$(e).html(this.courseData.university.name);var c=$("#js_courseinfo .unit");c.append(a);c.append(e)}var d=document.createElement("div");$(d).attr("class","teacher-info");var g=$("#js_courseinfo .teacher");var b=document.createElement("img");if(this.courseData.authors.length>0){var f=this.courseData.authors[0];$(b).attr("src",f.iconUrl);$(d).html('<div class="name">'+f.name+'</div><div class="rank">'+f.jobTitle+"</div>");g.append(b);g.append(d)}else{$(d).html('<div style="margin:11px 0 0 4px;" class="name">迷你课</div>');$(b).attr("src",this.courseData.marketCoverUrl);g.append(b);g.append(d)}}},showVideoInfo:function(b){$("#js_videotitle").html(this.videoData.name);var a=this.getTimeModel(this.videoData.durationHour);$("#js_totaltime").html(a)},getTimeModel:function(c){var b=c;var a=parseInt(b/60);var d=parseInt(a/60);a=a>9?a:("0"+a);b=b%60;_secondStr=b>9?b:("0"+b);if(d>0){return d+":"+a+":"+_secondStr}else{return a+":"+_secondStr}},changePlayerTime:function(b,a){if(this.player){this.player.setPlayTime(b,a)}}};var Control;require(["jquery","segmentPart","subtitleAxis","mCustomScrollbar"],function(a,d,b,e){function c(){Control={};var f=userInfo();var g={courseId:f.courseId,videoId:f.videoId,token:f.token,username:f.username};Control.course=Course.init(g);Control.userInfo=f;var h={videoId:f.videoId,token:f.token,username:f.username,nickname:f.nickname,language:f.language,errorCallBack:Control.course.showErrorNote};Control.subtitleAxis=b.init(h,"#subTitleDom");return Control}c()});