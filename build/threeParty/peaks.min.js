/*
 MPL v1.1 [http://www.pixastic.com/lib/license.txt]
 @example
 node.cache();
 node.filters([Konva.Filters.Sepia]);
*/
(function(S){"object"===typeof exports&&"undefined"!==typeof module?module.exports=S():"function"===typeof define&&define.amd?define([],S):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).peaks=S()})(function(){return function t(w,x,q){function b(e,d){if(!x[e]){if(!w[e]){var c="function"==typeof require&&require;if(!d&&c)return c(e,!0);if(a)return a(e,!0);c=Error("Cannot find module '"+e+"'");throw c.code="MODULE_NOT_FOUND",c;}c=x[e]={exports:{}};
w[e][0].call(c.exports,function(c){var d=w[e][1][c];return b(d?d:c)},c,c.exports,t,w,x,q)}return x[e].exports}for(var a="function"==typeof require&&require,g=0;g<q.length;g++)b(q[g]);return b}({1:[function(t,w,x){},{}],2:[function(t,w,x){!function(q){function b(){this._events={};this._conf&&a.call(this,this._conf)}function a(c){c&&(this._conf=c,c.delimiter&&(this.delimiter=c.delimiter),c.maxListeners&&(this._events.maxListeners=c.maxListeners),c.wildcard&&(this.wildcard=c.wildcard),c.newListener&&
(this.newListener=c.newListener),this.wildcard&&(this.listenerTree={}))}function g(c){this._events={};this.newListener=!1;a.call(this,c)}function e(c,f,d,a){if(!d)return[];var g=[],b,n,p,v;p=f.length;v=f[a];var r=f[a+1];if(a===p&&d._listeners){if("function"===typeof d._listeners)c&&c.push(d._listeners);else for(f=0,a=d._listeners.length;f<a;f++)c&&c.push(d._listeners[f]);return[d]}if("*"===v||"**"===v||d[v]){if("*"===v){for(b in d)"_listeners"!==b&&d.hasOwnProperty(b)&&(g=g.concat(e(c,f,d[b],a+1)));
return g}if("**"===v){(v=a+1===p||a+2===p&&"*"===r)&&d._listeners&&(g=g.concat(e(c,f,d,p)));for(b in d)"_listeners"!==b&&d.hasOwnProperty(b)&&("*"===b||"**"===b?(d[b]._listeners&&!v&&(g=g.concat(e(c,f,d[b],p))),g=g.concat(e(c,f,d[b],a))):g=b===r?g.concat(e(c,f,d[b],a+2)):g.concat(e(c,f,d[b],a)));return g}g=g.concat(e(c,f,d[v],a+1))}(n=d["*"])&&e(c,f,n,a+1);if(d=d["**"])if(a<p)for(b in d._listeners&&e(c,f,d,p),d)"_listeners"!==b&&d.hasOwnProperty(b)&&(b===r?e(c,f,d[b],a+2):b===v?e(c,f,d[b],a+1):(p=
{},p[b]=d[b],e(c,f,{"**":p},a+1)));else d._listeners?e(c,f,d,p):d["*"]&&d["*"]._listeners&&e(c,f,d["*"],p);return g}var d=Array.isArray?Array.isArray:function(c){return"[object Array]"===Object.prototype.toString.call(c)};g.prototype.delimiter=".";g.prototype.setMaxListeners=function(c){this._events||b.call(this);this._events.maxListeners=c;this._conf||(this._conf={});this._conf.maxListeners=c};g.prototype.event="";g.prototype.once=function(c,d){this.many(c,1,d);return this};g.prototype.many=function(c,
d,a){function e(){0===--d&&g.off(c,e);a.apply(this,arguments)}var g=this;if("function"!==typeof a)throw Error("many only accepts instances of Function");e._origin=a;this.on(c,e);return g};g.prototype.emit=function(){this._events||b.call(this);var c=arguments[0];if("newListener"===c&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var d=arguments.length,a=Array(d-1),g=1;g<d;g++)a[g-1]=arguments[g];g=0;for(d=this._all.length;g<d;g++)this.event=c,this._all[g].apply(this,a)}if("error"===
c&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error)){if(arguments[1]instanceof Error)throw arguments[1];throw Error("Uncaught, unspecified 'error' event.");}var m;this.wildcard?(m=[],d="string"===typeof c?c.split(this.delimiter):c.slice(),e.call(this,m,d,this.listenerTree,0)):m=this._events[c];if("function"===typeof m){this.event=c;if(1===arguments.length)m.call(this);else if(1<arguments.length)switch(arguments.length){case 2:m.call(this,arguments[1]);break;case 3:m.call(this,
arguments[1],arguments[2]);break;default:d=arguments.length;a=Array(d-1);for(g=1;g<d;g++)a[g-1]=arguments[g];m.apply(this,a)}return!0}if(m){d=arguments.length;a=Array(d-1);for(g=1;g<d;g++)a[g-1]=arguments[g];m=m.slice();g=0;for(d=m.length;g<d;g++)this.event=c,m[g].apply(this,a);return 0<m.length||!!this._all}return!!this._all};g.prototype.on=function(c,a){if("function"===typeof c)return this.onAny(c),this;if("function"!==typeof a)throw Error("on only accepts instances of Function");this._events||
b.call(this);this.emit("newListener",c,a);if(this.wildcard){a:{for(var e=c,e="string"===typeof e?e.split(this.delimiter):e.slice(),g=0,m=e.length;g+1<m;g++)if("**"===e[g]&&"**"===e[g+1])break a;g=this.listenerTree;for(m=e.shift();m;){g[m]||(g[m]={});g=g[m];if(0===e.length){g._listeners?"function"===typeof g._listeners?g._listeners=[g._listeners,a]:d(g._listeners)&&(g._listeners.push(a),g._listeners.warned||(e=10,"undefined"!==typeof this._events.maxListeners&&(e=this._events.maxListeners),0<e&&g._listeners.length>
e&&(g._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",g._listeners.length),console.trace()))):g._listeners=a;break a}m=e.shift()}}return this}this._events[c]?"function"===typeof this._events[c]?this._events[c]=[this._events[c],a]:d(this._events[c])&&(this._events[c].push(a),this._events[c].warned||(e=10,"undefined"!==typeof this._events.maxListeners&&(e=this._events.maxListeners),
0<e&&this._events[c].length>e&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[c].length),console.trace()))):this._events[c]=a;return this};g.prototype.onAny=function(c){if("function"!==typeof c)throw Error("onAny only accepts instances of Function");this._all||(this._all=[]);this._all.push(c);return this};g.prototype.addListener=g.prototype.on;g.prototype.off=function(c,
a){if("function"!==typeof a)throw Error("removeListener only takes instances of Function");var g,b=[];if(this.wildcard)g="string"===typeof c?c.split(this.delimiter):c.slice(),b=e.call(this,null,g,this.listenerTree,0);else{if(!this._events[c])return this;g=this._events[c];b.push({_listeners:g})}for(var m=0;m<b.length;m++){var l=b[m];g=l._listeners;if(d(g)){for(var n=-1,p=0,v=g.length;p<v;p++)if(g[p]===a||g[p].listener&&g[p].listener===a||g[p]._origin&&g[p]._origin===a){n=p;break}if(!(0>n)){this.wildcard?
l._listeners.splice(n,1):this._events[c].splice(n,1);0===g.length&&(this.wildcard?delete l._listeners:delete this._events[c]);break}}else if(g===a||g.listener&&g.listener===a||g._origin&&g._origin===a)this.wildcard?delete l._listeners:delete this._events[c]}return this};g.prototype.offAny=function(c){var d=0,a=0,e;if(c&&this._all&&0<this._all.length)for(e=this._all,d=0,a=e.length;d<a;d++){if(c===e[d]){e.splice(d,1);break}}else this._all=[];return this};g.prototype.removeListener=g.prototype.off;g.prototype.removeAllListeners=
function(c){if(0===arguments.length)return!this._events||b.call(this),this;if(this.wildcard)for(var d="string"===typeof c?c.split(this.delimiter):c.slice(),d=e.call(this,null,d,this.listenerTree,0),a=0;a<d.length;a++)d[a]._listeners=null;else{if(!this._events[c])return this;this._events[c]=null}return this};g.prototype.listeners=function(c){if(this.wildcard){var a=[];c="string"===typeof c?c.split(this.delimiter):c.slice();e.call(this,a,c,this.listenerTree,0);return a}this._events||b.call(this);this._events[c]||
(this._events[c]=[]);d(this._events[c])||(this._events[c]=[this._events[c]]);return this._events[c]};g.prototype.listenersAny=function(){return this._all?this._all:[]};"object"===typeof x?x.EventEmitter2=g:window.EventEmitter2=g}()},{}],3:[function(t,w,x){(function(q){var b={};(function(a){var g=Math.PI/180;b={version:"0.9.5",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,
showWarnings:!0,Filters:{},isDragging:function(){var a=b.DD;return a?a.isDragging:!1},isDragReady:function(){var a=b.DD;return a?!!a.node:!1},_addId:function(a,d){void 0!==d&&(this.ids[d]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,d){d&&(this.names[d]||(this.names[d]=[]),this.names[d].push(a))},_removeName:function(a,d){if(a){var c=this.names[a];if(c){for(var f=0;f<c.length;f++)c[f]._id===d&&c.splice(f,1);0===c.length&&delete this.names[a]}}},getAngle:function(a){return this.angleDeg?
a*g:a},_parseUA:function(a){var d=a.toLowerCase(),d=/(chrome)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||0>d.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(d)||[],c=!!a.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);a=!!a.match(/IEMobile/i);return{browser:d[1]||"",version:d[2]||"0",mobile:c,ieMobile:a}},UA:void 0};b.UA=b._parseUA(a.navigator&&a.navigator.userAgent||"")})(this);(function(a,
g){if("object"===typeof x){var e=g();if(q.window&&q.window.document)b.document=q.window.document,b.window=q.window;else{var d=t("canvas"),c=t("jsdom").jsdom;b.document=c("<!DOCTYPE html><html><head></head><body></body></html>");b.window=b.document.parentWindow;b.window.Image=d.Image;b._nodeCanvas=d}b.root=a;w.exports=e}else b.document=document,b.window=window,b.root=a})(this,function(){return b});(function(){b.Collection=function(){var c=[].slice.call(arguments),d=c.length,a=0;for(this.length=d;a<
d;a++)this[a]=c[a];return this};b.Collection.prototype=[];b.Collection.prototype.each=function(c){for(var d=0;d<this.length;d++)c(this[d],d)};b.Collection.prototype.toArray=function(){var c=[],d=this.length,a;for(a=0;a<d;a++)c.push(this[a]);return c};b.Collection.toCollection=function(c){var d=new b.Collection,a=c.length,e;for(e=0;e<a;e++)d.push(c[e]);return d};b.Collection._mapMethod=function(c){b.Collection.prototype[c]=function(){var d=this.length,a,e=[].slice.call(arguments);for(a=0;a<d;a++)this[a][c].apply(this[a],
e);return this}};b.Collection.mapMethods=function(c){c=c.prototype;for(var d in c)b.Collection._mapMethod(d)};b.Transform=function(c){this.m=c&&c.slice()||[1,0,0,1,0,0]};b.Transform.prototype={copy:function(){return new b.Transform(this.m)},point:function(c){var d=this.m;return{x:d[0]*c.x+d[2]*c.y+d[4],y:d[1]*c.x+d[3]*c.y+d[5]}},translate:function(c,d){this.m[4]+=this.m[0]*c+this.m[2]*d;this.m[5]+=this.m[1]*c+this.m[3]*d;return this},scale:function(c,d){this.m[0]*=c;this.m[1]*=c;this.m[2]*=d;this.m[3]*=
d;return this},rotate:function(c){var d=Math.cos(c);c=Math.sin(c);var a=this.m[1]*d+this.m[3]*c,e=this.m[0]*-c+this.m[2]*d,g=this.m[1]*-c+this.m[3]*d;this.m[0]=this.m[0]*d+this.m[2]*c;this.m[1]=a;this.m[2]=e;this.m[3]=g;return this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(c,d){var a=this.m[1]+this.m[3]*d,e=this.m[2]+this.m[0]*c,g=this.m[3]+this.m[1]*c;this.m[0]+=this.m[2]*d;this.m[1]=a;this.m[2]=e;this.m[3]=g;return this},multiply:function(c){var d=this.m[1]*c.m[0]+
this.m[3]*c.m[1],a=this.m[0]*c.m[2]+this.m[2]*c.m[3],e=this.m[1]*c.m[2]+this.m[3]*c.m[3],g=this.m[0]*c.m[4]+this.m[2]*c.m[5]+this.m[4],b=this.m[1]*c.m[4]+this.m[3]*c.m[5]+this.m[5];this.m[0]=this.m[0]*c.m[0]+this.m[2]*c.m[1];this.m[1]=d;this.m[2]=a;this.m[3]=e;this.m[4]=g;this.m[5]=b;return this},invert:function(){var c=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),d=-this.m[1]*c,a=-this.m[2]*c,e=this.m[0]*c,g=c*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),b=c*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);
this.m[0]=this.m[3]*c;this.m[1]=d;this.m[2]=a;this.m[3]=e;this.m[4]=g;this.m[5]=b;return this},getMatrix:function(){return this.m},setAbsolutePosition:function(c,d){var a=this.m[0],e=this.m[1],g=this.m[2],b=this.m[4],e=(a*(d-this.m[5])-e*(c-b))/(a*this.m[3]-e*g);return this.translate((c-b-g*e)/a,e)}};var a=Math.PI/180,g=180/Math.PI,e={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,
0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,
140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,
165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,
182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,
209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,
160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,
191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;b.Util={_isElement:function(c){return!(!c||1!=c.nodeType)},_isFunction:function(c){return!!(c&&c.constructor&&c.call&&c.apply)},_isObject:function(c){return!!c&&c.constructor===Object},_isArray:function(c){return"[object Array]"===Object.prototype.toString.call(c)},
_isNumber:function(c){return"[object Number]"===Object.prototype.toString.call(c)},_isString:function(c){return"[object String]"===Object.prototype.toString.call(c)},_throttle:function(c,d,a){var e,g,b,n=null,p=0,v=a||{},r=function(){p=!1===v.leading?0:(new Date).getTime();n=null;b=c.apply(e,g);e=g=null};return function(){var a=(new Date).getTime();p||!1!==v.leading||(p=a);var h=d-(a-p);e=this;g=arguments;0>=h?(clearTimeout(n),n=null,p=a,b=c.apply(e,g),e=g=null):n||!1===v.trailing||(n=setTimeout(r,
h));return b}},_hasMethods:function(c){var d=[],a;for(a in c)this._isFunction(c[a])&&d.push(a);return 0<d.length},createCanvasElement:function(){var c=b.document.createElement("canvas");try{c.style=c.style||{}}catch(d){}return c},isBrowser:function(){return"object"!==typeof x},_isInDocument:function(c){for(;c=c.parentNode;)if(c==b.document)return!0;return!1},_simplifyArray:function(c){var d=[],a=c.length,e=b.Util,g,l;for(g=0;g<a;g++)l=c[g],e._isNumber(l)?l=Math.round(1E3*l)/1E3:e._isString(l)||(l=
l.toString()),d.push(l);return d},_getImage:function(c,d){var a,e;c?this._isElement(c)?d(c):this._isString(c)?(a=new b.window.Image,a.onload=function(){d(a)},a.src=c):c.data?(e=b.Util.createCanvasElement(),e.width=c.width,e.height=c.height,e.getContext("2d").putImageData(c,0,0),this._getImage(e.toDataURL(),d)):d(null):d(null)},_getRGBAString:function(c){return["rgba(",c.red||0,",",c.green||0,",",c.blue||0,",",c.alpha||1,")"].join("")},_rgbToHex:function(c,d,a){return(16777216+(c<<16)+(d<<8)+a).toString(16).slice(1)},
_hexToRgb:function(c){c=c.replace("#","");c=parseInt(c,16);return{r:c>>16&255,g:c>>8&255,b:c&255}},getRandomColor:function(){for(var c=(16777215*Math.random()<<0).toString(16);6>c.length;)c="0"+c;return"#"+c},get:function(c,d){return void 0===c?d:c},getRGB:function(c){return c in e?(c=e[c],{r:c[0],g:c[1],b:c[2]}):"#"===c[0]?this._hexToRgb(c.substring(1)):"rgb("===c.substr(0,4)?(c=d.exec(c.replace(/ /g,"")),{r:parseInt(c[1],10),g:parseInt(c[2],10),b:parseInt(c[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(c){c=
c||"black";return b.Util._namedColorToRBA(c)||b.Util._hex3ColorToRGBA(c)||b.Util._hex6ColorToRGBA(c)||b.Util._rgbColorToRGBA(c)||b.Util._rgbaColorToRGBA(c)},_namedColorToRBA:function(c){return(c=e[c.toLowerCase()])?{r:c[0],g:c[1],b:c[2],a:1}:null},_rgbColorToRGBA:function(c){if(0===c.indexOf("rgb("))return c=c.match(/rgb\(([^)]+)\)/)[1],c=c.split(/ *, */).map(Number),{r:c[0],g:c[1],b:c[2],a:1}},_rgbaColorToRGBA:function(c){if(0===c.indexOf("rgba("))return c=c.match(/rgba\(([^)]+)\)/)[1],c=c.split(/ *, */).map(Number),
{r:c[0],g:c[1],b:c[2],a:c[3]}},_hex6ColorToRGBA:function(c){if("#"===c[0]&&7===c.length)return{r:parseInt(c.slice(1,3),16),g:parseInt(c.slice(3,5),16),b:parseInt(c.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(c){if("#"===c[0]&&4===c.length)return{r:parseInt(c[1]+c[1],16),g:parseInt(c[2]+c[2],16),b:parseInt(c[3]+c[3],16),a:1}},_merge:function(c,d){var a=this._clone(d),e;for(e in c)this._isObject(c[e])?a[e]=this._merge(c[e],a[e]):a[e]=c[e];return a},cloneObject:function(c){var d={},a;for(a in c)this._isObject(c[a])?
d[a]=this.cloneObject(c[a]):this._isArray(c[a])?d[a]=this.cloneArray(c[a]):d[a]=c[a];return d},cloneArray:function(c){return c.slice(0)},_degToRad:function(c){return c*a},_radToDeg:function(c){return c*g},_capitalize:function(c){return c.charAt(0).toUpperCase()+c.slice(1)},throw:function(c){throw Error("Konva error: "+c);},error:function(c){console.error("Konva error: "+c)},warn:function(c){b.root.console&&console.warn&&b.showWarnings&&console.warn("Konva warning: "+c)},extend:function(c,d){function a(){this.constructor=
c}a.prototype=d.prototype;var e=c.prototype;c.prototype=new a;for(var g in e)e.hasOwnProperty(g)&&(c.prototype[g]=e[g]);c.__super__=d.prototype;c.super=d},addMethods:function(c,d){for(var a in d)c.prototype[a]=d[a]},_getControlPoints:function(c,d,a,e,g,b,n){var p=Math.sqrt(Math.pow(a-c,2)+Math.pow(e-d,2)),v=Math.sqrt(Math.pow(g-a,2)+Math.pow(b-e,2)),r=n*p/(p+v);n=n*v/(p+v);return[a-r*(g-c),e-r*(b-d),a+n*(g-c),e+n*(b-d)]},_expandPoints:function(c,d){var a=c.length,e=[],g,l;for(g=2;g<a-2;g+=2)l=b.Util._getControlPoints(c[g-
2],c[g-1],c[g],c[g+1],c[g+2],c[g+3],d),e.push(l[0]),e.push(l[1]),e.push(c[g]),e.push(c[g+1]),e.push(l[2]),e.push(l[3]);return e},_removeLastLetter:function(c){return c.substring(0,c.length-1)},each:function(c,d){for(var a in c)d(a,c[a])}}})();(function(){var a=b.Util.createCanvasElement().getContext("2d"),g=(b.window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1);b.Canvas=function(a){this.init(a)};
b.Canvas.prototype={init:function(a){this.pixelRatio=(a||{}).pixelRatio||b.pixelRatio||g;this._canvas=b.Util.createCanvasElement();this._canvas.style.padding=0;this._canvas.style.margin=0;this._canvas.style.border=0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){var d=this.pixelRatio;this.pixelRatio=
a;this.setSize(this.getWidth()/d,this.getHeight()/d)},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio;this._canvas.style.width=a+"px";a=this.pixelRatio;this.getContext()._context.scale(a,a)},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio;this._canvas.style.height=a+"px";a=this.pixelRatio;this.getContext()._context.scale(a,a)},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,d){this.setWidth(a);this.setHeight(d)},
toDataURL:function(a,d){try{return this._canvas.toDataURL(a,d)}catch(c){try{return this._canvas.toDataURL()}catch(g){return b.Util.warn("Unable to get data URL. "+g.message),""}}}};b.SceneCanvas=function(a){a=a||{};var d=a.width||0,c=a.height||0;b.Canvas.call(this,a);this.context=new b.SceneContext(this);this.setSize(d,c)};b.Util.extend(b.SceneCanvas,b.Canvas);b.HitCanvas=function(a){a=a||{};var d=a.width||0,c=a.height||0;b.Canvas.call(this,a);this.context=new b.HitContext(this);this.setSize(d,c);
this.hitCanvas=!0};b.Util.extend(b.HitCanvas,b.Canvas)})();(function(){var a="arc arcTo beginPath bezierCurveTo clearRect clip closePath createLinearGradient createPattern createRadialGradient drawImage fill fillText getImageData createImageData lineTo moveTo putImageData quadraticCurveTo rect restore rotate save scale setLineDash setTransform stroke strokeText transform translate".split(" ");b.Context=function(a){this.init(a)};b.Context.prototype={init:function(a){this.canvas=a;this._context=a._canvas.getContext("2d");
b.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){a.getFillEnabled()&&this._fill(a);a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(a){var e=this.traceArr,d=e.length,c="",f,h,k;for(f=0;f<d;f++)h=e[f],(k=h.method)?(h=h.args,c+=k,c=a?c+"()":b.Util._isArray(h[0])?c+("(["+h.join(",")+"])"):c+("("+h.join(",")+")")):(c+=h.property,a||(c+="="+h.val)),
c+=";";return c},clearTrace:function(){this.traceArr=[]},_trace:function(a){var e=this.traceArr;e.push(a);e.length>=b.traceArrMax&&e.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var e=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)},_applyLineCap:function(a){(a=a.getLineCap())&&this.setAttr("lineCap",
a)},_applyOpacity:function(a){a=a.getAbsoluteOpacity();1!==a&&this.setAttr("globalAlpha",a)},_applyLineJoin:function(a){(a=a.getLineJoin())&&this.setAttr("lineJoin",a)},setAttr:function(a,e){this._context[a]=e},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],
a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;if(2===a.length)return this._context.createImageData(a[0],a[1]);if(1===a.length)return this._context.createImageData(a[0])},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=
arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,e=this._context;3===a.length?e.drawImage(a[0],a[1],a[2]):5===a.length?e.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&e.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},isPointInPath:function(a,e){return this._context.isPointInPath(a,e)},fill:function(){this._context.fill()},fillRect:function(a,e,d,c){this._context.fillRect(a,e,d,c)},strokeRect:function(a,e,d,c){this._context.strokeRect(a,
e,d,c)},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},measureText:function(a){return this._context.measureText(a)},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],
a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){this._context.rotate(arguments[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,e=this._context;this._context.setLineDash?e.setLineDash(a[0]):"mozDash"in e?e.mozDash=a[0]:"webkitLineDash"in e&&(e.webkitLineDash=a[0])},getLineDash:function(){return this._context.getLineDash()},
setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var g=this,e=a.length,d=b.Util._simplifyArray,c=this.setAttr,f,h,k=function(a){var c=g[a],
e;g[a]=function(){h=d(Array.prototype.slice.call(arguments,0));e=c.apply(g,arguments);"clearRect"===a&&(h[2]/=g.canvas.getPixelRatio(),h[3]/=g.canvas.getPixelRatio());g._trace({method:a,args:h});return e}};for(f=0;f<e;f++)k(a[f]);g.setAttr=function(){c.apply(g,arguments);g._trace({property:arguments[0],val:arguments[1]})}}};"fillStyle strokeStyle shadowColor shadowBlur shadowOffsetX shadowOffsetY lineCap lineJoin lineWidth miterLimit font textAlign textBaseline globalAlpha globalCompositeOperation".split(" ").forEach(function(a){Object.defineProperty(b.Context.prototype,
a,{get:function(){return this._context[a]},set:function(e){this._context[a]=e}})});b.SceneContext=function(a){b.Context.call(this,a)};b.SceneContext.prototype={_fillColor:function(a){var e=a.fill();this.setAttr("fillStyle",e);a._fillFunc(this)},_fillPattern:function(a){var e=a.getFillPatternX(),d=a.getFillPatternY(),c=a.getFillPatternScale(),f=b.getAngle(a.getFillPatternRotation()),h=a.getFillPatternOffset();(e||d)&&this.translate(e||0,d||0);f&&this.rotate(f);c&&this.scale(c.x,c.y);h&&this.translate(-1*
h.x,-1*h.y);this.setAttr("fillStyle",this.createPattern(a.getFillPatternImage(),a.getFillPatternRepeat()||"repeat"));this.fill()},_fillLinearGradient:function(a){var e=a.getFillLinearGradientStartPoint(),d=a.getFillLinearGradientEndPoint(),c=a.getFillLinearGradientColorStops(),e=this.createLinearGradient(e.x,e.y,d.x,d.y);if(c){for(d=0;d<c.length;d+=2)e.addColorStop(c[d],c[d+1]);this.setAttr("fillStyle",e);a._fillFunc(this)}},_fillRadialGradient:function(a){var e=a.getFillRadialGradientStartPoint(),
d=a.getFillRadialGradientEndPoint(),c=a.getFillRadialGradientStartRadius(),f=a.getFillRadialGradientEndRadius();a=a.getFillRadialGradientColorStops();e=this.createRadialGradient(e.x,e.y,c,d.x,d.y,f);for(d=0;d<a.length;d+=2)e.addColorStop(a[d],a[d+1]);this.setAttr("fillStyle",e);this.fill()},_fill:function(a){var e=a.fill(),d=a.getFillPatternImage(),c=a.getFillLinearGradientColorStops(),f=a.getFillRadialGradientColorStops(),h=a.getFillPriority();e&&"color"===h?this._fillColor(a):d&&"pattern"===h?this._fillPattern(a):
c&&"linear-gradient"===h?this._fillLinearGradient(a):f&&"radial-gradient"===h?this._fillRadialGradient(a):e?this._fillColor(a):d?this._fillPattern(a):c?this._fillLinearGradient(a):f&&this._fillRadialGradient(a)},_stroke:function(a){var e=a.dash(),d=a.getStrokeScaleEnabled()||a instanceof b.Text;a.hasStroke()&&(d||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),e&&a.dashEnabled()&&this.setLineDash(e),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()),
a.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),a._strokeFunc(this),d||this.restore())},_applyShadow:function(a){var e=b.Util,d=e.get(a.getShadowRGBA(),"black"),c=e.get(a.getShadowBlur(),5),e=e.get(a.getShadowOffset(),{x:0,y:0}),f=a.getAbsoluteTransform().m;a=f[0];f=f[3];this.setAttr("shadowColor",d);this.setAttr("shadowBlur",c);this.setAttr("shadowOffsetX",e.x*a);this.setAttr("shadowOffsetY",e.y*f)}};b.Util.extend(b.SceneContext,b.Context);b.HitContext=function(a){b.Context.call(this,
a)};b.HitContext.prototype={_fill:function(a){this.save();this.setAttr("fillStyle",a.colorKey);a._fillFuncHit(this);this.restore()},_stroke:function(a){if(a.hasStroke()&&a.strokeHitEnabled()){var e=a.getStrokeScaleEnabled()||a instanceof b.Text;e||(this.save(),this.setTransform(1,0,0,1,0,0));this._applyLineCap(a);this.setAttr("lineWidth",a.strokeWidth());this.setAttr("strokeStyle",a.colorKey);a._strokeFuncHit(this);e||this.restore()}}};b.Util.extend(b.HitContext,b.Context)})();(function(){b.Factory=
{addGetterSetter:function(a,b,e,d,c){this.addGetter(a,b,e);this.addSetter(a,b,d,c);this.addOverloadedGetterSetter(a,b)},addGetter:function(a,g,e){var d="get"+b.Util._capitalize(g);a.prototype[d]=function(){var a=this.attrs[g];return void 0===a?e:a}},addSetter:function(a,g,e,d){var c="set"+b.Util._capitalize(g);a.prototype[c]=function(a){e&&(a=e.call(this,a));this._setAttr(g,a);d&&d.call(this);return this}},addComponentsGetterSetter:function(a,g,e,d,c){var f=e.length,h=b.Util._capitalize,k="get"+h(g),
m="set"+h(g),l,n;a.prototype[k]=function(){var a={};for(l=0;l<f;l++)n=e[l],a[n]=this.getAttr(g+h(n));return a};a.prototype[m]=function(a){var e=this.attrs[g],f;d&&(a=d.call(this,a));for(f in a)this._setAttr(g+h(f),a[f]);this._fireChangeEvent(g,e,a);c&&c.call(this);return this};this.addOverloadedGetterSetter(a,g)},addOverloadedGetterSetter:function(a,g){var e=b.Util._capitalize(g),d="set"+e,c="get"+e;a.prototype[g]=function(){return arguments.length?(this[d](arguments[0]),this):this[c]()}},addDeprecatedGetterSetter:function(a,
g,e,d){var c="get"+b.Util._capitalize(g),f=g+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[c]=function(){b.Util.error(f);var a=this.attrs[g];return void 0===a?e:a};this.addSetter(a,g,d,function(){b.Util.error(f)});this.addOverloadedGetterSetter(a,g)},backCompat:function(a,g){b.Util.each(g,function(e,d){var c=a.prototype[d];a.prototype[e]=function(){c.apply(this,arguments);b.Util.error(e+" method is deprecated and will be removed soon. Use "+
d+" instead")}})},afterSetFilter:function(){this._filterUpToDate=!1}};b.Validators={RGBComponent:function(a){return 255<a?255:0>a?0:Math.round(a)},alphaComponent:function(a){return 1<a?1:1E-4>a?1E-4:a}}})();(function(a){var b=["id"];a.Node=function(a){this._init(a)};a.Util.addMethods(a.Node,{_init:function(e){var d=this;this._id=a.idCounter++;this.eventListeners={};this.attrs={};this._cache={};this._filterUpToDate=!1;this.setAttrs(e);this.on("xChange.konva yChange.konva scaleXChange.konva scaleYChange.konva skewXChange.konva skewYChange.konva rotationChange.konva offsetXChange.konva offsetYChange.konva transformsEnabledChange.konva",
function(){this._clearCache("transform");d._clearSelfAndDescendantCache("absoluteTransform")});this.on("visibleChange.konva",function(){d._clearSelfAndDescendantCache("visible")});this.on("listeningChange.konva",function(){d._clearSelfAndDescendantCache("listening")});this.on("opacityChange.konva",function(){d._clearSelfAndDescendantCache("absoluteOpacity")})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,d){void 0===this._cache[a]&&(this._cache[a]=d.call(this));
return this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a);this.children&&this.getChildren().each(function(d){d._clearSelfAndDescendantCache(a)})},clearCache:function(){delete this._cache.canvas;this._filterUpToDate=!1;return this},cache:function(e){var d=e||{},c=this.getClientRect(!0);e=d.width||c.width;var f=d.height||c.height,h=d.x||c.x,c=d.y||c.y,b=d.offset||0,d=d.drawBorder||!1;if(!e||!f)throw Error("Width or height of caching configuration equals 0.");e+=2*b;var f=f+
2*b,h=h-b,c=c-b,b=new a.SceneCanvas({width:e,height:f}),g=new a.SceneCanvas({width:e,height:f}),l=new a.HitCanvas({pixelRatio:1,width:e,height:f}),n=b.getContext(),p=l.getContext();l.isCache=!0;this.clearCache();n.save();p.save();n.translate(-h,-c);p.translate(-h,-c);this.drawScene(b,this,!0);this.drawHit(l,this,!0);n.restore();p.restore();d&&(n.save(),n.beginPath(),n.rect(0,0,e,f),n.closePath(),n.setAttr("strokeStyle","red"),n.setAttr("lineWidth",5),n.stroke(),n.restore());this._cache.canvas={scene:b,
filter:g,hit:l,x:h,y:c};return this},getClientRect:function(){throw'abstract "getClientRect" method call';},_transformedRect:function(a){a=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}];var d,c,f,h,b=this.getTransform();a.forEach(function(a){a=b.point(a);void 0===d&&(d=f=a.x,c=h=a.y);d=Math.min(d,a.x);c=Math.min(c,a.y);f=Math.max(f,a.x);h=Math.max(h,a.y)});return{x:Math.round(d),y:Math.round(c),width:Math.round(f-d),height:Math.round(h-c)}},_drawCachedSceneCanvas:function(a){a.save();
a._applyOpacity(this);a.translate(this._cache.canvas.x,this._cache.canvas.y);var d=this._getCachedSceneCanvas(),c=d.pixelRatio;a.drawImage(d._canvas,0,0,d.width/c,d.height/c);a.restore()},_drawCachedHitCanvas:function(a){var d=this._cache.canvas.hit;a.save();a.translate(this._cache.canvas.x,this._cache.canvas.y);a.drawImage(d._canvas,0,0);a.restore()},_getCachedSceneCanvas:function(){var e=this.filters(),d=this._cache.canvas,c=d.scene,d=d.filter,f=d.getContext(),h,b,g,l;if(e){if(!this._filterUpToDate){var n=
c.pixelRatio;try{for(h=e.length,f.clear(),f.drawImage(c._canvas,0,0,c.getWidth()/n,c.getHeight()/n),b=f.getImageData(0,0,d.getWidth(),d.getHeight()),g=0;g<h;g++)l=e[g],l.call(this,b),f.putImageData(b,0,0)}catch(p){a.Util.warn("Unable to apply filter. "+p.message)}this._filterUpToDate=!0}return d}return c},on:function(a,d){var c=a.split(" "),f=c.length,h,b,g;for(h=0;h<f;h++)b=c[h],g=b.split("."),b=g[0],g=g[1]||"",this.eventListeners[b]||(this.eventListeners[b]=[]),this.eventListeners[b].push({name:g,
handler:d});return this},off:function(a){var d=(a||"").split(" "),c=d.length,f,b,g;if(!a)for(f in this.eventListeners)this._off(f);for(a=0;a<c;a++)if(b=d[a],g=b.split("."),b=g[0],g=g[1],b)this.eventListeners[b]&&this._off(b,g);else for(f in this.eventListeners)this._off(f,g);return this},dispatchEvent:function(a){this.fire(a.type,{target:this,type:a.type,evt:a})},addEventListener:function(a,d){this.on(a,function(a){d.call(this,a.evt)})},removeEventListener:function(a){this.off(a)},remove:function(){var a=
this.getParent();a&&a.children&&(a.children.splice(this.index,1),a._setChildrenIndices(),delete this.parent);this._clearSelfAndDescendantCache("stage");this._clearSelfAndDescendantCache("absoluteTransform");this._clearSelfAndDescendantCache("visible");this._clearSelfAndDescendantCache("listening");this._clearSelfAndDescendantCache("absoluteOpacity");return this},destroy:function(){a._removeId(this.getId());a._removeName(this.getName(),this._id);this.remove()},getAttr:function(e){var d="get"+a.Util._capitalize(e);
return a.Util._isFunction(this[d])?this[d]():this.attrs[e]},getAncestors:function(){for(var e=this.getParent(),d=new a.Collection;e;)d.push(e),e=e.getParent();return d},getAttrs:function(){return this.attrs||{}},setAttrs:function(e){var d,c;if(!e)return this;for(d in e)if("children"!==d)if(c="set"+a.Util._capitalize(d),a.Util._isFunction(this[c]))this[c](e[d]);else this._setAttr(d,e[d]);return this},isListening:function(){return this._getCache("listening",this._isListening)},_isListening:function(){var a=
this.getListening(),d=this.getParent();return"inherit"===a?d?d.isListening():!0:a},isVisible:function(){return this._getCache("visible",this._isVisible)},_isVisible:function(){var a=this.getVisible(),d=this.getParent();return"inherit"===a?d?d.isVisible():!0:a},shouldDrawHit:function(a){var d=this.getLayer();return a&&a.isCache||d&&d.hitGraphEnabled()&&this.isListening()&&this.isVisible()},show:function(){this.setVisible(!0);return this},hide:function(){this.setVisible(!1);return this},getZIndex:function(){return this.index||
0},getAbsoluteZIndex:function(){function a(n){b=[];g=n.length;for(m=0;m<g;m++)l=n[m],f++,"Shape"!==l.nodeType&&(b=b.concat(l.getChildren().toArray())),l._id===c._id&&(m=g);0<b.length&&b[0].getDepth()<=d&&a(b)}var d=this.getDepth(),c=this,f=0,b,g,m,l;"Stage"!==c.nodeType&&a(c.getStage().getChildren());return f},getDepth:function(){for(var a=0,d=this.parent;d;)a++,d=d.parent;return a},setPosition:function(a){this.setX(a.x);this.setY(a.y);return this},getPosition:function(){return{x:this.getX(),y:this.getY()}},
getAbsolutePosition:function(){var e=this.getAbsoluteTransform().getMatrix(),d=new a.Transform,c=this.offset();d.m=e.slice();d.translate(c.x,c.y);return d.getTranslation()},setAbsolutePosition:function(a){if(a){var d=this._clearTransform(),c;this.attrs.x=d.x;this.attrs.y=d.y;delete d.x;delete d.y;c=this.getAbsoluteTransform();c.invert();c.translate(a.x,a.y);a={x:this.attrs.x+c.getTranslation().x,y:this.attrs.y+c.getTranslation().y};this.setPosition({x:a.x,y:a.y});this._setTransform(d);return this}},
_setTransform:function(a){for(var d in a)this.attrs[d]=a[d];this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform")},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=
0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform");return a},move:function(a){var d=a.x;a=a.y;var c=this.getX(),f=this.getY();void 0!==d&&(c+=d);void 0!==a&&(f+=a);this.setPosition({x:c,y:f});return this},_eachAncestorReverse:function(a,d){var c=[],f=this.getParent(),b;if(d&&d._id===this._id)return a(this),!0;for(c.unshift(this);f&&(!d||f._id!==d._id);)c.unshift(f),f=f.parent;f=c.length;for(b=0;b<f;b++)a(c[b])},rotate:function(a){this.setRotation(this.getRotation()+
a);return this},moveToTop:function(){if(!this.parent)return a.Util.warn("Node has no parent. moveToTop function is ignored."),!1;this.parent.children.splice(this.index,1);this.parent.children.push(this);this.parent._setChildrenIndices();return!0},moveUp:function(){if(!this.parent)return a.Util.warn("Node has no parent. moveUp function is ignored."),!1;var e=this.index,d=this.parent.getChildren().length;return e<d-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),
!0):!1},moveDown:function(){if(!this.parent)return a.Util.warn("Node has no parent. moveDown function is ignored."),!1;var e=this.index;return 0<e?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){if(!this.parent)return a.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var e=this.index;return 0<e?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),
!0):!1},setZIndex:function(e){if(!this.parent)return a.Util.warn("Node has no parent. zIndex parameter is ignored."),!1;this.parent.children.splice(this.index,1);this.parent.children.splice(e,0,this);this.parent._setChildrenIndices();return this},getAbsoluteOpacity:function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();this.getParent()&&(a*=this.getParent().getAbsoluteOpacity());return a},moveTo:function(a){this.getParent()!==
a&&(this.remove(),a.add(this));return this},toObject:function(){var e={},d=this.getAttrs(),c,f,b;e.attrs={};for(c in d)f=d[c],a.Util._isFunction(f)||a.Util._isElement(f)||a.Util._isObject(f)||a.Util._hasMethods(f)||(b=this[c],delete d[c],b=b?b.call(this):null,d[c]=f,b!==f&&(e.attrs[c]=f));e.className=this.getClassName();return e},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();return a?a.getLayer():null},
getStage:function(){return this._getCache("stage",this._getStage)},_getStage:function(){var a=this.getParent();if(a)return a.getStage()},fire:function(a,d,c){c?this._fireAndBubble(a,d||{}):this._fire(a,d||{});return this},getAbsoluteTransform:function(a){return a?this._getAbsoluteTransform(a):this._getCache("absoluteTransform",this._getAbsoluteTransform)},_getAbsoluteTransform:function(e){var d=new a.Transform,c,f;this._eachAncestorReverse(function(a){c=a.transformsEnabled();f=a.getTransform();"all"===
c?d.multiply(f):"position"===c&&d.translate(a.x(),a.y())},e);return d},getTransform:function(){return this._getCache("transform",this._getTransform)},_getTransform:function(){var e=new a.Transform,d=this.getX(),c=this.getY(),f=a.getAngle(this.getRotation()),b=this.getScaleX(),g=this.getScaleY(),m=this.getSkewX(),l=this.getSkewY(),n=this.getOffsetX(),p=this.getOffsetY();0===d&&0===c||e.translate(d,c);0!==f&&e.rotate(f);0===m&&0===l||e.skew(m,l);1===b&&1===g||e.scale(b,g);0===n&&0===p||e.translate(-1*
n,-1*p);return e},clone:function(e){var d=a.Util.cloneObject(this.attrs),c,f,h;for(f in b)delete d[b[f]];for(c in e)d[c]=e[c];var k=new this.constructor(d);for(c in this.eventListeners)for(e=this.eventListeners[c],d=e.length,f=0;f<d;f++)h=e[f],0>h.name.indexOf("konva")&&(k.eventListeners[c]||(k.eventListeners[c]=[]),k.eventListeners[c].push(h));return k},toDataURL:function(e){e=e||{};var d=e.mimeType||null,c=e.quality||null,f=this.getStage(),b=e.x||0,g=e.y||0,m=e.pixelRatio||1;e=new a.SceneCanvas({width:e.width||
this.getWidth()||(f?f.getWidth():0),height:e.height||this.getHeight()||(f?f.getHeight():0),pixelRatio:m});f=e.getContext();f.save();(b||g)&&f.translate(-1*b,-1*g);this.drawScene(e);f.restore();return e.toDataURL(d,c)},toImage:function(e){if(!e||!e.callback)throw"callback required for toImage method config argument";a.Util._getImage(this.toDataURL(e),function(a){e.callback(a)})},setSize:function(a){this.setWidth(a.width);this.setHeight(a.height);return this},getSize:function(){return{width:this.getWidth(),
height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():a.dragDistance},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},_off:function(a,d){var c=this.eventListeners[a],f,b;
for(f=0;f<c.length;f++)if(b=c[f].name,!("konva"===b&&"konva"!==d||d&&b!==d)){c.splice(f,1);if(0===c.length){delete this.eventListeners[a];break}f--}},_fireChangeEvent:function(a,d,c){this._fire(a+"Change",{oldVal:d,newVal:c})},setId:function(e){var d=this.getId();a._removeId(d);a._addId(this,e);this._setAttr("id",e);return this},setName:function(e){var d=(this.getName()||"").split(/\s/g),c=(e||"").split(/\s/g),f,b;for(b=0;b<d.length;b++)f=d[b],-1===c.indexOf(f)&&f&&a._removeName(f,this._id);for(b=
0;b<c.length;b++)f=c[b],-1===d.indexOf(f)&&f&&a._addName(this,f);this._setAttr("name",e);return this},addName:function(a){if(!this.hasName(a)){var d=this.name();this.setName(d?d+" "+a:a)}return this},hasName:function(a){return-1!==(this.name()||"").split(/\s/g).indexOf(a)},removeName:function(a){var d=(this.name()||"").split(/\s/g);a=d.indexOf(a);-1!==a&&(d.splice(a,1),this.setName(d.join(" ")))},setAttr:function(b,d){var c=this["set"+a.Util._capitalize(b)];a.Util._isFunction(c)?c.call(this,d):this._setAttr(b,
d);return this},_setAttr:function(a,d){var c;void 0!==d&&(c=this.attrs[a],this.attrs[a]=d,this._fireChangeEvent(a,c,d))},_setComponentAttr:function(a,d,c){var f;void 0!==c&&((f=this.attrs[a])||(this.attrs[a]=this.getAttr(a)),this.attrs[a][d]=c,this._fireChangeEvent(a,f,c))},_fireAndBubble:function(a,d,c){var f=!0;d&&"Shape"===this.nodeType&&(d.target=this);"mouseenter"===a&&c&&(this._id===c._id||this.isAncestorOf&&this.isAncestorOf(c))?f=!1:"mouseleave"===a&&c&&(this._id===c._id||this.isAncestorOf&&
this.isAncestorOf(c))&&(f=!1);f&&(this._fire(a,d),f=("mouseenter"===a||"mouseleave"===a)&&(c&&c.isAncestorOf&&c.isAncestorOf(this)||!(!c||!c.isAncestorOf)),d&&!d.cancelBubble&&this.parent&&this.parent.isListening()&&!f&&(c&&c.parent?this._fireAndBubble.call(this.parent,a,d,c.parent):this._fireAndBubble.call(this.parent,a,d)))},_fire:function(a,d){var c=this.eventListeners[a],f;d.type=a;if(c)for(f=0;f<c.length;f++)c[f].handler.call(this,d)},draw:function(){this.drawScene();this.drawHit();return this}});
a.Node.create=function(a,d){return this._createNode(JSON.parse(a),d)};a.Node._createNode=function(b,d){var c=a.Node.prototype.getClassName.call(b),f=b.children,h,g;d&&(b.attrs.container=d);c=new a[c](b.attrs);if(f)for(h=f.length,g=0;g<h;g++)c.add(this._createNode(f[g]));return c};a.Factory.addOverloadedGetterSetter(a.Node,"position");a.Factory.addGetterSetter(a.Node,"x",0);a.Factory.addGetterSetter(a.Node,"y",0);a.Factory.addGetterSetter(a.Node,"opacity",1);a.Factory.addGetter(a.Node,"name");a.Factory.addOverloadedGetterSetter(a.Node,
"name");a.Factory.addGetter(a.Node,"id");a.Factory.addOverloadedGetterSetter(a.Node,"id");a.Factory.addGetterSetter(a.Node,"rotation",0);a.Factory.addComponentsGetterSetter(a.Node,"scale",["x","y"]);a.Factory.addGetterSetter(a.Node,"scaleX",1);a.Factory.addGetterSetter(a.Node,"scaleY",1);a.Factory.addComponentsGetterSetter(a.Node,"skew",["x","y"]);a.Factory.addGetterSetter(a.Node,"skewX",0);a.Factory.addGetterSetter(a.Node,"skewY",0);a.Factory.addComponentsGetterSetter(a.Node,"offset",["x","y"]);
a.Factory.addGetterSetter(a.Node,"offsetX",0);a.Factory.addGetterSetter(a.Node,"offsetY",0);a.Factory.addSetter(a.Node,"dragDistance");a.Factory.addOverloadedGetterSetter(a.Node,"dragDistance");a.Factory.addSetter(a.Node,"width",0);a.Factory.addOverloadedGetterSetter(a.Node,"width");a.Factory.addSetter(a.Node,"height",0);a.Factory.addOverloadedGetterSetter(a.Node,"height");a.Factory.addGetterSetter(a.Node,"listening","inherit");a.Factory.addGetterSetter(a.Node,"filters",void 0,function(a){this._filterUpToDate=
!1;return a});a.Factory.addGetterSetter(a.Node,"visible","inherit");a.Factory.addGetterSetter(a.Node,"transformsEnabled","all");a.Factory.addOverloadedGetterSetter(a.Node,"size");a.Factory.backCompat(a.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});a.Collection.mapMethods(a.Node)})(b);(function(){b.Filters.Grayscale=function(a){a=a.data;var b=a.length,e,d;for(e=0;e<b;e+=4)d=.34*a[e]+.5*a[e+1]+.16*a[e+2],a[e]=d,a[e+1]=d,a[e+2]=d}})();(function(){b.Filters.Brighten=
function(a){var b=255*this.brightness();a=a.data;var e=a.length,d;for(d=0;d<e;d+=4)a[d]+=b,a[d+1]+=b,a[d+2]+=b};b.Factory.addGetterSetter(b.Node,"brightness",0,null,b.Factory.afterSetFilter)})();(function(){b.Filters.Invert=function(a){a=a.data;var b=a.length,e;for(e=0;e<b;e+=4)a[e]=255-a[e],a[e+1]=255-a[e+1],a[e+2]=255-a[e+2]}})();(function(){function a(){this.a=this.b=this.g=this.r=0;this.next=null}var g=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,
456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,
373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,
18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];b.Filters.Blur=function(d){var c=Math.round(this.blurRadius());if(0<c){var b=d.data,h=d.width;d=d.height;var k,m,l,n,p,v,r,u,y,B,q,t,w,x,z,A,E,H,I,L,M,D,G;k=c+c+1;var R=h-1,T=d-1,J=c+1,N=J*(J+1)/2,Q=new a,U=null,C=Q;G=l=null;var O=g[c],P=e[c];for(l=1;l<k;l++)C=C.next=new a,l===J&&(U=C);C.next=Q;for(m=v=p=0;m<d;m++){z=
A=E=H=r=u=y=B=0;q=J*(I=b[p]);t=J*(L=b[p+1]);w=J*(M=b[p+2]);x=J*(D=b[p+3]);r+=N*I;u+=N*L;y+=N*M;B+=N*D;C=Q;for(l=0;l<J;l++)C.r=I,C.g=L,C.b=M,C.a=D,C=C.next;for(l=1;l<J;l++)n=p+((R<l?R:l)<<2),r+=(C.r=I=b[n])*(G=J-l),u+=(C.g=L=b[n+1])*G,y+=(C.b=M=b[n+2])*G,B+=(C.a=D=b[n+3])*G,z+=I,A+=L,E+=M,H+=D,C=C.next;l=Q;G=U;for(k=0;k<h;k++)b[p+3]=D=B*O>>P,0!==D?(D=255/D,b[p]=(r*O>>P)*D,b[p+1]=(u*O>>P)*D,b[p+2]=(y*O>>P)*D):b[p]=b[p+1]=b[p+2]=0,r-=q,u-=t,y-=w,B-=x,q-=l.r,t-=l.g,w-=l.b,x-=l.a,n=v+((n=k+c+1)<R?n:R)<<
2,z+=l.r=b[n],A+=l.g=b[n+1],E+=l.b=b[n+2],H+=l.a=b[n+3],r+=z,u+=A,y+=E,B+=H,l=l.next,q+=I=G.r,t+=L=G.g,w+=M=G.b,x+=D=G.a,z-=I,A-=L,E-=M,H-=D,G=G.next,p+=4;v+=h}for(k=0;k<h;k++){A=E=H=z=u=y=B=r=0;p=k<<2;q=J*(I=b[p]);t=J*(L=b[p+1]);w=J*(M=b[p+2]);x=J*(D=b[p+3]);r+=N*I;u+=N*L;y+=N*M;B+=N*D;C=Q;for(l=0;l<J;l++)C.r=I,C.g=L,C.b=M,C.a=D,C=C.next;n=h;for(l=1;l<=c;l++)p=n+k<<2,r+=(C.r=I=b[p])*(G=J-l),u+=(C.g=L=b[p+1])*G,y+=(C.b=M=b[p+2])*G,B+=(C.a=D=b[p+3])*G,z+=I,A+=L,E+=M,H+=D,C=C.next,l<T&&(n+=h);p=k;l=
Q;G=U;for(m=0;m<d;m++)n=p<<2,b[n+3]=D=B*O>>P,0<D?(D=255/D,b[n]=(r*O>>P)*D,b[n+1]=(u*O>>P)*D,b[n+2]=(y*O>>P)*D):b[n]=b[n+1]=b[n+2]=0,r-=q,u-=t,y-=w,B-=x,q-=l.r,t-=l.g,w-=l.b,x-=l.a,n=k+((n=m+J)<T?n:T)*h<<2,r+=z+=l.r=b[n],u+=A+=l.g=b[n+1],y+=E+=l.b=b[n+2],B+=H+=l.a=b[n+3],l=l.next,q+=I=G.r,t+=L=G.g,w+=M=G.b,x+=D=G.a,z-=I,A-=L,E-=M,H-=D,G=G.next,p+=h}}};b.Factory.addGetterSetter(b.Node,"blurRadius",0,null,b.Factory.afterSetFilter)})();(function(){function a(a,d,c){d=4*(c*a.width+d);c=[];c.push(a.data[d++],
a.data[d++],a.data[d++],a.data[d++]);return c}function g(a,d){return Math.sqrt(Math.pow(a[0]-d[0],2)+Math.pow(a[1]-d[1],2)+Math.pow(a[2]-d[2],2))}b.Filters.Mask=function(b){var d;d=this.threshold();var c=a(b,0,0),f=a(b,b.width-1,0),h=a(b,0,b.height-1),k=a(b,b.width-1,b.height-1);d=d||10;if(g(c,f)<d&&g(f,k)<d&&g(k,h)<d&&g(h,c)<d){f=[f,c,k,h];c=[0,0,0];for(h=0;h<f.length;h++)c[0]+=f[h][0],c[1]+=f[h][1],c[2]+=f[h][2];c[0]/=f.length;c[1]/=f.length;c[2]/=f.length;f=[];for(h=0;h<b.width*b.height;h++)k=
g(c,[b.data[4*h],b.data[4*h+1],b.data[4*h+2]]),f[h]=k<d?0:255;d=f}else d=void 0;if(d){for(var c=b.width,f=b.height,h=[1,1,1,1,0,1,1,1,1],k=Math.round(Math.sqrt(h.length)),m=Math.floor(k/2),l=[],n=0;n<f;n++)for(var p=0;p<c;p++){for(var v=n*c+p,r=0,u=0;u<k;u++)for(var y=0;y<k;y++){var B=n+u-m,q=p+y-m;0<=B&&B<f&&0<=q&&q<c&&(r+=d[B*c+q]*h[u*k+y])}l[v]=2040===r?255:0}d=l;c=b.width;f=b.height;h=[1,1,1,1,1,1,1,1,1];k=Math.round(Math.sqrt(h.length));m=Math.floor(k/2);l=[];for(n=0;n<f;n++)for(p=0;p<c;p++){v=
n*c+p;for(u=r=0;u<k;u++)for(y=0;y<k;y++)B=n+u-m,q=p+y-m,0<=B&&B<f&&0<=q&&q<c&&(r+=d[B*c+q]*h[u*k+y]);l[v]=1020<=r?255:0}d=l;c=b.width;f=b.height;h=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];k=Math.round(Math.sqrt(h.length));m=Math.floor(k/2);l=[];for(n=0;n<f;n++)for(p=0;p<c;p++){v=n*c+p;for(u=r=0;u<k;u++)for(y=0;y<k;y++)B=n+u-m,q=p+y-m,0<=B&&B<f&&0<=q&&q<c&&(r+=d[B*c+q]*h[u*k+y]);l[v]=r}d=l;for(c=0;c<b.width*b.height;c++)b.data[4*c+3]=d[c]}return b};b.Factory.addGetterSetter(b.Node,"threshold",0,null,
b.Factory.afterSetFilter)})();(function(){b.Filters.RGB=function(a){a=a.data;var b=a.length,e=this.red(),d=this.green(),c=this.blue(),f,h;for(f=0;f<b;f+=4)h=(.34*a[f]+.5*a[f+1]+.16*a[f+2])/255,a[f]=h*e,a[f+1]=h*d,a[f+2]=h*c,a[f+3]=a[f+3]};b.Factory.addGetterSetter(b.Node,"red",0,function(a){this._filterUpToDate=!1;return 255<a?255:0>a?0:Math.round(a)});b.Factory.addGetterSetter(b.Node,"green",0,function(a){this._filterUpToDate=!1;return 255<a?255:0>a?0:Math.round(a)});b.Factory.addGetterSetter(b.Node,
"blue",0,b.Validators.RGBComponent,b.Factory.afterSetFilter)})();(function(){b.Filters.HSV=function(a){a=a.data;for(var b=a.length,e=Math.pow(2,this.value()),d=Math.pow(2,this.saturation()),c=Math.abs(this.hue()+360)%360,f=e*d*Math.cos(c*Math.PI/180),h=e*d*Math.sin(c*Math.PI/180),d=.299*e+.701*f+.167*h,c=.587*e-.587*f+.33*h,k=.114*e-.114*f-.497*h,m=.299*e-.299*f-.328*h,l=.587*e+.413*f+.035*h,n=.114*e-.114*f+.293*h,p=.299*e-.3*f+1.25*h,v=.587*e-.586*f-1.05*h,f=.114*e+.886*f-.2*h,r,u,y,e=0;e<b;e+=4)h=
a[e+0],r=a[e+1],u=a[e+2],y=a[e+3],a[e+0]=d*h+c*r+k*u,a[e+1]=m*h+l*r+n*u,a[e+2]=p*h+v*r+f*u,a[e+3]=y};b.Factory.addGetterSetter(b.Node,"hue",0,null,b.Factory.afterSetFilter);b.Factory.addGetterSetter(b.Node,"saturation",0,null,b.Factory.afterSetFilter);b.Factory.addGetterSetter(b.Node,"value",0,null,b.Factory.afterSetFilter)})();(function(){b.Factory.addGetterSetter(b.Node,"hue",0,null,b.Factory.afterSetFilter);b.Factory.addGetterSetter(b.Node,"saturation",0,null,b.Factory.afterSetFilter);b.Factory.addGetterSetter(b.Node,
"luminance",0,null,b.Factory.afterSetFilter);b.Filters.HSL=function(a){a=a.data;var b=a.length,e=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,c=127*this.luminance(),f;f=1*e*Math.cos(d*Math.PI/180);var h=1*e*Math.sin(d*Math.PI/180),e=.299+.701*f+.167*h,d=.587-.587*f+.33*h,k=.114-.114*f-.497*h,m=.299-.299*f-.328*h,l=.587+.413*f+.035*h,n=.114-.114*f+.293*h,p=.299-.3*f+1.25*h,v=.587-.586*f-1.05*h,h=.114+.886*f-.2*h,r,u,y,q;for(f=0;f<b;f+=4)r=a[f+0],u=a[f+1],y=a[f+2],q=a[f+3],a[f+0]=e*
r+d*u+k*y+c,a[f+1]=m*r+l*u+n*y+c,a[f+2]=p*r+v*u+h*y+c,a[f+3]=q}})();(function(){b.Filters.Emboss=function(a){var b=10*this.embossStrength(),e=255*this.embossWhiteLevel(),d=this.embossDirection(),c=this.embossBlend(),f=0,h=0,k=a.data,m=a.width;a=a.height;var l=4*m,n=a;switch(d){case "top-left":h=f=-1;break;case "top":f=-1;h=0;break;case "top-right":f=-1;h=1;break;case "right":f=0;h=1;break;case "bottom-right":h=f=1;break;case "bottom":f=1;h=0;break;case "bottom-left":f=1;h=-1;break;case "left":f=0;
h=-1;break}do{var d=(n-1)*l,p=f;1>n+p&&(p=0);n+p>a&&(p=0);var p=(n-1+p)*m*4,v=m;do{var r=d+4*(v-1),u=h;1>v+u&&(u=0);v+u>m&&(u=0);var u=p+4*(v-1+u),y=k[r+1]-k[u+1],q=k[r+2]-k[u+2],u=k[r]-k[u],t=0<u?u:-u,w=0<q?q:-q;(0<y?y:-y)>t&&(u=y);w>t&&(u=q);u*=b;c?(y=k[r]+u,q=k[r+1]+u,u=k[r+2]+u,k[r]=255<y?255:0>y?0:y,k[r+1]=255<q?255:0>q?0:q,k[r+2]=255<u?255:0>u?0:u):(u=e-u,0>u?u=0:255<u&&(u=255),k[r]=k[r+1]=k[r+2]=u)}while(--v)}while(--n)};b.Factory.addGetterSetter(b.Node,"embossStrength",.5,null,b.Factory.afterSetFilter);
b.Factory.addGetterSetter(b.Node,"embossWhiteLevel",.5,null,b.Factory.afterSetFilter);b.Factory.addGetterSetter(b.Node,"embossDirection","top-left",null,b.Factory.afterSetFilter);b.Factory.addGetterSetter(b.Node,"embossBlend",!1,null,b.Factory.afterSetFilter)})();(function(){function a(a,b,d,c,f){d-=b;f-=c;return 0===d?c+f/2:0===f?c:a=(a-b)/d*f+c}b.Filters.Enhance=function(b){b=b.data;var e=b.length,d=b[0],c=d,f,h=b[1],k=h,m=b[2],l=m,n,p=this.enhance();if(0!==p){for(n=0;n<e;n+=4)f=b[n+0],f<d?d=f:
f>c&&(c=f),f=b[n+1],f<h?h=f:f>k&&(k=f),f=b[n+2],f<m?m=f:f>l&&(l=f);c===d&&(c=255,d=0);k===h&&(k=255,h=0);l===m&&(l=255,m=0);var v,r,u,y;0<p?(f=c+p*(255-c),v=d-p*(d-0),r=k+p*(255-k),u=h-p*(h-0),y=l+p*(255-l),p=m-p*(m-0)):(n=.5*(c+d),f=c+p*(c-n),v=d+p*(d-n),n=.5*(k+h),r=k+p*(k-n),u=h+p*(h-n),n=.5*(l+m),y=l+p*(l-n),p=m+p*(m-n));for(n=0;n<e;n+=4)b[n+0]=a(b[n+0],d,c,v,f),b[n+1]=a(b[n+1],h,k,u,r),b[n+2]=a(b[n+2],m,l,p,y)}};b.Factory.addGetterSetter(b.Node,"enhance",0,null,b.Factory.afterSetFilter)})();
(function(){b.Filters.Posterize=function(a){var b=Math.round(254*this.levels())+1;a=a.data;var e=a.length,b=255/b,d;for(d=0;d<e;d+=1)a[d]=Math.floor(a[d]/b)*b};b.Factory.addGetterSetter(b.Node,"levels",.5,null,b.Factory.afterSetFilter)})();(function(){b.Filters.Noise=function(a){var b=255*this.noise();a=a.data;var e=a.length,b=b/2,d;for(d=0;d<e;d+=4)a[d+0]+=b-2*b*Math.random(),a[d+1]+=b-2*b*Math.random(),a[d+2]+=b-2*b*Math.random()};b.Factory.addGetterSetter(b.Node,"noise",.2,null,b.Factory.afterSetFilter)})();
(function(){b.Filters.Pixelate=function(a){var b=Math.ceil(this.pixelSize()),e=a.width,d=a.height,c,f,h,k,m,l,n,p=Math.ceil(e/b),v=Math.ceil(d/b),r,u,y,q,t,w,x;a=a.data;for(t=0;t<p;t+=1)for(w=0;w<v;w+=1){n=l=m=k=0;r=t*b;u=r+b;y=w*b;q=y+b;x=0;for(c=r;c<u;c+=1)if(!(c>=e))for(f=y;f<q;f+=1)f>=d||(h=4*(e*f+c),k+=a[h+0],m+=a[h+1],l+=a[h+2],n+=a[h+3],x+=1);k/=x;m/=x;l/=x;for(c=r;c<u;c+=1)if(!(c>=e))for(f=y;f<q;f+=1)f>=d||(h=4*(e*f+c),a[h+0]=k,a[h+1]=m,a[h+2]=l,a[h+3]=n)}};b.Factory.addGetterSetter(b.Node,
"pixelSize",8,null,b.Factory.afterSetFilter)})();(function(){b.Filters.Threshold=function(a){var b=255*this.threshold();a=a.data;var e=a.length,d;for(d=0;d<e;d+=1)a[d]=a[d]<b?0:255};b.Factory.addGetterSetter(b.Node,"threshold",.5,null,b.Factory.afterSetFilter)})();(function(){b.Filters.Sepia=function(a){var b=a.data,e=a.width;a=a.height;var d=4*e,c,f,h,k,m,l,n,p;do{c=(a-1)*d;f=e;do h=c+4*(f-1),k=b[h],m=b[h+1],l=b[h+2],n=.393*k+.769*m+.189*l,p=.349*k+.686*m+.168*l,k=.272*k+.534*m+.131*l,b[h]=255<n?
255:n,b[h+1]=255<p?255:p,b[h+2]=255<k?255:k,b[h+3]=b[h+3];while(--f)}while(--a)}})();(function(){b.Filters.Solarize=function(a){var b=a.data,e=a.width,d=4*e;a=a.height;do{var c=(a-1)*d,f=e;do{var h=c+4*(f-1),k=b[h],m=b[h+1],l=b[h+2];127<k&&(k=255-k);127<m&&(m=255-m);127<l&&(l=255-l);b[h]=k;b[h+1]=m;b[h+2]=l}while(--f)}while(--a)}})();(function(){var a=b.Util.createCanvasElement();b.Filters.Kaleidoscope=function(b){var e=b.width,d=b.height,c,f,h,k,m,l,n,p,v=Math.round(this.kaleidoscopePower()),r=Math.round(this.kaleidoscopeAngle());
k=Math.floor(r%360*e/360);if(!(1>v)){a.width=e;a.height=d;r=a.getContext("2d").getImageData(0,0,e,d);c=b.data;f=r.data;var u=b.width;h=b.height;m=e/2||u/2;l=d/2||h/2;var y,q,t=q=0,w=0,x=0,F,z=Math.sqrt(m*m+l*l);y=u-m;q=h-l;F=Math.sqrt(y*y+q*q);var z=F>z?F:z,A,E=360/u*Math.PI/180;for(A=0;A<u;A+=1)for(n=Math.sin(A*E),p=Math.cos(A*E),F=0;F<h;F+=1)y=Math.floor(m+z*F/h*p),q=Math.floor(l+z*F/h*n),y=4*(q*u+y),q=c[y+0],t=c[y+1],w=c[y+2],x=c[y+3],y=4*(A+F*u),f[y+0]=q,f[y+1]=t,f[y+2]=w,f[y+3]=x;for(u=e/Math.pow(2,
v);8>=u;)u*=2,--v;z=u=Math.ceil(u);F=0;A=z;E=1;k+u>e&&(F=z,A=0,E=-1);for(f=0;f<d;f+=1)for(c=F;c!==A;c+=E)h=Math.round(c+k)%e,n=4*(e*f+h),h=r.data[n+0],m=r.data[n+1],l=r.data[n+2],n=r.data[n+3],p=4*(e*f+c),r.data[p+0]=h,r.data[p+1]=m,r.data[p+2]=l,r.data[p+3]=n;for(f=0;f<d;f+=1)for(z=Math.floor(u),k=0;k<v;k+=1){for(c=0;c<z+1;c+=1)n=4*(e*f+c),h=r.data[n+0],m=r.data[n+1],l=r.data[n+2],n=r.data[n+3],p=4*(e*f+2*z-c-1),r.data[p+0]=h,r.data[p+1]=m,r.data[p+2]=l,r.data[p+3]=n;z*=2}h={polarRotation:0};e=r.data;
b=b.data;d=r.width;r=r.height;v=h.polarCenterX||d/2;k=h.polarCenterY||r/2;F=z=l=m=0;c=Math.sqrt(v*v+k*k);f=d-v;u=r-k;f=Math.sqrt(f*f+u*u);c=f>c?f:c;h=h.polarRotation||0;for(f=0;f<d;f+=1)for(u=0;u<r;u+=1)l=f-v,z=u-k,m=Math.sqrt(l*l+z*z)*r/c,l=(180*Math.atan2(z,l)/Math.PI+360+h)%360,l=l*d/360,l=Math.floor(l),m=Math.floor(m),A=4*(m*d+l),m=e[A+0],l=e[A+1],z=e[A+2],F=e[A+3],A=4*(u*d+f),b[A+0]=m,b[A+1]=l,b[A+2]=z,b[A+3]=F}};b.Factory.addGetterSetter(b.Node,"kaleidoscopePower",2,null,b.Factory.afterSetFilter);
b.Factory.addGetterSetter(b.Node,"kaleidoscopeAngle",0,null,b.Factory.afterSetFilter)})();(function(){b.Container=function(a){this.__init(a)};b.Util.addMethods(b.Container,{__init:function(a){this.children=new b.Collection;b.Node.call(this,a)},getChildren:function(a){if(a){var g=new b.Collection;this.children.each(function(b){a(b)&&g.push(b)});return g}return this.children},hasChildren:function(){return 0<this.getChildren().length},removeChildren:function(){for(var a=b.Collection.toCollection(this.children),
g,e=0;e<a.length;e++)g=a[e],delete g.parent,g.index=0,g.hasChildren()&&g.removeChildren(),g.remove();this.children=new b.Collection;return this},destroyChildren:function(){for(var a=b.Collection.toCollection(this.children),g,e=0;e<a.length;e++)g=a[e],delete g.parent,g.index=0,g.destroy();this.children=new b.Collection;return this},add:function(a){if(1<arguments.length){for(var g=0;g<arguments.length;g++)this.add(arguments[g]);return this}if(a.getParent())return a.moveTo(this),this;g=this.children;
this._validateAdd(a);a.index=g.length;a.parent=this;g.push(a);this._fire("add",{child:a});a.isDragging()&&b.DD.anim.setLayers(a.getLayer());return this},destroy:function(){this.hasChildren()&&this.destroyChildren();b.Node.prototype.destroy.call(this)},find:function(a){var g=[];a=a.replace(/ /g,"").split(",");var e=a.length,d,c,f,h,k;for(d=0;d<e;d++)if(f=a[d],"string"!==typeof f?c=!1:(c=f[0],c="#"===c||"."===c||c===c.toUpperCase()),c||(b.Util.warn('Selector "'+f+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),
b.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),b.Util.warn("Konva is awesome, right?")),"#"===f.charAt(0))(f=this._getNodeById(f.slice(1)))&&g.push(f);else if("."===f.charAt(0))f=this._getNodesByName(f.slice(1)),g=g.concat(f);else for(h=this.getChildren(),k=h.length,c=0;c<k;c++)g=g.concat(h[c]._get(f));return b.Collection.toCollection(g)},findOne:function(a){return this.find(a)[0]},_getNodeById:function(a){a=b.ids[a];return void 0!==
a&&this.isAncestorOf(a)?a:null},_getNodesByName:function(a){return this._getDescendants(b.names[a]||[])},_get:function(a){for(var g=b.Node.prototype._get.call(this,a),e=this.getChildren(),d=e.length,c=0;c<d;c++)g=g.concat(e[c]._get(a));return g},toObject:function(){var a=b.Node.prototype.toObject.call(this);a.children=[];for(var g=this.getChildren(),e=g.length,d=0;d<e;d++)a.children.push(g[d].toObject());return a},_getDescendants:function(a){for(var b=[],e=a.length,d=0;d<e;d++){var c=a[d];this.isAncestorOf(c)&&
b.push(c)}return b},isAncestorOf:function(a){for(a=a.getParent();a;){if(a._id===this._id)return!0;a=a.getParent()}return!1},clone:function(a){var g=b.Node.prototype.clone.call(this,a);this.getChildren().each(function(a){g.add(a.clone())});return g},getAllIntersections:function(a){var b=[];this.find("Shape").each(function(e){e.isVisible()&&e.intersects(a)&&b.push(e)});return b},_setChildrenIndices:function(){this.children.each(function(a,b){a.index=b})},drawScene:function(a,b,e){var d=this.getLayer(),
c=(a=a||d&&d.getCanvas())&&a.getContext(),f=this._cache.canvas,f=f&&f.scene;this.isVisible()&&(!e&&f?(c.save(),d._applyTransform(this,c,b),this._drawCachedSceneCanvas(c),c.restore()):this._drawChildren(a,"drawScene",b));return this},drawHit:function(a,b,e){var d=this.getLayer(),c=(a=a||d&&d.hitCanvas)&&a.getContext(),f=this._cache.canvas,f=f&&f.hit;this.shouldDrawHit(a)&&(d&&d.clearHitCache(),!e&&f?(c.save(),d._applyTransform(this,c,b),this._drawCachedHitCanvas(c),c.restore()):this._drawChildren(a,
"drawHit",b));return this},_drawChildren:function(a,b,e){var d=this.getLayer(),c=a&&a.getContext(),f=this.getClipWidth(),h=this.getClipHeight(),k=f&&h,m,l;k&&d&&(m=this.getClipX(),l=this.getClipY(),c.save(),d._applyTransform(this,c),c.beginPath(),c.rect(m,l,f,h),c.clip(),c.reset());this.children.each(function(c){c[b](a,e)});k&&c.restore()},shouldDrawHit:function(a){var g=this.getLayer(),e=b.DD&&b.isDragging()&&-1!==b.DD.anim.getLayers().indexOf(g);return a&&a.isCache||g&&g.hitGraphEnabled()&&this.isVisible()&&
!e},getClientRect:function(a){var b,e,d,c;this.children.each(function(a){a=a.getClientRect();void 0===b?(b=a.x,e=a.y,d=a.x+a.width,c=a.y+a.height):(b=Math.min(b,a.x),e=Math.min(e,a.y),d=Math.max(d,a.x+a.width),c=Math.max(c,a.y+a.height))});var f={x:b,y:e,width:d-b,height:c-e};return a?f:this._transformedRect(f)}});b.Util.extend(b.Container,b.Node);b.Container.prototype.get=b.Container.prototype.find;b.Factory.addComponentsGetterSetter(b.Container,"clip",["x","y","width","height"]);b.Factory.addGetterSetter(b.Container,
"clipX");b.Factory.addGetterSetter(b.Container,"clipY");b.Factory.addGetterSetter(b.Container,"clipWidth");b.Factory.addGetterSetter(b.Container,"clipHeight");b.Collection.mapMethods(b.Container)})();(function(a){function b(a){a.fill()}function e(a){a.stroke()}function d(a){a.fill()}function c(a){a.stroke()}function f(){this._clearCache("hasShadow")}function h(){this._clearCache("shadowRGBA")}a.Shape=function(a){this.__init(a)};a.Util.addMethods(a.Shape,{__init:function(k){this.nodeType="Shape";this._fillFunc=
b;this._strokeFunc=e;this._fillFuncHit=d;this._strokeFuncHit=c;for(var m=a.shapes,l;!(l=a.Util.getRandomColor())||l in m;);this.colorKey=l;m[l]=this;a.Node.call(this,k);this.on("shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",f);this.on("shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",h)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},
getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache("hasShadow",this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},getShadowRGBA:function(){return this._getCache("shadowRGBA",this._getShadowRGBA)},_getShadowRGBA:function(){if(this.hasShadow()){var c=a.Util.colorToRGBA(this.shadowColor());return"rgba("+c.r+
","+c.g+","+c.b+","+c.a*(this.getShadowOpacity()||1)+")"}},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!this.stroke()},intersects:function(a){var c=this.getStage().bufferHitCanvas;c.getContext().clear();this.drawScene(c);return 0<c.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data[3]},destroy:function(){a.Node.prototype.destroy.call(this);delete a.shapes[this.colorKey]},
_useBufferCanvas:function(a){return!a&&this.perfectDrawEnabled()&&1!==this.getAbsoluteOpacity()&&this.hasFill()&&this.hasStroke()&&this.getStage()||this.perfectDrawEnabled()&&this.hasShadow()&&1!==this.getAbsoluteOpacity()&&this.hasFill()&&this.hasStroke()&&this.getStage()},getSelfRect:function(){var a=this.getSize();return{x:this._centroid?Math.round(-a.width/2):0,y:this._centroid?Math.round(-a.height/2):0,width:a.width,height:a.height}},getClientRect:function(a){var c=this.getSelfRect(),d=this.hasStroke()&&
this.strokeWidth()||0,b=c.width+d,f=c.height+d,e=this.shadowOffsetX(),h=this.shadowOffsetY(),b=b+Math.abs(e),f=f+Math.abs(h),g=this.hasShadow()&&this.shadowBlur()||0,q=0;Math.round(d/2)!==d/2&&(q=1);c={width:b+2*g+q,height:f+2*g+q,x:-Math.round(d/2+g)+Math.min(e,0)+c.x,y:-Math.round(d/2+g)+Math.min(h,0)+c.y};return a?c:this._transformedRect(c)},drawScene:function(a,c,d){var b=this.getLayer();a=a||b.getCanvas();var f=a.getContext(),e=this._cache.canvas,h=this.sceneFunc(),g=this.hasShadow(),q=this.hasStroke();
if(!this.isVisible())return this;if(e)return f.save(),b._applyTransform(this,f,c),this._drawCachedSceneCanvas(f),f.restore(),this;if(!h)return this;f.save();this._useBufferCanvas(d)?(q=this.getStage(),q=q.bufferCanvas,e=q.getContext(),e.clear(),e.save(),e._applyLineJoin(this),d||(b?b._applyTransform(this,e,c):(d=this.getAbsoluteTransform(c).getMatrix(),f.transform(d[0],d[1],d[2],d[3],d[4],d[5]))),h.call(this,e),e.restore(),g&&!a.hitCanvas?(f.save(),f._applyShadow(this),f._applyOpacity(this),f.drawImage(q._canvas,
0,0),f.restore()):(f._applyOpacity(this),f.drawImage(q._canvas,0,0))):(f._applyLineJoin(this),d||(b?b._applyTransform(this,f,c):(c=this.getAbsoluteTransform(c).getMatrix(),f.transform(c[0],c[1],c[2],c[3],c[4],c[5]))),g&&q&&!a.hitCanvas?(f.save(),d||f._applyOpacity(this),f._applyShadow(this),h.call(this,f),f.restore(),this.hasFill()&&this.getShadowForStrokeEnabled()&&h.call(this,f)):g&&!a.hitCanvas?(f.save(),d||f._applyOpacity(this),f._applyShadow(this),h.call(this,f),f.restore()):(d||f._applyOpacity(this),
h.call(this,f)));f.restore();return this},drawHit:function(a,c,d){var b=this.getLayer(),f=a||b.hitCanvas;a=f.getContext();var e=this.hitFunc()||this.sceneFunc(),h=this._cache.canvas,h=h&&h.hit;if(!this.shouldDrawHit(f))return this;b&&b.clearHitCache();if(h)return a.save(),b._applyTransform(this,a,c),this._drawCachedHitCanvas(a),a.restore(),this;if(!e)return this;a.save();a._applyLineJoin(this);d||(b?b._applyTransform(this,a,c):(c=this.getAbsoluteTransform(c).getMatrix(),a.transform(c[0],c[1],c[2],
c[3],c[4],c[5])));e.call(this,a);a.restore();return this},drawHitFromCache:function(c){c=c||0;var d=this._cache.canvas,b=this._getCachedSceneCanvas(),f=d.hit,d=f.getContext(),e=f.getWidth(),f=f.getHeight(),h,g,u,q,t,w;d.clear();d.drawImage(b._canvas,0,0,e,f);try{h=d.getImageData(0,0,e,f);g=h.data;u=g.length;q=a.Util._hexToRgb(this.colorKey);for(t=0;t<u;t+=4)w=g[t+3],w>c?(g[t]=q.r,g[t+1]=q.g,g[t+2]=q.b,g[t+3]=255):g[t+3]=0;d.putImageData(h,0,0)}catch(x){a.Util.error("Unable to draw hit graph from cached scene canvas. "+
x.message)}return this}});a.Util.extend(a.Shape,a.Node);a.Factory.addGetterSetter(a.Shape,"stroke");a.Factory.addDeprecatedGetterSetter(a.Shape,"strokeRed",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"strokeGreen",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"strokeBlue",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"strokeAlpha",1,a.Validators.alphaComponent);a.Factory.addGetterSetter(a.Shape,"strokeWidth",2);a.Factory.addGetterSetter(a.Shape,
"strokeHitEnabled",!0);a.Factory.addGetterSetter(a.Shape,"perfectDrawEnabled",!0);a.Factory.addGetterSetter(a.Shape,"shadowForStrokeEnabled",!0);a.Factory.addGetterSetter(a.Shape,"lineJoin");a.Factory.addGetterSetter(a.Shape,"lineCap");a.Factory.addGetterSetter(a.Shape,"sceneFunc");a.Factory.addGetterSetter(a.Shape,"hitFunc");a.Factory.addGetterSetter(a.Shape,"dash");a.Factory.addGetterSetter(a.Shape,"shadowColor");a.Factory.addDeprecatedGetterSetter(a.Shape,"shadowRed",0,a.Validators.RGBComponent);
a.Factory.addDeprecatedGetterSetter(a.Shape,"shadowGreen",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"shadowBlue",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"shadowAlpha",1,a.Validators.alphaComponent);a.Factory.addGetterSetter(a.Shape,"shadowBlur");a.Factory.addGetterSetter(a.Shape,"shadowOpacity");a.Factory.addComponentsGetterSetter(a.Shape,"shadowOffset",["x","y"]);a.Factory.addGetterSetter(a.Shape,"shadowOffsetX",0);a.Factory.addGetterSetter(a.Shape,
"shadowOffsetY",0);a.Factory.addGetterSetter(a.Shape,"fillPatternImage");a.Factory.addGetterSetter(a.Shape,"fill");a.Factory.addDeprecatedGetterSetter(a.Shape,"fillRed",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"fillGreen",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"fillBlue",0,a.Validators.RGBComponent);a.Factory.addDeprecatedGetterSetter(a.Shape,"fillAlpha",1,a.Validators.alphaComponent);a.Factory.addGetterSetter(a.Shape,"fillPatternX",
0);a.Factory.addGetterSetter(a.Shape,"fillPatternY",0);a.Factory.addGetterSetter(a.Shape,"fillLinearGradientColorStops");a.Factory.addGetterSetter(a.Shape,"fillRadialGradientStartRadius",0);a.Factory.addGetterSetter(a.Shape,"fillRadialGradientEndRadius",0);a.Factory.addGetterSetter(a.Shape,"fillRadialGradientColorStops");a.Factory.addGetterSetter(a.Shape,"fillPatternRepeat","repeat");a.Factory.addGetterSetter(a.Shape,"fillEnabled",!0);a.Factory.addGetterSetter(a.Shape,"strokeEnabled",!0);a.Factory.addGetterSetter(a.Shape,
"shadowEnabled",!0);a.Factory.addGetterSetter(a.Shape,"dashEnabled",!0);a.Factory.addGetterSetter(a.Shape,"strokeScaleEnabled",!0);a.Factory.addGetterSetter(a.Shape,"fillPriority","color");a.Factory.addComponentsGetterSetter(a.Shape,"fillPatternOffset",["x","y"]);a.Factory.addGetterSetter(a.Shape,"fillPatternOffsetX",0);a.Factory.addGetterSetter(a.Shape,"fillPatternOffsetY",0);a.Factory.addComponentsGetterSetter(a.Shape,"fillPatternScale",["x","y"]);a.Factory.addGetterSetter(a.Shape,"fillPatternScaleX",
1);a.Factory.addGetterSetter(a.Shape,"fillPatternScaleY",1);a.Factory.addComponentsGetterSetter(a.Shape,"fillLinearGradientStartPoint",["x","y"]);a.Factory.addGetterSetter(a.Shape,"fillLinearGradientStartPointX",0);a.Factory.addGetterSetter(a.Shape,"fillLinearGradientStartPointY",0);a.Factory.addComponentsGetterSetter(a.Shape,"fillLinearGradientEndPoint",["x","y"]);a.Factory.addGetterSetter(a.Shape,"fillLinearGradientEndPointX",0);a.Factory.addGetterSetter(a.Shape,"fillLinearGradientEndPointY",0);
a.Factory.addComponentsGetterSetter(a.Shape,"fillRadialGradientStartPoint",["x","y"]);a.Factory.addGetterSetter(a.Shape,"fillRadialGradientStartPointX",0);a.Factory.addGetterSetter(a.Shape,"fillRadialGradientStartPointY",0);a.Factory.addComponentsGetterSetter(a.Shape,"fillRadialGradientEndPoint",["x","y"]);a.Factory.addGetterSetter(a.Shape,"fillRadialGradientEndPointX",0);a.Factory.addGetterSetter(a.Shape,"fillRadialGradientEndPointY",0);a.Factory.addGetterSetter(a.Shape,"fillPatternRotation",0);
a.Factory.backCompat(a.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});a.Collection.mapMethods(a.Shape)})(b);(function(){function a(a,c){a.content.addEventListener(c,function(b){a["_"+c](b)},!1)}var g="mousedown mousemove mouseup mouseout touchstart touchmove touchend mouseover DOMMouseScroll mousewheel wheel".split(" "),e=
g.length;b.Stage=function(a){this.___init(a)};b.Util.addMethods(b.Stage,{___init:function(a){this.nodeType="Stage";b.Container.call(this,a);this._id=b.idCounter++;this._buildDOM();this._bindContentEvents();this._enableNestedTransforms=!1;b.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&b.Util.throw("You may only add layers to the stage.")},setContainer:function(a){if("string"===typeof a){var c=a;a=b.document.getElementById(a);if(!a)throw"Can not find container in document with id "+
c;}this._setAttr("container",a);return this},shouldDrawHit:function(){return!0},draw:function(){b.Node.prototype.draw.call(this);return this},setHeight:function(a){b.Node.prototype.setHeight.call(this,a);this._resizeDOM();return this},setWidth:function(a){b.Node.prototype.setWidth.call(this,a);this._resizeDOM();return this},clear:function(){var a=this.children,c=a.length,b;for(b=0;b<c;b++)a[b].clear();return this},clone:function(a){a||(a={});a.container=b.document.createElement("div");return b.Container.prototype.clone.call(this,
a)},destroy:function(){var a=this.content;b.Container.prototype.destroy.call(this);a&&b.Util._isInDocument(a)&&this.getContainer().removeChild(a);a=b.stages.indexOf(this);-1<a&&b.stages.splice(a,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){a=a||{};var c=a.mimeType||null,f=a.quality||null,e=a.x||0,g=a.y||0,m=new b.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),
pixelRatio:a.pixelRatio}),l=m.getContext()._context,n=this.children;(e||g)&&l.translate(-1*e,-1*g);n.each(function(a){var c=a.getCanvas().getWidth(),d=a.getCanvas().getHeight(),b=a.getCanvas().getPixelRatio();l.drawImage(a.getCanvas()._canvas,0,0,c/b,d/b)});c=m.toDataURL(c,f);a.callback&&a.callback(c);return c},toImage:function(a){var c=a.callback;a.callback=function(a){b.Util._getImage(a,function(a){c(a)})};this.toDataURL(a)},getIntersection:function(a){var c=this.getChildren(),b,e;for(b=c.length-
1;0<=b;b--)if(e=c[b].getIntersection(a))return e;return null},_resizeDOM:function(){if(this.content){var a=this.getWidth(),c=this.getHeight(),b=this.getChildren(),e=b.length,g,m;this.content.style.width=a+"px";this.content.style.height=c+"px";this.bufferCanvas.setSize(a,c);this.bufferHitCanvas.setSize(a,c);for(g=0;g<e;g++)m=b[g],m.setSize(a,c),m.draw()}},add:function(a){if(1<arguments.length){for(var c=0;c<arguments.length;c++)this.add(arguments[c]);return this}b.Container.prototype.add.call(this,
a);a._setCanvasSize(this.width(),this.height());a.draw();this.content.appendChild(a.canvas._canvas);return this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var d=0;d<e;d++)a(this,g[d])},_mouseover:function(a){b.UA.mobile||(this._setPointerPosition(a),this._fire("contentMouseover",{evt:a}))},_mouseout:function(a){if(!b.UA.mobile){this._setPointerPosition(a);var c=this.targetShape;c&&!b.isDragging()&&
(c._fireAndBubble("mouseout",{evt:a}),c._fireAndBubble("mouseleave",{evt:a}),this.targetShape=null);this.pointerPos=void 0;this._fire("contentMouseout",{evt:a})}},_mousemove:function(a){if(b.UA.ieMobile)return this._touchmove(a);if(("undefined"!==typeof a.webkitMovementX||"undefined"!==typeof a.webkitMovementY)&&0===a.webkitMovementY&&0===a.webkitMovementX||b.UA.mobile)return null;this._setPointerPosition(a);var c=b.DD,f;b.isDragging()||((f=this.getIntersection(this.getPointerPosition()))&&f.isListening()?
b.isDragging()||this.targetShape&&this.targetShape._id===f._id?f._fireAndBubble("mousemove",{evt:a}):(this.targetShape&&(this.targetShape._fireAndBubble("mouseout",{evt:a},f),this.targetShape._fireAndBubble("mouseleave",{evt:a},f)),f._fireAndBubble("mouseover",{evt:a},this.targetShape),f._fireAndBubble("mouseenter",{evt:a},this.targetShape),this.targetShape=f):this.targetShape&&!b.isDragging()&&(this.targetShape._fireAndBubble("mouseout",{evt:a}),this.targetShape._fireAndBubble("mouseleave",{evt:a}),
this.targetShape=null),this._fire("contentMousemove",{evt:a}));c&&c._drag(a);a.preventDefault&&a.preventDefault()},_mousedown:function(a){if(b.UA.ieMobile)return this._touchstart(a);if(!b.UA.mobile){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition());b.listenClickTap=!0;c&&c.isListening()&&(this.clickStartShape=c,c._fireAndBubble("mousedown",{evt:a}));this._fire("contentMousedown",{evt:a})}a.preventDefault&&a.preventDefault()},_mouseup:function(a){if(b.UA.ieMobile)return this._touchend(a);
if(!b.UA.mobile){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition()),f=this.clickStartShape,e=!1,g=b.DD;b.inDblClickWindow?(e=!0,b.inDblClickWindow=!1):g&&g.justDragged?g&&(g.justDragged=!1):b.inDblClickWindow=!0;setTimeout(function(){b.inDblClickWindow=!1},b.dblClickWindow);c&&c.isListening()&&(c._fireAndBubble("mouseup",{evt:a}),b.listenClickTap&&f&&f._id===c._id&&(c._fireAndBubble("click",{evt:a}),e&&c._fireAndBubble("dblclick",{evt:a})));this._fire("contentMouseup",
{evt:a});b.listenClickTap&&(this._fire("contentClick",{evt:a}),e&&this._fire("contentDblclick",{evt:a}));b.listenClickTap=!1}a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition());b.listenClickTap=!0;c&&c.isListening()&&(this.tapStartShape=c,c._fireAndBubble("touchstart",{evt:a}),c.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchstart",{evt:a})},_touchend:function(a){this._setPointerPosition(a);
var c=this.getIntersection(this.getPointerPosition()),f=!1;b.inDblClickWindow?(f=!0,b.inDblClickWindow=!1):b.inDblClickWindow=!0;setTimeout(function(){b.inDblClickWindow=!1},b.dblClickWindow);c&&c.isListening()&&(c._fireAndBubble("touchend",{evt:a}),b.listenClickTap&&c._id===this.tapStartShape._id&&(c._fireAndBubble("tap",{evt:a}),f&&c._fireAndBubble("dbltap",{evt:a})),c.isListening()&&a.preventDefault&&a.preventDefault());b.listenClickTap&&(this._fire("contentTouchend",{evt:a}),f&&this._fire("contentDbltap",
{evt:a}));b.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var c=b.DD,f;b.isDragging()||((f=this.getIntersection(this.getPointerPosition()))&&f.isListening()&&(f._fireAndBubble("touchmove",{evt:a}),f.isListening()&&a.preventDefault&&a.preventDefault()),this._fire("contentTouchmove",{evt:a}));c&&(c._drag(a),b.isDragging()&&a.preventDefault())},_DOMMouseScroll:function(a){this._mousewheel(a)},_mousewheel:function(a){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition());
c&&c.isListening()&&c._fireAndBubble("mousewheel",{evt:a})},_wheel:function(a){this._mousewheel(a)},_setPointerPosition:function(a){var c=this._getContentPosition(),f=a.offsetX,e=a.clientX,g=null,m=null;a=a?a:window.event;void 0!==a.touches?0<a.touches.length&&(a=a.touches[0],g=a.clientX-c.left,m=a.clientY-c.top):void 0!==f?(g=f,m=a.offsetY):"mozilla"===b.UA.browser?(g=a.layerX||a.clientX-c.left,m=a.layerY||a.clientY-c.top):void 0!==e&&c&&(g=e-c.left,m=a.clientY-c.top);null!==g&&null!==m&&(this.pointerPos=
{x:g,y:m})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();if(!a){if(b.Util.isBrowser())throw"Stage has no container. A container is required.";a=b.document.createElement("div")}a.innerHTML="";this.content=b.document.createElement("div");this.content.style.position="relative";this.content.className="konvajs-content";this.content.setAttribute("role",
"presentation");a.appendChild(this.content);this.bufferCanvas=new b.SceneCanvas({pixelRatio:1});this.bufferHitCanvas=new b.HitCanvas;this._resizeDOM()},_onContent:function(a,c){var b=a.split(" "),e=b.length,g,m;for(g=0;g<e;g++)m=b[g],this.content.addEventListener(m,c,!1)},cache:function(){b.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}});b.Util.extend(b.Stage,b.Container);b.Factory.addGetter(b.Stage,"container");
b.Factory.addOverloadedGetterSetter(b.Stage,"container")})();(function(){b.BaseLayer=function(a){this.___init(a)};b.Util.addMethods(b.BaseLayer,{___init:function(a){this.nodeType="Layer";b.Container.call(this,a)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){this.getContext().clear(a);return this},clearHitCache:function(){this._hitImageData=
void 0},setZIndex:function(a){b.Node.prototype.setZIndex.call(this,a);var g=this.getStage();g&&(g.content.removeChild(this.getCanvas()._canvas),a<g.getChildren().length-1?g.content.insertBefore(this.getCanvas()._canvas,g.getChildren()[a+1].getCanvas()._canvas):g.content.appendChild(this.getCanvas()._canvas));return this},moveToTop:function(){b.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},
moveUp:function(){if(b.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(b.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var g=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);a.content.insertBefore(this.getCanvas()._canvas,
g[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(b.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var g=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);a.content.insertBefore(this.getCanvas()._canvas,g[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getCanvas()._canvas;b.Node.prototype.remove.call(this);a&&a.parentNode&&b.Util._isInDocument(a)&&a.parentNode.removeChild(a);return this},getStage:function(){return this.parent},
setSize:function(a,b){this.canvas.setSize(a,b)},getWidth:function(){if(this.parent)return this.parent.getWidth()},setWidth:function(){b.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},getHeight:function(){if(this.parent)return this.parent.getHeight()},setHeight:function(){b.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')},_applyTransform:function(a,b,e){a=a.getAbsoluteTransform(e).getMatrix();b.transform(a[0],a[1],a[2],
a[3],a[4],a[5])}});b.Util.extend(b.BaseLayer,b.Container);b.Factory.addGetterSetter(b.BaseLayer,"clearBeforeDraw",!0);b.Collection.mapMethods(b.BaseLayer)})();(function(){var a=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],g=a.length;b.Layer=function(a){this.____init(a)};b.Util.addMethods(b.Layer,{____init:function(a){this.nodeType="Layer";this.canvas=new b.SceneCanvas;this.hitCanvas=new b.HitCanvas({pixelRatio:1});b.BaseLayer.call(this,a)},_setCanvasSize:function(a,
b){this.canvas.setSize(a,b);this.hitCanvas.setSize(a,b)},_validateAdd:function(a){a=a.getType();"Group"!==a&&"Shape"!==a&&b.Util.throw("You may only add groups and shapes to a layer.")},getIntersection:function(b){var d,c,f;if(!this.hitGraphEnabled()||!this.isVisible())return null;var h=1;for(f=!1;;){for(c=0;c<g;c++){d=a[c];d=this._getIntersection({x:b.x+d.x*h,y:b.y+d.y*h});if(f=d.shape)return f;f=!!d.antialiased;if(!d.antialiased)break}if(f)h+=1;else return null}},_getImageData:function(a,b){var c=
this.hitCanvas.width||1,f=this.hitCanvas.height||1,h=Math.round(b)*c+Math.round(a);this._hitImageData||(this._hitImageData=this.hitCanvas.context.getImageData(0,0,c,f));return[this._hitImageData.data[4*h+0],this._hitImageData.data[4*h+1],this._hitImageData.data[4*h+2],this._hitImageData.data[4*h+3]]},_getIntersection:function(a){var d=this.hitCanvas.pixelRatio;a=this.hitCanvas.context.getImageData(Math.round(a.x*d),Math.round(a.y*d),1,1).data;d=a[3];return 255===d?(a=b.Util._rgbToHex(a[0],a[1],a[2]),
(a=b.shapes["#"+a])?{shape:a}:{antialiased:!0}):0<d?{antialiased:!0}:{}},drawScene:function(a,d){var c=this.getLayer(),c=a||c&&c.getCanvas();this._fire("beforeDraw",{node:this});this.getClearBeforeDraw()&&c.getContext().clear();b.Container.prototype.drawScene.call(this,c,d);this._fire("draw",{node:this});return this},drawHit:function(a,d){var c=this.getLayer(),f=a||c&&c.hitCanvas;c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear();b.Container.prototype.drawHit.call(this,f,d);this.imageData=
null;return this},clear:function(a){b.BaseLayer.prototype.clear.call(this,a);this.getHitCanvas().getContext().clear(a);this.imageData=null;return this},setVisible:function(a){b.Node.prototype.setVisible.call(this,a);a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none");return this},enableHitGraph:function(){this.setHitGraphEnabled(!0);return this},disableHitGraph:function(){this.setHitGraphEnabled(!1);
return this},setSize:function(a,d){b.BaseLayer.prototype.setSize.call(this,a,d);this.hitCanvas.setSize(a,d)}});b.Util.extend(b.Layer,b.BaseLayer);b.Factory.addGetterSetter(b.Layer,"hitGraphEnabled",!0);b.Collection.mapMethods(b.Layer)})();(function(){b.FastLayer=function(a){this.____init(a)};b.Util.addMethods(b.FastLayer,{____init:function(a){this.nodeType="Layer";this.canvas=new b.SceneCanvas;b.BaseLayer.call(this,a)},_validateAdd:function(a){"Shape"!==a.getType()&&b.Util.throw("You may only add shapes to a fast layer.")},
_setCanvasSize:function(a,b){this.canvas.setSize(a,b)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(a){var g=this.getLayer();a=a||g&&g.getCanvas();this.getClearBeforeDraw()&&a.getContext().clear();b.Container.prototype.drawScene.call(this,a);return this},draw:function(){this.drawScene();return this},setVisible:function(a){b.Node.prototype.setVisible.call(this,a);a?this.getCanvas()._canvas.style.display="block":this.getCanvas()._canvas.style.display=
"none";return this}});b.Util.extend(b.FastLayer,b.BaseLayer);b.Collection.mapMethods(b.FastLayer)})();(function(){b.Group=function(a){this.___init(a)};b.Util.addMethods(b.Group,{___init:function(a){this.nodeType="Group";b.Container.call(this,a)},_validateAdd:function(a){a=a.getType();"Group"!==a&&"Shape"!==a&&b.Util.throw("You may only add groups and shapes to groups.")}});b.Util.extend(b.Group,b.Container);b.Collection.mapMethods(b.Group)})();(function(a){function b(a){setTimeout(a,1E3/60)}function e(){return c.apply(a.root,
arguments)}var d=function(){return a.root.performance&&a.root.performance.now?function(){return a.root.performance.now()}:function(){return(new Date).getTime()}}(),c=a.root.requestAnimationFrame||a.root.webkitRequestAnimationFrame||a.root.mozRequestAnimationFrame||a.root.oRequestAnimationFrame||a.root.msRequestAnimationFrame||b;a.Animation=function(c,b){var f=a.Animation;this.func=c;this.setLayers(b);this.id=f.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:d()}};a.Animation.prototype={setLayers:function(a){var c=
[];this.layers=c=a?0<a.length?a:[a]:[]},getLayers:function(){return this.layers},addLayer:function(a){var c=this.layers,b=c.length,d;for(d=0;d<b;d++)if(c[d]._id===a._id)return!1;this.layers.push(a);return!0},isRunning:function(){var c=a.Animation.animations,b=c.length,d;for(d=0;d<b;d++)if(c[d].id===this.id)return!0;return!1},start:function(){var c=a.Animation;this.stop();this.frame.timeDiff=0;this.frame.lastTime=d();c._addAnimation(this)},stop:function(){a.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=
a-this.frame.lastTime;this.frame.lastTime=a;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1E3/this.frame.timeDiff}};a.Animation.animations=[];a.Animation.animIdCounter=0;a.Animation.animRunning=!1;a.Animation._addAnimation=function(a){this.animations.push(a);this._handleAnimation()};a.Animation._removeAnimation=function(a){a=a.id;var c=this.animations,b=c.length,d;for(d=0;d<b;d++)if(c[d].id===a){this.animations.splice(d,1);break}};a.Animation._runFrames=function(){var a={},c=this.animations,
b,f,e,g,v,r;for(g=0;g<c.length;g++)if(b=c[g],f=b.layers,e=b.func,b._updateFrameObject(d()),v=f.length,b=e?!1!==e.call(b,b.frame):!0)for(b=0;b<v;b++)e=f[b],void 0!==e._id&&(a[e._id]=e);for(r in a)a[r].draw()};a.Animation._animationLoop=function(){var c=a.Animation;c.animations.length?(e(c._animationLoop),c._runFrames()):c.animRunning=!1};a.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,this._animationLoop())};var f=a.Node.prototype.moveTo;a.Node.prototype.moveTo=function(a){f.call(this,
a)};a.BaseLayer.prototype.batchDraw=function(){var c=this,b=a.Animation;this.batchAnim||(this.batchAnim=new b(function(){c.lastBatchDrawTime&&500<d()-c.lastBatchDrawTime&&c.batchAnim.stop()},this));this.lastBatchDrawTime=d();this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())};a.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}})(b);(function(){var a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},g=0,e=["fill","stroke","shadowColor"],d=function(a,
b,d,e,g,l,n){this.prop=a;this.propFunc=b;this._pos=this.begin=e;this.duration=l;this.prevPos=this._change=0;this.yoyo=n;this._finish=this._startTime=this._position=this._time=0;this.func=d;this._change=g-this.begin;this.pause()};d.prototype={fire:function(a){(a=this[a])&&a()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},
setPosition:function(a){this.prevPos=this._pos;this.propFunc(a);this._pos=a},getPosition:function(a){void 0===a&&(a=this._time);return this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=2;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")},reverse:function(){this.state=3;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")},seek:function(a){this.pause();this._time=a;this.update();
this.fire("onSeek")},reset:function(){this.pause();this._time=0;this.update();this.fire("onReset")},finish:function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;2===this.state?this.setTime(a):3===this.state&&this.setTime(this.duration-a)},pause:function(){this.state=1;this.fire("onPause")},getTimer:function(){return(new Date).getTime()}};b.Tween=
function(c){var f=this,e=c.node,k=e._id,m,l=c.easing||b.Easings.Linear,n=!!c.yoyo,p;m="undefined"===typeof c.duration?1:0===c.duration?.001:c.duration;this.node=e;this._id=g++;this.anim=new b.Animation(function(){f.tween.onEnterFrame()},e.getLayer()||(e instanceof b.Stage?e.getLayers():null));this.tween=new d(p,function(a){f._tweenFunc(a)},l,0,1,1E3*m,n);this._addListeners();b.Tween.attrs[k]||(b.Tween.attrs[k]={});b.Tween.attrs[k][this._id]||(b.Tween.attrs[k][this._id]={});b.Tween.tweens[k]||(b.Tween.tweens[k]=
{});for(p in c)void 0===a[p]&&this._addAttr(p,c[p]);this.reset();this.onFinish=c.onFinish;this.onReset=c.onReset};b.Tween.attrs={};b.Tween.tweens={};b.Tween.prototype={_addAttr:function(a,d){var h=this.node,g=h._id,m,l,n;(m=b.Tween.tweens[g][a])&&delete b.Tween.attrs[g][m][a];h=h.getAttr(a);if(b.Util._isArray(d))for(m=[],n=d.length,l=0;l<n;l++)m.push(d[l]-h[l]);else-1!==e.indexOf(a)?(h=b.Util.colorToRGBA(h),m=b.Util.colorToRGBA(d),m={r:m.r-h.r,g:m.g-h.g,b:m.b-h.b,a:m.a-h.a}):m=d-h;b.Tween.attrs[g][this._id][a]=
{start:h,diff:m};b.Tween.tweens[g][a]=this._id},_tweenFunc:function(a){var d=this.node,h=b.Tween.attrs[d._id][this._id],g,m,l,n,p,v;for(g in h){m=h[g];l=m.start;m=m.diff;if(b.Util._isArray(l))for(n=[],v=l.length,p=0;p<v;p++)n.push(l[p]+m[p]*a);else n=-1!==e.indexOf(g)?"rgba("+Math.round(l.r+m.r*a)+","+Math.round(l.g+m.g*a)+","+Math.round(l.b+m.b*a)+","+(l.a+m.a*a)+")":l+m*a;d.setAttr(g,n)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()};this.tween.onReverse=function(){a.anim.start()};
this.tween.onPause=function(){a.anim.stop()};this.tween.onFinish=function(){a.onFinish&&a.onFinish.call(a)};this.tween.onReset=function(){if(a.onReset)a.onReset()}},play:function(){this.tween.play();return this},reverse:function(){this.tween.reverse();return this},reset:function(){this.tween.reset();return this},seek:function(a){this.tween.seek(1E3*a);return this},pause:function(){this.tween.pause();return this},finish:function(){this.tween.finish();return this},destroy:function(){var a=this.node._id,
d=this._id,e=b.Tween.tweens[a],g;this.pause();for(g in e)delete b.Tween.tweens[a][g];delete b.Tween.attrs[a][d]}};b.Node.prototype.to=function(a){var d=a.onFinish;a.node=this;a.onFinish=function(){this.destroy();d&&d()};(new b.Tween(a)).play()};b.Easings={BackEaseIn:function(a,b,d,e){return d*(a/=e)*a*(2.70158*a-1.70158)+b},BackEaseOut:function(a,b,d,e){return d*((a=a/e-1)*a*(2.70158*a+1.70158)+1)+b},BackEaseInOut:function(a,b,d,e){var g=1.70158;return 1>(a/=e/2)?d/2*a*a*(((g*=1.525)+1)*a-g)+b:d/
2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+b},ElasticEaseIn:function(a,b,d,e,g,l){var n=0;if(0===a)return b;if(1===(a/=e))return b+d;l||(l=.3*e);!g||g<Math.abs(d)?(g=d,n=l/4):n=l/(2*Math.PI)*Math.asin(d/g);return-(g*Math.pow(2,10*--a)*Math.sin(2*(a*e-n)*Math.PI/l))+b},ElasticEaseOut:function(a,b,d,e,g,l){var n=0;if(0===a)return b;if(1===(a/=e))return b+d;l||(l=.3*e);!g||g<Math.abs(d)?(g=d,n=l/4):n=l/(2*Math.PI)*Math.asin(d/g);return g*Math.pow(2,-10*a)*Math.sin(2*(a*e-n)*Math.PI/l)+d+b},ElasticEaseInOut:function(a,
b,d,e,g,l){var n=0;if(0===a)return b;if(2===(a/=e/2))return b+d;l||(l=.3*e*1.5);!g||g<Math.abs(d)?(g=d,n=l/4):n=l/(2*Math.PI)*Math.asin(d/g);return 1>a?-.5*g*Math.pow(2,10*--a)*Math.sin(2*(a*e-n)*Math.PI/l)+b:g*Math.pow(2,-10*--a)*Math.sin(2*(a*e-n)*Math.PI/l)*.5+d+b},BounceEaseOut:function(a,b,d,e){return(a/=e)<1/2.75?7.5625*d*a*a+b:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?d*(7.5625*(a-=2.25/2.75)*a+.9375)+b:d*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BounceEaseIn:function(a,d,e,g){return e-
b.Easings.BounceEaseOut(g-a,0,e,g)+d},BounceEaseInOut:function(a,d,e,g){return a<g/2?.5*b.Easings.BounceEaseIn(2*a,0,e,g)+d:.5*b.Easings.BounceEaseOut(2*a-g,0,e,g)+.5*e+d},EaseIn:function(a,b,d,e){return d*(a/=e)*a+b},EaseOut:function(a,b,d,e){return-d*(a/=e)*(a-2)+b},EaseInOut:function(a,b,d,e){return 1>(a/=e/2)?d/2*a*a+b:-d/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,d,e){return d*(a/=e)*a*a*a*a+b},StrongEaseOut:function(a,b,d,e){return d*((a=a/e-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,d,
e){return 1>(a/=e/2)?d/2*a*a*a*a*a+b:d/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,d,e){return d*a/e+b}}})();(function(){b.DD={anim:new b.Animation(function(){var a=this.dirty;this.dirty=!1;return a}),isDragging:!1,justDragged:!1,offset:{x:0,y:0},node:null,_drag:function(a){var d=b.DD,c=d.node;if(c){if(!d.isDragging){var f=c.getStage().getPointerPosition(),g=c.dragDistance();if(Math.max(Math.abs(f.x-d.startPointerPos.x),Math.abs(f.y-d.startPointerPos.y))<g)return}c._setDragPosition(a,c);d.isDragging||
(d.isDragging=!0,c.fire("dragstart",{type:"dragstart",target:c,evt:a},!0));c.fire("dragmove",{type:"dragmove",target:c,evt:a},!0)}},_endDragBefore:function(a){var d=b.DD,c=d.node,f;c&&(f=c.getLayer(),d.anim.stop(),d.isDragging&&(d.isDragging=!1,d.justDragged=!0,b.listenClickTap=!1,a&&(a.dragEndNode=c)),delete d.node,(f||c).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",{type:"dragend",target:b,evt:a},!0)}};b.Node.prototype.startDrag=function(){var a=b.DD,d=this.getStage(),
c=this.getLayer(),d=d.getPointerPosition(),f=this.getAbsolutePosition();d&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=d,a.offset.x=d.x-f.x,a.offset.y=d.y-f.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())};b.Node.prototype._setDragPosition=function(a,d){var c=b.DD,f=this.getStage().getPointerPosition(),g=this.getDragBoundFunc();f&&(f={x:f.x-c.offset.x,y:f.y-c.offset.y},void 0!==g&&(f=g.call(this,f,a)),this.setAbsolutePosition(f),this._lastPos&&this._lastPos.x===
f.x&&this._lastPos.y===f.y||(c.anim.dirty=!0),this._lastPos=f)};b.Node.prototype.stopDrag=function(){var a=b.DD,d={};a._endDragBefore(d);a._endDragAfter(d)};b.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a);this._dragChange()};var a=b.Node.prototype.destroy;b.Node.prototype.destroy=function(){var e=b.DD;e.node&&e.node._id===this._id&&this.stopDrag();a.call(this)};b.Node.prototype.isDragging=function(){var a=b.DD;return!(!a.node||a.node._id!==this._id||!a.isDragging)};b.Node.prototype._listenDrag=
function(){var a=this;this._dragCleanup();if("Stage"===this.getClassName())this.on("contentMousedown.konva contentTouchstart.konva",function(d){b.DD.node||a.startDrag(d)});else this.on("mousedown.konva touchstart.konva",function(d){1!==d.evt.button&&2!==d.evt.button&&(b.DD.node||a.startDrag(d))})};b.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),d=b.DD;a&&d.node&&d.node._id===this._id&&d.node.stopDrag()}};b.Node.prototype._dragCleanup=
function(){"Stage"===this.getClassName()?(this.off("contentMousedown.konva"),this.off("contentTouchstart.konva")):(this.off("mousedown.konva"),this.off("touchstart.konva"))};b.Factory.addGetterSetter(b.Node,"dragBoundFunc");b.Factory.addGetter(b.Node,"draggable",!1);b.Factory.addOverloadedGetterSetter(b.Node,"draggable");var g=b.document.documentElement;g.addEventListener("mouseup",b.DD._endDragBefore,!0);g.addEventListener("touchend",b.DD._endDragBefore,!0);g.addEventListener("mouseup",b.DD._endDragAfter,
!1);g.addEventListener("touchend",b.DD._endDragAfter,!1)})();(function(){b.Rect=function(a){this.___init(a)};b.Rect.prototype={___init:function(a){b.Shape.call(this,a);this.className="Rect";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getCornerRadius(),e=this.getWidth(),d=this.getHeight();a.beginPath();b?(b=Math.min(b,e/2,d/2),a.moveTo(b,0),a.lineTo(e-b,0),a.arc(e-b,b,b,3*Math.PI/2,0,!1),a.lineTo(e,d-b),a.arc(e-b,d-b,b,0,Math.PI/2,!1),a.lineTo(b,d),a.arc(b,d-b,b,Math.PI/2,Math.PI,
!1),a.lineTo(0,b),a.arc(b,b,b,Math.PI,3*Math.PI/2,!1)):a.rect(0,0,e,d);a.closePath();a.fillStrokeShape(this)}};b.Util.extend(b.Rect,b.Shape);b.Factory.addGetterSetter(b.Rect,"cornerRadius",0);b.Collection.mapMethods(b.Rect)})();(function(){var a=2*Math.PI-1E-4;b.Circle=function(a){this.___init(a)};b.Circle.prototype={_centroid:!0,___init:function(a){b.Shape.call(this,a);this.className="Circle";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath();b.arc(0,0,this.getRadius(),0,a,!1);
b.closePath();b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){b.Node.prototype.setWidth.call(this,a);this.radius()!==a/2&&this.setRadius(a/2)},setHeight:function(a){b.Node.prototype.setHeight.call(this,a);this.radius()!==a/2&&this.setRadius(a/2)}};b.Util.extend(b.Circle,b.Shape);b.Factory.addGetterSetter(b.Circle,"radius",0);b.Factory.addOverloadedGetterSetter(b.Circle,"radius");b.Collection.mapMethods(b.Circle)})();
(function(){var a=2*Math.PI-1E-4;b.Ellipse=function(a){this.___init(a)};b.Ellipse.prototype={_centroid:!0,___init:function(a){b.Shape.call(this,a);this.className="Ellipse";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){var e=this.getRadiusX(),d=this.getRadiusY();b.beginPath();b.save();e!==d&&b.scale(1,d/e);b.arc(0,0,e,0,a,!1);b.restore();b.closePath();b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadiusX()},getHeight:function(){return 2*this.getRadiusY()},setWidth:function(a){b.Node.prototype.setWidth.call(this,
a);this.setRadius({x:a/2})},setHeight:function(a){b.Node.prototype.setHeight.call(this,a);this.setRadius({y:a/2})}};b.Util.extend(b.Ellipse,b.Shape);b.Factory.addComponentsGetterSetter(b.Ellipse,"radius",["x","y"]);b.Factory.addGetterSetter(b.Ellipse,"radiusX",0);b.Factory.addGetterSetter(b.Ellipse,"radiusY",0);b.Collection.mapMethods(b.Ellipse)})();(function(){var a=2*Math.PI-1E-4;b.Ring=function(a){this.___init(a)};b.Ring.prototype={_centroid:!0,___init:function(a){b.Shape.call(this,a);this.className=
"Ring";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath();b.arc(0,0,this.getInnerRadius(),0,a,!1);b.moveTo(this.getOuterRadius(),0);b.arc(0,0,this.getOuterRadius(),a,0,!0);b.closePath();b.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){b.Node.prototype.setWidth.call(this,a);this.outerRadius()!==a/2&&this.setOuterRadius(a/2)},setHeight:function(a){b.Node.prototype.setHeight.call(this,
a);this.outerRadius()!==a/2&&this.setOuterRadius(a/2)},setOuterRadius:function(a){this._setAttr("outerRadius",a);this.setWidth(2*a);this.setHeight(2*a)}};b.Util.extend(b.Ring,b.Shape);b.Factory.addGetterSetter(b.Ring,"innerRadius",0);b.Factory.addGetter(b.Ring,"outerRadius",0);b.Factory.addOverloadedGetterSetter(b.Ring,"outerRadius");b.Collection.mapMethods(b.Ring)})();(function(){b.Wedge=function(a){this.___init(a)};b.Wedge.prototype={_centroid:!0,___init:function(a){b.Shape.call(this,a);this.className=
"Wedge";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getRadius(),0,b.getAngle(this.getAngle()),this.getClockwise());a.lineTo(0,0);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){b.Node.prototype.setWidth.call(this,a);this.radius()!==a/2&&this.setRadius(a/2)},setHeight:function(a){b.Node.prototype.setHeight.call(this,a);this.radius()!==a/2&&this.setRadius(a/
2)}};b.Util.extend(b.Wedge,b.Shape);b.Factory.addGetterSetter(b.Wedge,"radius",0);b.Factory.addGetterSetter(b.Wedge,"angle",0);b.Factory.addGetterSetter(b.Wedge,"clockwise",!1);b.Factory.backCompat(b.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});b.Collection.mapMethods(b.Wedge)})();(function(){b.Arc=function(a){this.___init(a)};b.Arc.prototype={_centroid:!0,___init:function(a){b.Shape.call(this,a);this.className="Arc";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var g=
b.getAngle(this.angle()),e=this.clockwise();a.beginPath();a.arc(0,0,this.getOuterRadius(),0,g,e);a.arc(0,0,this.getInnerRadius(),g,0,!e);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){b.Node.prototype.setWidth.call(this,a);this.getOuterRadius()!==a/2&&this.setOuterRadius(a/2)},setHeight:function(a){b.Node.prototype.setHeight.call(this,a);this.getOuterRadius()!==a/2&&this.setOuterRadius(a/
2)}};b.Util.extend(b.Arc,b.Shape);b.Factory.addGetterSetter(b.Arc,"innerRadius",0);b.Factory.addGetterSetter(b.Arc,"outerRadius",0);b.Factory.addGetterSetter(b.Arc,"angle",0);b.Factory.addGetterSetter(b.Arc,"clockwise",!1);b.Collection.mapMethods(b.Arc)})();(function(){b.Image=function(a){this.___init(a)};b.Image.prototype={___init:function(a){b.Shape.call(this,a);this.className="Image";this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||
1!==this.getAbsoluteOpacity())&&this.hasStroke()&&this.getStage()},_sceneFunc:function(a){var b=this.getWidth(),e=this.getHeight(),d=this.getImage(),c,f;d&&(c=this.getCropWidth(),f=this.getCropHeight(),c=c&&f?[d,this.getCropX(),this.getCropY(),c,f,0,0,b,e]:[d,0,0,b,e]);if(this.hasFill()||this.hasStroke())a.beginPath(),a.rect(0,0,b,e),a.closePath(),a.fillStrokeShape(this);d&&a.drawImage.apply(a,c)},_hitFunc:function(a){var b=this.getWidth(),e=this.getHeight();a.beginPath();a.rect(0,0,b,e);a.closePath();
a.fillStrokeShape(this)},getWidth:function(){var a=this.getImage();return this.attrs.width||(a?a.width:0)},getHeight:function(){var a=this.getImage();return this.attrs.height||(a?a.height:0)}};b.Util.extend(b.Image,b.Shape);b.Factory.addGetterSetter(b.Image,"image");b.Factory.addComponentsGetterSetter(b.Image,"crop",["x","y","width","height"]);b.Factory.addGetterSetter(b.Image,"cropX",0);b.Factory.addGetterSetter(b.Image,"cropY",0);b.Factory.addGetterSetter(b.Image,"cropWidth",0);b.Factory.addGetterSetter(b.Image,
"cropHeight",0);b.Collection.mapMethods(b.Image);b.Image.fromURL=function(a,g){var e=new Image;e.onload=function(){var a=new b.Image({image:e});g(a)};e.src=a}})();(function(){function a(a){a.fillText(this.partialText,0,0)}function g(a){a.strokeText(this.partialText,0,0)}var e="fontFamily fontSize fontStyle fontVariant padding align lineHeight text width height wrap".split(" "),d=e.length,c=b.Util.createCanvasElement().getContext("2d");b.Text=function(a){this.___init(a)};b.Text.prototype={___init:function(c){c=
c||{};c.fillLinearGradientColorStops||c.fillRadialGradientColorStops||(c.fill=c.fill||"black");void 0===c.width&&(c.width="auto");void 0===c.height&&(c.height="auto");b.Shape.call(this,c);this._fillFunc=a;this._strokeFunc=g;this.className="Text";for(c=0;c<d;c++)this.on(e[c]+"Change.konva",this._setTextData);this._setTextData();this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var c=this.getPadding(),b=this.getTextHeight(),d=this.getLineHeight()*b,e=this.textArr,g=
e.length,p=this.getWidth();a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();c?(a.translate(c,0),a.translate(0,c+b/2)):a.translate(0,b/2);for(b=0;b<g;b++){var v=e[b],r=v.text,v=v.width;a.save();"right"===this.getAlign()?a.translate(p-v-2*c,0):"center"===this.getAlign()&&a.translate((p-v-2*c)/2,0);this.partialText=r;a.fillStrokeShape(this);a.restore();a.translate(0,d)}a.restore()},_hitFunc:function(a){var c=this.getWidth(),b=this.getHeight();
a.beginPath();a.rect(0,0,c,b);a.closePath();a.fillStrokeShape(this)},setText:function(a){a=b.Util._isString(a)?a:a.toString();this._setAttr("text",a);return this},getWidth:function(){return"auto"===this.attrs.width?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return"auto"===this.attrs.height?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},
_getTextSize:function(a){var b=this.getFontSize();c.save();c.font=this._getContextFont();a=c.measureText(a);c.restore();return{width:a.width,height:parseInt(b,10)}},_getContextFont:function(){return this.getFontStyle()+" "+this.getFontVariant()+" "+this.getFontSize()+"px "+this.getFontFamily()},_addTextLine:function(a,c){return this.textArr.push({text:a,width:c})},_getTextWidth:function(a){return c.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),
d=0,e=this.getLineHeight()*b,g=this.attrs.width,n=this.attrs.height,p="auto"!==g,v="auto"!==n,r=this.getPadding(),g=g-2*r,n=n-2*r,r=0,u=this.getWrap(),q="none"!==u,u="char"!==u&&q;this.textArr=[];c.save();c.font=this._getContextFont();for(var t=0,w=a.length;t<w;++t){var x=a[t],K=this._getTextWidth(x);if(p&&K>g)for(;0<x.length;){for(var K=0,F=x.length,z="",A=0;K<F;){var E=K+F>>>1,H=x.slice(0,E+1),I=this._getTextWidth(H);I<=g?(K=E+1,z=H,A=I):F=E}if(z){u&&(F=Math.max(z.lastIndexOf(" "),z.lastIndexOf("-"))+
1,0<F&&(K=F,z=z.slice(0,K),A=this._getTextWidth(z)));this._addTextLine(z,A);d=Math.max(d,A);r+=e;if(!q||v&&r+e>n)break;x=x.slice(K);if(0<x.length&&(K=this._getTextWidth(x),K<=g)){this._addTextLine(x,K);r+=e;d=Math.max(d,K);break}}else break}else this._addTextLine(x,K),r+=e,d=Math.max(d,K);if(v&&r+e>n)break}c.restore();this.textHeight=b;this.textWidth=d}};b.Util.extend(b.Text,b.Shape);b.Factory.addGetterSetter(b.Text,"fontFamily","Arial");b.Factory.addGetterSetter(b.Text,"fontSize",12);b.Factory.addGetterSetter(b.Text,
"fontStyle","normal");b.Factory.addGetterSetter(b.Text,"fontVariant","normal");b.Factory.addGetterSetter(b.Text,"padding",0);b.Factory.addGetterSetter(b.Text,"align","left");b.Factory.addGetterSetter(b.Text,"lineHeight",1);b.Factory.addGetterSetter(b.Text,"wrap","word");b.Factory.addGetter(b.Text,"text","");b.Factory.addOverloadedGetterSetter(b.Text,"text");b.Collection.mapMethods(b.Text)})();(function(){b.Line=function(a){this.___init(a)};b.Line.prototype={___init:function(a){b.Shape.call(this,a);
this.className="Line";this.on("pointsChange.konva tensionChange.konva closedChange.konva",function(){this._clearCache("tensionPoints")});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getPoints(),e=b.length,d=this.getTension(),c=this.getClosed(),f,h;if(e){a.beginPath();a.moveTo(b[0],b[1]);if(0!==d&&4<e){d=this.getTensionPoints();f=d.length;h=c?0:4;for(c||a.quadraticCurveTo(d[0],d[1],d[2],d[3]);h<f-2;)a.bezierCurveTo(d[h++],d[h++],d[h++],d[h++],d[h++],d[h++]);c||a.quadraticCurveTo(d[f-
2],d[f-1],b[e-2],b[e-1])}else for(h=2;h<e;h+=2)a.lineTo(b[h],b[h+1]);c?(a.closePath(),a.fillStrokeShape(this)):a.strokeShape(this)}},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():b.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var a=this.getPoints(),g=a.length,e=this.getTension(),d=b.Util,c=d._getControlPoints(a[g-2],a[g-1],a[0],
a[1],a[2],a[3],e),d=d._getControlPoints(a[g-4],a[g-3],a[g-2],a[g-1],a[0],a[1],e),e=b.Util._expandPoints(a,e);return[c[2],c[3]].concat(e).concat([d[0],d[1],a[g-2],a[g-1],d[2],d[3],c[0],c[1],a[0],a[1]])},getWidth:function(){return this.getSelfRect().width},getHeight:function(){return this.getSelfRect().height},getSelfRect:function(){var a;a=0!==this.getTension()?this._getTensionPoints():this.getPoints();for(var b=a[0],e=a[0],d=a[0],c=a[0],f,h,k=0;k<a.length/2;k++)f=a[2*k],h=a[2*k+1],b=Math.min(b,f),
e=Math.max(e,f),d=Math.min(d,h),c=Math.max(c,h);return{x:Math.round(b),y:Math.round(d),width:Math.round(e-b),height:Math.round(c-d)}}};b.Util.extend(b.Line,b.Shape);b.Factory.addGetterSetter(b.Line,"closed",!1);b.Factory.addGetterSetter(b.Line,"tension",0);b.Factory.addGetterSetter(b.Line,"points",[]);b.Collection.mapMethods(b.Line)})();(function(){b.Sprite=function(a){this.___init(a)};b.Sprite.prototype={___init:function(a){b.Shape.call(this,a);this.className="Sprite";this._updated=!0;var g=this;
this.anim=new b.Animation(function(){var a=g._updated;g._updated=!1;return a});this.on("animationChange.konva",function(){this.frameIndex(0)});this.on("frameIndexChange.konva",function(){this._updated=!0});this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())});this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b=this.getAnimation(),e=this.frameIndex(),d=4*e,c=this.getAnimations()[b],f=this.frameOffsets(),
h=c[d+0],k=c[d+1],m=c[d+2],d=c[d+3];if(c=this.getImage())f?(b=f[b],e*=2,a.drawImage(c,h,k,m,d,b[e+0],b[e+1],m,d)):a.drawImage(c,h,k,m,d,0,0,m,d)},_hitFunc:function(a){var b=this.getAnimation(),e=this.frameIndex(),d=4*e,c=this.getAnimations()[b],f=this.frameOffsets(),h=c[d+2],d=c[d+3];a.beginPath();f?(b=f[b],e*=2,a.rect(b[e+0],b[e+1],h,d)):a.rect(0,0,h,d);a.closePath();a.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_setInterval:function(){var a=
this;this.interval=setInterval(function(){a._updateIndex()},1E3/this.getFrameRate())},start:function(){var a=this.getLayer();this.anim.setLayers(a);this._setInterval();this.anim.start()},stop:function(){this.anim.stop();clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var a=this.frameIndex(),b=this.getAnimation(),b=this.getAnimations()[b].length/4;a<b-1?this.frameIndex(a+1):this.frameIndex(0)}};b.Util.extend(b.Sprite,b.Shape);b.Factory.addGetterSetter(b.Sprite,
"animation");b.Factory.addGetterSetter(b.Sprite,"animations");b.Factory.addGetterSetter(b.Sprite,"frameOffsets");b.Factory.addGetterSetter(b.Sprite,"image");b.Factory.addGetterSetter(b.Sprite,"frameIndex",0);b.Factory.addGetterSetter(b.Sprite,"frameRate",17);b.Factory.backCompat(b.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});b.Collection.mapMethods(b.Sprite)})();(function(){b.Path=function(a){this.___init(a)};b.Path.prototype={___init:function(a){this.dataArray=[];
var g=this;b.Shape.call(this,a);this.className="Path";this.dataArray=b.Path.parsePathData(this.getData());this.on("dataChange.konva",function(){g.dataArray=b.Path.parsePathData(this.getData())});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.dataArray,e=!1;a.beginPath();for(var d=0;d<b.length;d++){var c=b[d].points;switch(b[d].command){case "L":a.lineTo(c[0],c[1]);break;case "M":a.moveTo(c[0],c[1]);break;case "C":a.bezierCurveTo(c[0],c[1],c[2],c[3],c[4],c[5]);break;case "Q":a.quadraticCurveTo(c[0],
c[1],c[2],c[3]);break;case "A":var f=c[0],h=c[1],k=c[2],m=c[3],l=c[4],n=c[5],p=c[6],c=c[7],v=k>m?k:m,r=k>m?1:k/m,k=k>m?m/k:1;a.translate(f,h);a.rotate(p);a.scale(r,k);a.arc(0,0,v,l,l+n,1-c);a.scale(1/r,1/k);a.rotate(-p);a.translate(-f,-h);break;case "z":a.closePath(),e=!0}}e?a.fillStrokeShape(this):a.strokeShape(this)},getSelfRect:function(){var a=[];this.dataArray.forEach(function(b){a=a.concat(b.points)});for(var b=a[0],e=a[0],d=a[0],c=a[0],f,h,k=0;k<a.length/2;k++)f=a[2*k],h=a[2*k+1],b=Math.min(b,
f),e=Math.max(e,f),d=Math.min(d,h),c=Math.max(c,h);return{x:Math.round(b),y:Math.round(d),width:Math.round(e-b),height:Math.round(c-d)}}};b.Util.extend(b.Path,b.Shape);b.Path.getLineLength=function(a,b,e,d){return Math.sqrt((e-a)*(e-a)+(d-b)*(d-b))};b.Path.getPointOnLine=function(a,b,e,d,c,f,h){void 0===f&&(f=b);void 0===h&&(h=e);var k=(c-e)/(d-b+1E-8),m=Math.sqrt(a*a/(1+k*k));d<b&&(m*=-1);var l=k*m;if(d===b)b={x:f,y:h+l};else if((h-e)/(f-b+1E-8)===k)b={x:f+m,y:h+l};else{l=this.getLineLength(b,e,
d,c);if(1E-8>l)return;m=((f-b)*(d-b)+(h-e)*(c-e))/(l*l);l=b+m*(d-b);e+=m*(c-e);f=this.getLineLength(f,h,l,e);a=Math.sqrt(a*a-f*f);m=Math.sqrt(a*a/(1+k*k));d<b&&(m*=-1);b={x:l+m,y:e+k*m}}return b};b.Path.getPointOnCubicBezier=function(a,b,e,d,c,f,h,k,m){return{x:k*a*a*a+3*f*a*a*(1-a)+3*d*a*(1-a)*(1-a)+b*(1-a)*(1-a)*(1-a),y:m*a*a*a+3*h*a*a*(1-a)+3*c*a*(1-a)*(1-a)+e*(1-a)*(1-a)*(1-a)}};b.Path.getPointOnQuadraticBezier=function(a,b,e,d,c,f,h){return{x:f*a*a+2*d*a*(1-a)+b*(1-a)*(1-a),y:h*a*a+2*c*a*(1-
a)+e*(1-a)*(1-a)}};b.Path.getPointOnEllipticalArc=function(a,b,e,d,c,f){var h=Math.cos(f);f=Math.sin(f);e*=Math.cos(c);d*=Math.sin(c);return{x:a+(e*h-d*f),y:b+(e*f+d*h)}};b.Path.parsePathData=function(a){if(!a)return[];var b,e="mMlLvVhHzZcCqQtTsSaA".split("");b=a.replace(/ /g,",");for(a=0;a<e.length;a++)b=b.replace(new RegExp(e[a],"g"),"|"+e[a]);e=b.split("|");b=[];var d=0,c=0;for(a=1;a<e.length;a++){var f=e[a],h=f.charAt(0),f=f.slice(1),f=f.replace(/,-/g,"-"),f=f.replace(/-/g,",-"),f=f.replace(/e,-/g,
"e-"),f=f.split(",");0<f.length&&""===f[0]&&f.shift();for(var k=0;k<f.length;k++)f[k]=parseFloat(f[k]);for(;0<f.length&&!isNaN(f[0]);){var m=null,l=[],k=d,n=c,p,v,r,u,q,t;switch(h){case "l":d+=f.shift();c+=f.shift();m="L";l.push(d,c);break;case "L":d=f.shift();c=f.shift();l.push(d,c);break;case "m":h=f.shift();p=f.shift();d+=h;c+=p;m="M";if(2<b.length&&"z"===b[b.length-1].command)for(v=b.length-2;0<=v;v--)if("M"===b[v].command){d=b[v].points[0]+h;c=b[v].points[1]+p;break}l.push(d,c);h="l";break;case "M":d=
f.shift();c=f.shift();m="M";l.push(d,c);h="L";break;case "h":d+=f.shift();m="L";l.push(d,c);break;case "H":d=f.shift();m="L";l.push(d,c);break;case "v":c+=f.shift();m="L";l.push(d,c);break;case "V":c=f.shift();m="L";l.push(d,c);break;case "C":l.push(f.shift(),f.shift(),f.shift(),f.shift());d=f.shift();c=f.shift();l.push(d,c);break;case "c":l.push(d+f.shift(),c+f.shift(),d+f.shift(),c+f.shift());d+=f.shift();c+=f.shift();m="C";l.push(d,c);break;case "S":p=d;v=c;m=b[b.length-1];"C"===m.command&&(p=
d+(d-m.points[2]),v=c+(c-m.points[3]));l.push(p,v,f.shift(),f.shift());d=f.shift();c=f.shift();m="C";l.push(d,c);break;case "s":p=d;v=c;m=b[b.length-1];"C"===m.command&&(p=d+(d-m.points[2]),v=c+(c-m.points[3]));l.push(p,v,d+f.shift(),c+f.shift());d+=f.shift();c+=f.shift();m="C";l.push(d,c);break;case "Q":l.push(f.shift(),f.shift());d=f.shift();c=f.shift();l.push(d,c);break;case "q":l.push(d+f.shift(),c+f.shift());d+=f.shift();c+=f.shift();m="Q";l.push(d,c);break;case "T":p=d;v=c;m=b[b.length-1];"Q"===
m.command&&(p=d+(d-m.points[0]),v=c+(c-m.points[1]));d=f.shift();c=f.shift();m="Q";l.push(p,v,d,c);break;case "t":p=d;v=c;m=b[b.length-1];"Q"===m.command&&(p=d+(d-m.points[0]),v=c+(c-m.points[1]));d+=f.shift();c+=f.shift();m="Q";l.push(p,v,d,c);break;case "A":l=f.shift();p=f.shift();v=f.shift();r=f.shift();u=f.shift();q=d;t=c;d=f.shift();c=f.shift();m="A";l=this.convertEndpointToCenterParameterization(q,t,d,c,r,u,l,p,v);break;case "a":l=f.shift(),p=f.shift(),v=f.shift(),r=f.shift(),u=f.shift(),q=
d,t=c,d+=f.shift(),c+=f.shift(),m="A",l=this.convertEndpointToCenterParameterization(q,t,d,c,r,u,l,p,v)}b.push({command:m||h,points:l,start:{x:k,y:n},pathLength:this.calcLength(k,n,m||h,l)})}"z"!==h&&"Z"!==h||b.push({command:"z",points:[],start:void 0,pathLength:0})}return b};b.Path.calcLength=function(a,g,e,d){var c,f,h,k=b.Path;switch(e){case "L":return k.getLineLength(a,g,d[0],d[1]);case "C":e=0;c=k.getPointOnCubicBezier(0,a,g,d[0],d[1],d[2],d[3],d[4],d[5]);for(h=.01;1>=h;h+=.01)f=k.getPointOnCubicBezier(h,
a,g,d[0],d[1],d[2],d[3],d[4],d[5]),e+=k.getLineLength(c.x,c.y,f.x,f.y),c=f;return e;case "Q":e=0;c=k.getPointOnQuadraticBezier(0,a,g,d[0],d[1],d[2],d[3]);for(h=.01;1>=h;h+=.01)f=k.getPointOnQuadraticBezier(h,a,g,d[0],d[1],d[2],d[3]),e+=k.getLineLength(c.x,c.y,f.x,f.y),c=f;return e;case "A":e=0;f=d[4];h=d[5];a=d[4]+h;g=Math.PI/180;Math.abs(f-a)<g&&(g=Math.abs(f-a));c=k.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],f,0);if(0>h)for(h=f-g;h>a;h-=g)f=k.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=
k.getLineLength(c.x,c.y,f.x,f.y),c=f;else for(h=f+g;h<a;h+=g)f=k.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=k.getLineLength(c.x,c.y,f.x,f.y),c=f;f=k.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],a,0);return e+=k.getLineLength(c.x,c.y,f.x,f.y)}return 0};b.Path.convertEndpointToCenterParameterization=function(a,b,e,d,c,f,h,k,m){m*=Math.PI/180;var l=Math.cos(m)*(a-e)/2+Math.sin(m)*(b-d)/2,n=-1*Math.sin(m)*(a-e)/2+Math.cos(m)*(b-d)/2,p=l*l/(h*h)+n*n/(k*k);1<p&&(h*=Math.sqrt(p),k*=Math.sqrt(p));
p=Math.sqrt((h*h*k*k-h*h*n*n-k*k*l*l)/(h*h*n*n+k*k*l*l));c===f&&(p*=-1);isNaN(p)&&(p=0);c=p*h*n/k;p=p*-k*l/h;a=(a+e)/2+Math.cos(m)*c-Math.sin(m)*p;b=(b+d)/2+Math.sin(m)*c+Math.cos(m)*p;var q=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(a[0]*a[0]+a[1]*a[1])*Math.sqrt(b[0]*b[0]+b[1]*b[1]))},r=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(q(a,b))};d=r([1,0],[(l-c)/h,(n-p)/k]);e=[(l-c)/h,(n-p)/k];l=[(-1*l-c)/h,(-1*n-p)/k];n=r(e,l);-1>=q(e,l)&&(n=Math.PI);1<=q(e,l)&&(n=0);0===f&&0<n&&
(n-=2*Math.PI);1===f&&0>n&&(n+=2*Math.PI);return[a,b,h,k,d,n,m,f]};b.Factory.addGetterSetter(b.Path,"data");b.Collection.mapMethods(b.Path)})();(function(){function a(a){a.fillText(this.partialText,0,0)}function g(a){a.strokeText(this.partialText,0,0)}b.TextPath=function(a){this.___init(a)};b.TextPath.prototype={___init:function(e){var d=this;this.dummyCanvas=b.Util.createCanvasElement();this.dataArray=[];b.Shape.call(this,e);this._fillFunc=a;this._strokeFunc=g;this._fillFuncHit=a;this._strokeFuncHit=
g;this.className="TextPath";this.dataArray=b.Path.parsePathData(this.attrs.data);this.on("dataChange.konva",function(){d.dataArray=b.Path.parsePathData(this.attrs.data)});this.on("textChange.konva textStroke.konva textStrokeWidth.konva",d._setTextData);d._setTextData();this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var f=
b[c].p0;a.translate(f.x,f.y);a.rotate(b[c].rotation);this.partialText=b[c].text;a.fillStrokeShape(this);a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){b.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas.getContext("2d");b.save();b.font=this._getContextFont();a=b.measureText(a);b.restore();return{width:a.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=
this._getTextSize(this.attrs.text);this.textWidth=a.width;this.textHeight=a.height;this.glyphInfo=[];for(var a=this.attrs.text.split(""),d,c,f,h=-1,g=0,m=0;m<a.length;m++){var l=this._getTextSize(a[m]).width,n=0,p=0;for(c=void 0;.01<Math.abs(l-n)/l&&25>p;){p++;for(var q=n;void 0===f;){a:{g=0;f=this.dataArray;for(var r=h+1;r<f.length;r++)if(0<f[r].pathLength){h=r;f=f[r];break a}else"M"===f[r].command&&(d={x:f[r].points[0],y:f[r].points[1]});f={}}f&&q+f.pathLength<l&&(q+=f.pathLength,f=void 0)}if(f===
{}||void 0===d)break;q=!1;switch(f.command){case "L":b.Path.getLineLength(d.x,d.y,f.points[0],f.points[1])>l?c=b.Path.getPointOnLine(l,d.x,d.y,f.points[0],f.points[1],d.x,d.y):f=void 0;break;case "A":c=f.points[4];var r=f.points[5],u=f.points[4]+r,g=0===g?c+1E-8:l>n?g+Math.PI/180*r/Math.abs(r):g-Math.PI/360*r/Math.abs(r);if(0>r&&g<u||0<=r&&g>u)g=u,q=!0;c=b.Path.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],g,f.points[6]);break;case "C":g=0===g?l>f.pathLength?1E-8:l/f.pathLength:
l>n?g+(l-n)/f.pathLength:g-(n-l)/f.pathLength;1<g&&(g=1,q=!0);c=b.Path.getPointOnCubicBezier(g,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);break;case "Q":g=0===g?l/f.pathLength:l>n?g+(l-n)/f.pathLength:g-(n-l)/f.pathLength,1<g&&(g=1,q=!0),c=b.Path.getPointOnQuadraticBezier(g,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3])}void 0!==c&&(n=b.Path.getLineLength(d.x,d.y,c.x,c.y));q&&(f=void 0)}if(void 0===d||void 0===c)break;l=b.Path.getLineLength(d.x,
d.y,c.x,c.y);l=b.Path.getPointOnLine(0+l/2,d.x,d.y,c.x,c.y);this.glyphInfo.push({transposeX:l.x,transposeY:l.y,text:a[m],rotation:Math.atan2(c.y-d.y,c.x-d.x),p0:d,p1:c});d=c}},getSelfRect:function(){var a=[],b=this.fontSize();this.glyphInfo.forEach(function(b){a.push(b.p0.x);a.push(b.p0.y);a.push(b.p1.x);a.push(b.p1.y)});for(var c=a[0],f=a[0],h=a[0],g=a[0],m,l,n=0;n<a.length/2;n++)m=a[2*n],l=a[2*n+1],c=Math.min(c,m),f=Math.max(f,m),h=Math.min(h,l),g=Math.max(g,l);return{x:Math.round(c)-b,y:Math.round(h)-
b,width:Math.round(f-c)+2*b,height:Math.round(g-h)+2*b}}};b.TextPath.prototype._getContextFont=b.Text.prototype._getContextFont;b.Util.extend(b.TextPath,b.Shape);b.Factory.addGetterSetter(b.TextPath,"fontFamily","Arial");b.Factory.addGetterSetter(b.TextPath,"fontSize",12);b.Factory.addGetterSetter(b.TextPath,"fontStyle","normal");b.Factory.addGetterSetter(b.TextPath,"fontVariant","normal");b.Factory.addGetter(b.TextPath,"text","");b.Collection.mapMethods(b.TextPath)})();(function(){b.RegularPolygon=
function(a){this.___init(a)};b.RegularPolygon.prototype={_centroid:!0,___init:function(a){b.Shape.call(this,a);this.className="RegularPolygon";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.attrs.sides,e=this.attrs.radius,d,c,f;a.beginPath();a.moveTo(0,0-e);for(d=1;d<b;d++)c=e*Math.sin(2*d*Math.PI/b),f=-1*e*Math.cos(2*d*Math.PI/b),a.lineTo(c,f);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},
setWidth:function(a){b.Node.prototype.setWidth.call(this,a);this.radius()!==a/2&&this.setRadius(a/2)},setHeight:function(a){b.Node.prototype.setHeight.call(this,a);this.radius()!==a/2&&this.setRadius(a/2)}};b.Util.extend(b.RegularPolygon,b.Shape);b.Factory.addGetterSetter(b.RegularPolygon,"radius",0);b.Factory.addGetterSetter(b.RegularPolygon,"sides",0);b.Collection.mapMethods(b.RegularPolygon)})();(function(){b.Star=function(a){this.___init(a)};b.Star.prototype={_centroid:!0,___init:function(a){b.Shape.call(this,
a);this.className="Star";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.innerRadius(),e=this.outerRadius(),d=this.numPoints();a.beginPath();a.moveTo(0,0-e);for(var c=1;c<2*d;c++){var f=0===c%2?e:b;a.lineTo(f*Math.sin(c*Math.PI/d),-1*f*Math.cos(c*Math.PI/d))}a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){b.Node.prototype.setWidth.call(this,a);this.outerRadius()!==
a/2&&this.setOuterRadius(a/2)},setHeight:function(a){b.Node.prototype.setHeight.call(this,a);this.outerRadius()!==a/2&&this.setOuterRadius(a/2)}};b.Util.extend(b.Star,b.Shape);b.Factory.addGetterSetter(b.Star,"numPoints",5);b.Factory.addGetterSetter(b.Star,"innerRadius",0);b.Factory.addGetterSetter(b.Star,"outerRadius",0);b.Collection.mapMethods(b.Star)})();(function(){var a="fontFamily fontSize fontStyle padding lineHeight text".split(" "),g=a.length;b.Label=function(a){this.____init(a)};b.Label.prototype=
{____init:function(a){var d=this;b.Group.call(this,a);this.className="Label";this.on("add.konva",function(a){d._addListeners(a.child);d._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(b){var d=this,c,f=function(){d._sync()};for(c=0;c<g;c++)b.on(a[c]+"Change.konva",f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a=this.getText(),b=this.getTag(),
c,f,h,g,m,l,n;if(a&&b){c=a.getWidth();f=a.getHeight();h=b.getPointerDirection();g=b.getPointerWidth();n=b.getPointerHeight();l=m=0;switch(h){case "up":m=c/2;l=-1*n;break;case "right":m=c+g;l=f/2;break;case "down":m=c/2;l=f+n;break;case "left":m=-1*g,l=f/2}b.setAttrs({x:-1*m,y:-1*l,width:c,height:f});a.setAttrs({x:-1*m,y:-1*l})}}};b.Util.extend(b.Label,b.Group);b.Collection.mapMethods(b.Label);b.Tag=function(a){this.___init(a)};b.Tag.prototype={___init:function(a){b.Shape.call(this,a);this.className=
"Tag";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getWidth(),c=this.getHeight(),f=this.getPointerDirection(),h=this.getPointerWidth(),g=this.getPointerHeight(),m=this.getCornerRadius();a.beginPath();a.moveTo(0,0);"up"===f&&(a.lineTo((b-h)/2,0),a.lineTo(b/2,-1*g),a.lineTo((b+h)/2,0));m?(a.lineTo(b-m,0),a.arc(b-m,m,m,3*Math.PI/2,0,!1)):a.lineTo(b,0);"right"===f&&(a.lineTo(b,(c-g)/2),a.lineTo(b+h,c/2),a.lineTo(b,(c+g)/2));m?(a.lineTo(b,c-m),a.arc(b-m,c-m,m,0,Math.PI/2,!1)):a.lineTo(b,
c);"down"===f&&(a.lineTo((b+h)/2,c),a.lineTo(b/2,c+g),a.lineTo((b-h)/2,c));m?(a.lineTo(m,c),a.arc(m,c-m,m,Math.PI/2,Math.PI,!1)):a.lineTo(0,c);"left"===f&&(a.lineTo(0,(c+g)/2),a.lineTo(-1*h,c/2),a.lineTo(0,(c-g)/2));m&&(a.lineTo(0,m),a.arc(m,m,m,Math.PI,3*Math.PI/2,!1));a.closePath();a.fillStrokeShape(this)},getSelfRect:function(){var a=0,b=0,c=this.getPointerWidth(),f=this.getPointerHeight(),h=this.pointerDirection(),g=this.getWidth(),m=this.getHeight();"up"===h?(b-=f,m+=f):"down"===h?m+=f:"left"===
h?(a-=1.5*c,g+=c):"right"===h&&(g+=1.5*c);return{x:a,y:b,width:g,height:m}}};b.Util.extend(b.Tag,b.Shape);b.Factory.addGetterSetter(b.Tag,"pointerDirection","none");b.Factory.addGetterSetter(b.Tag,"pointerWidth",0);b.Factory.addGetterSetter(b.Tag,"pointerHeight",0);b.Factory.addGetterSetter(b.Tag,"cornerRadius",0);b.Collection.mapMethods(b.Tag)})();(function(){b.Arrow=function(a){this.____init(a)};b.Arrow.prototype={____init:function(a){b.Line.call(this,a);this.className="Arrow"},_sceneFunc:function(a){var g=
2*Math.PI,e=this.points(),d=e.length,c=e[d-2]-e[d-4],f=e[d-1]-e[d-3],c=(Math.atan2(f,c)+g)%g,f=this.pointerLength(),h=this.pointerWidth();a.save();a.beginPath();a.translate(e[d-2],e[d-1]);a.rotate(c);a.moveTo(0,0);a.lineTo(-f,h/2);a.lineTo(-f,-h/2);a.closePath();a.restore();this.pointerAtBeginning()&&(a.save(),a.translate(e[0],e[1]),c=e[2]-e[0],f=e[3]-e[1],a.rotate((Math.atan2(-f,-c)+g)%g),a.moveTo(0,0),a.lineTo(-10,6),a.lineTo(-10,-6),a.closePath(),a.restore());a.fillStrokeShape(this);b.Line.prototype._sceneFunc.apply(this,
arguments)}};b.Util.extend(b.Arrow,b.Line);b.Factory.addGetterSetter(b.Arrow,"pointerLength",10);b.Factory.addGetterSetter(b.Arrow,"pointerWidth",10);b.Factory.addGetterSetter(b.Arrow,"pointerAtBeginning",!1);b.Collection.mapMethods(b.Arrow)})()}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{canvas:1,jsdom:1}],4:[function(t,w,x){var q=w.exports=function(b){this.data=b};q.isCompatible=function(b){return b&&"object"===typeof b&&
"byteLength"in b};q.fromResponseData=function(b){return new q(new DataView(b))};q.prototype={get version(){return this.data.getInt32(0,!0)},get is_8_bit(){return!!this.data.getUint32(4,!0)},get is_16_bit(){return!this.is_8_bit},get sample_rate(){return this.data.getInt32(8,!0)},get scale(){return this.data.getInt32(12,!0)},get length(){return this.data.getUint32(16,!0)},at:function(b){return Math.round(this.data.getInt8(20+b))}}},{}],5:[function(t,w,x){w.exports={arraybuffer:t("./arraybuffer.js"),
object:t("./object.js")}},{"./arraybuffer.js":4,"./object.js":6}],6:[function(t,w,x){var q=w.exports=function(b){this.data=b};q.isCompatible=function(b){return b&&"object"===typeof b&&"sample_rate"in b||"string"===typeof b&&"sample_rate"in JSON.parse(b)};q.fromResponseData=function(b){return"string"===typeof b?new q(JSON.parse(b)):new q(b)};q.prototype={get version(){return this.data.version||1},get is_8_bit(){return 8===this.data.bits},get is_16_bit(){return!this.is_8_bit},get sample_rate(){return this.data.sample_rate},
get scale(){return this.data.samples_per_pixel},get length(){return this.data.length},at:function(b){return Math.round(this.data.data[b])}}},{}],7:[function(t,w,x){var q=t("../core.js");w.exports=function(b,a){var g=b.scale,e=b.scale_adjuster;return function(b){var c=Math.floor(b.length/g),f=20,h=new DataView(new ArrayBuffer(f+2*c)),k,m=Infinity,l=-Infinity,n=g,p=b.length;h.setInt32(0,1,!0);h.setUint32(4,1,!0);h.setInt32(8,b.sampleRate,!0);h.setInt32(12,g,!0);h.setInt32(16,c,!0);c=b.getChannelData(0);
k=b.getChannelData(0);for(var v=0;v<p;v++){var r=(c[v]+k[v])/2*e;r<m&&(m=r,-128>m&&(m=-128));r>l&&(l=r,127<l&&(l=127));0===--n&&(h.setInt8(f++,Math.floor(m)),h.setInt8(f++,Math.floor(l)),m=Infinity,l=-Infinity,n=g)}a(new q(h.buffer,q.adapters.arraybuffer),b)}}},{"../core.js":9}],8:[function(t,w,x){function q(g,e,d){"function"===typeof e?(d=e,e={}):e=e||{};e.scale=e.scale||512;e.scale_adjuster=e.scale_adjuster||127;b.decodeAudioData(g,a(e,d))}var b=t("audio-context"),a=t("./audiodecoder.js");q.getAudioContext=
function(){return b};w.exports=q},{"./audiodecoder.js":7,"audio-context":12}],9:[function(t,w,x){var q=t("./segment.js"),b=t("./point.js"),a=w.exports=function(a,b){this.adapter=b.fromResponseData(a);this.segments={};this.points={};this.offset(0,this.adapter.length)};a.create=function(b){var e=null,d=null;b&&"object"===typeof b&&("responseText"in b||"response"in b)&&(d="responseType"in b?b.response:b.responseText||b.response);Object.keys(a.adapters).some(function(c){if(a.adapters[c].isCompatible(d||
b))return e=a.adapters[c],!0});if(null===e)throw new TypeError("Could not detect a WaveformData adapter from the input.");return new a(d||b,e)};a.prototype={offset:function(a,b){var d=this.adapter.length;if(0>b)throw new RangeError("End point must be non-negative ["+Number(b)+" < 0]");if(b<=a)throw new RangeError("We can't end prior to the starting point ["+Number(b)+" <= "+Number(a)+"]");if(0>a)throw new RangeError("Start point must be non-negative ["+Number(a)+" < 0]");if(a>=d)throw new RangeError("Start point must be within range ["+
Number(a)+" >= "+d+"]");b>d&&(b=d);this.offset_start=a;this.offset_end=b;this.offset_length=b-a},set_segment:function(a,b,d){d=d||"default";this.segments[d]=new q(this,a,b);return this.segments[d]},set_point:function(a,e){if(void 0===e||null===e||0===e.length)e="default";this.points[e]=new b(this,a);return this.points[e]},remove_point:function(a){this.points[a]&&delete this.points[a]},resample:function(b){"number"===typeof b&&(b={width:b});b.input_index="number"===typeof b.input_index?b.input_index:
null;b.output_index="number"===typeof b.output_index?b.output_index:null;b.scale="number"===typeof b.scale?b.scale:null;b.width="number"===typeof b.width?b.width:null;var e=Boolean(b.input_index)||Boolean(b.output_index);if(null!==b.input_index&&!1===0<=b.input_index)throw new RangeError("options.input_index should be a positive integer value. ["+b.input_index+"]");if(null!==b.output_index&&!1===0<=b.output_index)throw new RangeError("options.output_index should be a positive integer value. ["+b.output_index+
"]");if(null!==b.width&&!1===0<b.width)throw new RangeError("options.width should be a strictly positive integer value. ["+b.width+"]");if(null!==b.scale&&!1===0<b.scale)throw new RangeError("options.scale should be a strictly positive integer value. ["+b.scale+"]");if(!b.scale&&!b.width)throw new RangeError("You should provide either a resampling scale or a width in pixel the data should fit in.");var d=["width","scale","output_index","input_index"].reduce(function(a,c){return a+(null===b[c]?0:1)},
0);if(e&&4!==d)throw Error("Some partial resampling options are missing. You provided "+d+" of them over 4.");var d=[],c=b.scale||Math.floor(this.duration*this.adapter.sample_rate/b.width),f=this.adapter.scale,h=this.adapter.length,k=b.input_index||0,m=b.output_index||0,l=h?this.min_sample(k):0,n=h?this.max_sample(k):0;if(c<f)throw Error("Zoom level "+c+" too low, minimum: "+f);for(var p,q,r;k<h;){for(;Math.floor(Math.floor(m*c)/f)<=k;)m&&d.push(l,n),r=k,m++,p=Math.floor(m*c),q=Math.floor((m-1)*c),
p!==q&&(l=127,n=-128);p=Math.floor(m*c);p=Math.floor(p/f);for(p>h&&(p=h);k<p;)q=this.min_sample(k),q<l&&(l=q),q=this.max_sample(k),q>n&&(n=q),k++;if(e&&d.length/2>=b.width)break}e?d.length/2>b.width&&k!==r&&d.push(l,n):k!==r&&d.push(l,n);return new a({version:this.adapter.version,samples_per_pixel:c,length:d.length/2,data:d,sample_rate:this.adapter.sample_rate},a.adapters.object)},get min(){return this.offsetValues(this.offset_start,this.offset_length,0)},get max(){return this.offsetValues(this.offset_start,
this.offset_length,1)},offsetValues:function(a,b,d){var c=this.adapter,f=[];d+=2*a;for(a=0;a<b;a++)f.push(c.at(2*a+d));return f},get duration(){return this.adapter.length*this.adapter.scale/this.adapter.sample_rate},get offset_duration(){return this.offset_length*this.adapter.scale/this.adapter.sample_rate},get pixels_per_second(){return this.adapter.sample_rate/this.adapter.scale},get seconds_per_pixel(){return this.adapter.scale/this.adapter.sample_rate},at:function(a){return this.adapter.at(a)},
at_time:function(a){return Math.floor(a*this.adapter.sample_rate/this.adapter.scale)},time:function(a){return a*this.seconds_per_pixel},in_offset:function(a){return a>=this.offset_start&&a<this.offset_end},min_sample:function(a){return this.adapter.at(2*a)},max_sample:function(a){return this.adapter.at(2*a+1)}};a.adapters={};a.adapter=function(a){this.data=a}},{"./point.js":10,"./segment.js":11}],10:[function(t,w,x){(w.exports=function(q,b){this.context=q;this.timeStamp=b}).prototype={get visible(){return this.context.in_offset(this.timeStamp)}}},
{}],11:[function(t,w,x){(w.exports=function(q,b,a){this.context=q;this.start=b;this.end=a}).prototype={get offset_start(){return this.start<this.context.offset_start&&this.end>this.context.offset_start?this.context.offset_start:this.start>=this.context.offset_start&&this.start<this.context.offset_end?this.start:null},get offset_end(){return this.end>this.context.offset_start&&this.end<=this.context.offset_end?this.end:this.end>this.context.offset_end&&this.start<this.context.offset_end?this.context.offset_end:
null},get offset_length(){return this.offset_end-this.offset_start},get length(){return this.end-this.start},get visible(){return this.context.in_offset(this.start)||this.context.in_offset(this.end)||this.context.offset_start>this.start&&this.context.offset_start<this.end},get min(){return this.visible?this.context.offsetValues(this.offset_start,this.offset_length,0):[]},get max(){return this.visible?this.context.offsetValues(this.offset_start,this.offset_length,1):[]}}},{}],12:[function(t,w,x){t=
t("global/window");if(t=t.AudioContext||t.webkitAudioContext)w.exports=new t},{"global/window":13}],13:[function(t,w,x){t="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};w.exports="undefined"!==typeof window?window:"undefined"!==typeof t?t:{}},{}],14:[function(t,w,x){x=t("./lib/core");x.adapters=t("./lib/adapters");x.builders={webaudio:t("./lib/builders/webaudio.js")};w.exports=x},{"./lib/adapters":5,"./lib/builders/webaudio.js":8,"./lib/core":9}],
15:[function(t,w,x){function q(a){f.call(this,{wildcard:!0});this.options={zoomLevels:[512,1024,2048,4096],dataUri:null,dataUriDefaultFormat:"json",logger:null,keyboard:!1,nudgeIncrement:.01,inMarkerColor:"#a0a0a0",outMarkerColor:"#a0a0a0",zoomWaveformColor:"rgba(0, 225, 128, 1)",overviewWaveformColor:"rgba(0,0,0,0.2)",overviewHighlightRectangleColor:"grey",randomizeSegmentColor:!0,height:200,segmentColor:"rgba(255, 161, 39, 1)",playheadColor:"rgba(0, 0, 0, 1)",playheadTextColor:"#aaa",axisGridlineColor:"#ccc",
axisLabelColor:"#aaa",template:'<div class="waveform"><div class="zoom-container"></div><div class="overview-container"></div></div>',pointMarkerColor:"#FF0000",pointDblClickHandler:null,pointDragEndHandler:null,waveformBuilderOptions:{scale:512,scale_adjuster:127},zoomAdapter:"animated"};this.container=a;this.currentZoomLevel=0;this.logger=console.error.bind(console)}x=t("EventEmitter");var b=t("peaks/player/player"),a=t("peaks/waveform/waveform.core"),g=t("peaks/waveform/waveform.mixins"),e=t("peaks/player/player.keyboard");
"use strict";var d=function(a){return{player:a.querySelector(".waveform"),zoom:a.querySelector(".zoom-container"),overview:a.querySelector(".overview-container")}},c=function(a,b){for(var c in b)a[c]=b[c];return a},f=x.EventEmitter2||x;q.init=function(f){f=f||{};f.audioElement&&(f.mediaElement=f.audioElement,console&&"function"===typeof console.log&&console.log("[Peaks.init] `audioElement` option is deprecated. Please use `mediaElement` instead."));if(!f.mediaElement)throw Error("[Peaks.init] Please provide an audio element.");
if(!(f.mediaElement instanceof HTMLMediaElement))throw new TypeError("[Peaks.init] The mediaElement option should be an HTMLMediaElement.");if(!f.container)throw Error("[Peaks.init] Please provide a container object.");if(!1===0<f.container.clientWidth)throw new TypeError("[Peaks.init] Please ensure that the container has a width.");if(f.logger&&"function"!==typeof f.logger)throw new TypeError("[Peaks.init] The `logger` option should be a function.");var k=new q(f.container);c(k.options,f);c(k.options,
{segmentInMarker:g.defaultInMarker(k.options),segmentOutMarker:g.defaultOutMarker(k.options),segmentLabelDraw:g.defaultSegmentLabelDraw(k.options),pointMarker:g.defaultPointMarker(k.options)});f.logger&&(k.logger=f.logger);k.on("error",k.logger.bind(null));if("string"===typeof k.options.template)k.container.innerHTML=k.options.template;else if(k.options.template instanceof HTMLElement)k.container.appendChild(k.options.template);else throw new TypeError("Please ensure you provide an HTML string or a DOM template as `template` instance option. Provided: "+
k.options.template);k.options.keyboard&&e.init(k);k.player=new b(k);k.player.init(k.options.mediaElement);k.waveform=new a(k);k.waveform.init(d(k.container));k.seeking=!1;k.on("waveformOverviewReady",function(){k.waveform.openZoomView();k.options.segments&&k.segments.addSegment(k.options.segments);k.options.points&&k.points.addPoint(k.options.points)});return k};q.prototype=Object.create(f.prototype,{segments:{get:function(){function a(c,d,f,e,h,g){var q=c;"number"===typeof q&&(q=[{startTime:c,endTime:d,
editable:f,color:e,labelText:h,segmentId:g}]);if(Array.isArray(q))q.forEach(function(a){b.waveform.segments.createSegment(a.startTime,a.endTime,a.editable,a.color,a.labelText,a.segmentId)}),b.waveform.segments.render();else throw new TypeError("[Peaks.segments.addSegment] Unrecognized segment parameters.");}var b=this;return{addSegment:a,add:a,remove:function(a){var c=b.waveform.segments.remove(a);if(null===c)throw new RangeError("Unable to find the requested segment"+String(a));b.waveform.segments.updateSegments();
return b.waveform.segments.segments.splice(c,1).pop()},removeByTime:function(a,c){c="number"===typeof c?c:0;var d=b.waveform.segments.segments.filter(0<c?function(b){return b.startTime===a&&b.endTime===c}:function(b){return b.startTime===a}).map(function(a,c){b.waveform.segments.remove(a);return c}).sort(function(a,b){return b-a}).map(function(a){b.waveform.segments.segments.splice(a,1);return a});b.waveform.segments.updateSegments();return d.length},removeAll:function(){b.waveform.segments.removeAll()},
getSegments:function(){return b.waveform.segments.segments}}}},points:{get:function(){var a=this;return{add:function(b,c,d,f){var e=b;"number"===typeof e&&(e=[{timestamp:b,editable:c,color:d,labelText:f}]);if(Array.isArray(e))e.forEach(a.waveform.points.createPoint.bind(a.waveform.points)),a.waveform.points.render();else throw new TypeError("[Peaks.points.addPoint] Unrecognized point parameters.");},getPoints:function(){return a.waveform.points.points},removeByTime:function(b){var c=a.waveform.points.points.filter(function(a){return a.timestamp===
b}).map(function(b,c){a.waveform.points.remove(b);return c}).sort(function(a,b){return b-a}).map(function(b){a.waveform.points.points.splice(b,1);return b});a.waveform.points.render();return c.length},removeAll:function(){a.waveform.points.removeAll()}}}},time:{get:function(){var a=this;return{setCurrentTime:function(b){return a.player.seekBySeconds(b)},getCurrentTime:function(){return a.player.getTime()}}}},zoom:{get:function(){var a=this;return{zoomIn:function(){a.zoom.setZoom(a.currentZoomLevel-
1)},zoomOut:function(){a.zoom.setZoom(a.currentZoomLevel+1)},setZoom:function(b){b>=a.options.zoomLevels.length&&(b=a.options.zoomLevels.length-1);0>b&&(b=0);var c=a.currentZoomLevel;a.currentZoomLevel=b;a.emit("zoom.update",a.options.zoomLevels[b],a.options.zoomLevels[c])},getZoom:function(){return a.currentZoomLevel},overview:function(){a.emit("zoom.update",a.waveform.waveformOverview.data.adapter.scale,a.options.zoomLevels[a.currentZoomLevel])},reset:function(){a.emit("zoom.update",a.options.zoomLevels[a.currentZoomLevel],
a.waveform.waveformOverview.data.adapter.scale)}}}},overview:{get:function(){var a=this;return{zoomIn:function(){a.overview.setZoom(a.currentZoomLevel-1)},zoomOut:function(){a.overview.setZoom(a.currentZoomLevel+1)},setZoom:function(b){b>=a.options.zoomLevels.length&&(b=a.options.zoomLevels.length-1);0>b&&(b=0);var c=a.currentZoomLevel;a.currentZoomLevel=b;a.emit("zoom.update",a.options.zoomLevels[b],a.options.zoomLevels[c])},getZoom:function(){return a.currentZoomLevel},overview:function(){a.emit("zoom.update",
a.waveform.waveformOverview.data.adapter.scale,a.options.zoomLevels[a.currentZoomLevel])},reset:function(){a.emit("zoom.update",a.options.zoomLevels[a.currentZoomLevel],a.waveform.waveformOverview.data.adapter.scale)}}}}});w.exports=q},{EventEmitter:2,"peaks/player/player":20,"peaks/player/player.keyboard":21,"peaks/waveform/waveform.core":27,"peaks/waveform/waveform.mixins":28}],16:[function(t,w,x){function q(){}q.prototype={createShape:function(){throw Error("You should extend this method in your parent class.");
},update:function(){}};w.exports=q},{}],17:[function(t,w,x){x=t("peaks/markers/shapes/base");var q=t("peaks/waveform/waveform.mixins"),b=t("konva");"use strict";var a=Object.create(x.prototype);a.createShape=function(g,e){var d=new b.Shape({fill:g.color,strokeWidth:0,opacity:1});d.sceneFunc(a.drawFunc.bind(d,e,g.id));return d};a.drawFunc=function(a,b,d){var c=a.data;if(void 0!==c.segments[b]){b=c.segments[b];var f=b.offset_length,c=b.offset_start-c.offset_start;a=q.interpolateHeight(a.height);q.drawWaveform(d,
b.min,b.max,c,f,a);d.fillStrokeShape(this)}};w.exports=a},{konva:3,"peaks/markers/shapes/base":16,"peaks/waveform/waveform.mixins":28}],18:[function(t,w,x){var q=t("peaks/waveform/waveform.mixins"),b=t("konva");w.exports=function(a){function g(e){var g=new b.Group,m=new b.Group,l=[g,m];e.editable=Boolean(e.editable);l.forEach(function(b,f){var g=c.views[f];e.editable&&(b.marker=new a.options.pointMarker(!0,b,e,d,a.options.pointDblClickHandler,a.options.pointDragEndHandler),b.add(b.marker));g.pointLayer.add(b)});
e.zoom=g;e.zoom.view=f.waveformZoomView;e.overview=m;e.overview.view=f.waveformOverview;return e}function e(a){f.waveformOverview.data.set_point(f.waveformOverview.data.at_time(a.timestamp),a.id);f.waveformZoomView.data.set_point(f.waveformZoomView.data.at_time(a.timestamp),a.id);var b=f.waveformOverview.data.at_time(a.timestamp);a.editable&&(a.overview.marker&&a.overview.marker.show().setX(b-a.overview.marker.getWidth()),a.overview.marker.label.setText(q.niceTime(a.timestamp,!1)));var b=f.waveformZoomView.data.at_time(a.timestamp),
c=f.waveformZoomView.frameOffset;b<c&&(zoomStartOffset=c);f.waveformZoomView.data.points[a.id].visible?(b-=c,a.zoom.show(),a.editable&&(a.zoom.marker&&a.zoom.marker.show().setX(b-a.zoom.marker.getWidth()),a.zoom.marker.label.setText(q.niceTime(a.timestamp,!1)))):a.zoom.hide()}function d(a,b){if(0<a.marker.getX()){var d=a.view.frameOffset+a.marker.getX()+a.marker.getWidth();b.timestamp=a.view.data.time(d)}e(b);c.render()}var c=this,f=a.waveform;c.points=[];c.views=[f.waveformZoomView,f.waveformOverview].map(function(a){a.pointLayer||
(a.pointLayer=new b.Layer,a.stage.add(a.pointLayer),a.pointLayer.moveToTop());return a});this.init=function(){a.on("waveform_zoom_displaying",c.updatePoints.bind(c));a.emit("points.ready")};this.updatePoints=function(){c.points.forEach(e);c.render()};this.createPoint=function(a){if(!1===0<=a.timestamp)throw new RangeError("[waveform.points.createPoint] timestamp should be a >=0 value");a.id="point"+c.points.length;a=g(a);e(a);c.points.push(a)};this.remove=function(a){var b=null;this.points.some(function(c,
d){if(c===a)return b=d,!0});"number"===typeof b&&(a.overview.destroy(),a.zoom.destroy());return b};this.removeAll=function(){this.views.forEach(function(a){a.pointLayer.removeChildren()});this.points=[];this.render()};this.render=function(){c.views.forEach(function(a){a.pointLayer.draw()})}}},{konva:3,"peaks/waveform/waveform.mixins":28}],19:[function(t,w,x){var q=t("konva"),b=t("peaks/waveform/waveform.mixins"),a=t("peaks/markers/shapes/wave");"use strict";w.exports=function(g){var e=this;e.segments=
[];e.views=[g.waveform.waveformZoomView,g.waveform.waveformOverview].map(function(a){a.segmentLayer||(a.segmentLayer=new q.Layer,a.stage.add(a.segmentLayer),a.segmentLayer.moveToTop());return a});var d=function(b,c,d,l,n,p,v){var r={id:b,startTime:c,endTime:d,labelText:p||"",color:n||(g.options.randomizeSegmentColor?"rgba("+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)":g.options.segmentColor),segmentId:v,editable:l};window.zoomNodes=window.zoomNodes||
[];b=new q.Group;window.zoomNodes.push(b);c=new q.Group;var u=function(a){this.parent.label.show();this.parent.view.segmentLayer.draw()},t=function(a){try{this.parent.label.hide(),this.parent.view.segmentLayer.draw()}catch(b){console.log(b)}};[b,c].forEach(function(b,c){var d=e.views[c];b.waveformShape=a.createShape(r,d);b.waveformShape.on("mouseenter",u);b.waveformShape.on("mouseleave",t);b.add(b.waveformShape);b.label=new g.options.segmentLabelDraw(b,r);b.add(b.label.hide());l&&(b.inMarker=new g.options.segmentInMarker(!0,
b,r,f),b.add(b.inMarker),b.outMarker=new g.options.segmentOutMarker(!0,b,r,f),b.add(b.outMarker));d.segmentLayer.add(b)});r.zoom=b;r.zoom.view=g.waveform.waveformZoomView;r.overview=c;r.overview.view=g.waveform.waveformOverview;return r},c=function(c){g.waveform.waveformOverview.data.set_segment(g.waveform.waveformOverview.data.at_time(c.startTime),g.waveform.waveformOverview.data.at_time(c.endTime),c.id);g.waveform.waveformZoomView.data.set_segment(g.waveform.waveformZoomView.data.at_time(c.startTime),
g.waveform.waveformZoomView.data.at_time(c.endTime),c.id);var d=g.waveform.waveformOverview.data.at_time(c.startTime),f=g.waveform.waveformOverview.data.at_time(c.endTime);c.overview.setWidth(f-d);c.editable&&(c.overview.inMarker&&c.overview.inMarker.show().setX(d-c.overview.inMarker.getWidth()),c.overview.outMarker&&c.overview.outMarker.show().setX(f),c.overview.inMarker.label.setText(b.niceTime(c.startTime,!1)),c.overview.outMarker.label.setText(b.niceTime(c.endTime,!1)));a.update.call(c.overview.waveformShape,
g.waveform.waveformOverview,c.id);var e=g.waveform.waveformZoomView.data.at_time(c.startTime),d=g.waveform.waveformZoomView.data.at_time(c.endTime),f=g.waveform.waveformZoomView.frameOffset,n=g.waveform.waveformZoomView.frameOffset+g.waveform.waveformZoomView.width;e<f&&(e=f);d>n&&(d=n);g.waveform.waveformZoomView.data.segments[c.id].visible?(e-=f,d-=f,c.zoom.show(),c.editable&&(c.zoom.inMarker&&c.zoom.inMarker.show().setX(e-c.zoom.inMarker.getWidth()),c.zoom.outMarker&&c.zoom.outMarker.show().setX(d),
c.zoom.inMarker.label.setText(b.niceTime(c.startTime,!1)),c.zoom.outMarker.label.setText(b.niceTime(c.endTime,!1))),a.update.call(c.zoom.waveformShape,g.waveform.waveformZoomView,c.id)):c.zoom.hide()},f=function(a,b){if(0<a.inMarker.getX()){var d=a.view.frameOffset+a.inMarker.getX()+a.inMarker.getWidth();b.startTime=a.view.data.time(d)}a.outMarker.getX()<a.view.width&&(d=a.view.frameOffset+a.outMarker.getX(),b.endTime=a.view.data.time(d));g.emit("segments.dragged",b);c(b);this.render()}.bind(this);
this.init=function(){g.on("waveform_zoom_displaying",this.updateSegments.bind(this));g.emit("segments.ready")};this.updateSegments=function(){this.segments.forEach(c);this.render()};this.createSegment=function(a,b,f,g,n,p){var q="segment"+e.segments.length;if(!1===0<=a)throw new TypeError("[waveform.segments.createSegment] startTime should be a positive value");if(!1===0<b)throw new TypeError("[waveform.segments.createSegment] endTime should be a positive value");if(!1===b>a)throw new RangeError("[waveform.segments.createSegment] endTime should be higher than startTime");
a=d(q,a,b,f,g,n,p);c(a);e.segments.push(a);return a};this.remove=function(a){var b=null;this.segments.some(function(c,d){if(c===a)return b=d,!0});if("number"===typeof b){a=this.segments[b];if(window.zoomNodes)for(var c=0;c<window.zoomNodes.length;c++)if(window.zoomNodes[c]._id===a.zoom._id){window.zoomNodes.splice(c,1);break}a.overview.destroy();a.zoom.destroy()}return b};this.removeAll=function(){this.views.forEach(function(a){a.segmentLayer.removeChildren()});this.segments=[];this.render()};this.render=
function(){this.views.forEach(function(a){a.segmentLayer.draw()})}}},{konva:3,"peaks/markers/shapes/wave":17,"peaks/waveform/waveform.mixins":28}],20:[function(t,w,x){var q=t("peaks/waveform/waveform.mixins");"use strict";w.exports=function(b){return{init:function(a){var g=this;this.mediaElement=a;this.duration=this.mediaElement.duration;4===this.mediaElement.readyState&&b.emit("player_load",g);this.mediaElement.addEventListener("timeupdate",function(){b.emit("player_time_update",g.getTime())});this.mediaElement.addEventListener("play",
function(){b.emit("player_play",g.getTime())});this.mediaElement.addEventListener("pause",function(){b.emit("player_pause",g.getTime())});this.mediaElement.addEventListener("seeked",function(){b.emit("player_seek",g.getTime())})},setSource:function(a){this.mediaElement.setAttribute("src",a)},getSource:function(){return this.mediaElement.src},play:function(){this.mediaElement.play();b.emit("radio_play",this.getTime())},pause:function(){this.mediaElement.pause();b.emit("radio_pause",this.getTime())},
getTime:function(){return this.mediaElement.currentTime},getTimeFromPercentage:function(a){return q.niceTime(this.duration*a/100,!1)},getSecsFromPercentage:function(a){return Math.floor(this.duration*a/100)},getDuration:function(){return this.mediaElement.duration},getPercentage:function(){return this.getPercentageFromSeconds(this.mediaElement.currentTime)},getPercentageFromSeconds:function(a){return Math.round(a/this.duration*1E4)/100},seek:function(a){this.mediaElement.currentTime=a/100*this.duration},
seekBySeconds:function(a){this.mediaElement.currentTime=a}}}},{"peaks/waveform/waveform.mixins":28}],21:[function(t,w,x){function q(b){return function(a){var g=a.keyCode,e=a.type;if(-1===["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"].indexOf(a.target.nodeName))if(-1<[32,9,37,39].indexOf(a.type)&&a.preventDefault(),"keydown"===e||"keypress"===e)switch(g){case 32:b.emit("kybrd_space");break;case 9:b.emit("kybrd_tab")}else if("keyup"===e)switch(g){case 37:a.shiftKey?b.emit("kybrd_shift_left"):b.emit("kybrd_left");
break;case 39:b.shiftKey?b.emit("kybrd_shift_right"):b.emit("kybrd_right")}}}w.exports={init:function(b){document.addEventListener("keydown",q(b));document.addEventListener("keypress",q(b));document.addEventListener("keyup",q(b))}}},{}],22:[function(t,w,x){function q(a,b,c){function f(a,b){c.seeking||(h.playheadPixel=h.data.at_time(a),h.updateUi(h.playheadPixel))}var h=this;h.peaks=c;h.options=c.options;h.data=a;h.width=b.clientWidth;h.height=b.clientHeight||h.options.height;h.frameOffset=0;h.stage=
new g.Stage({container:b,width:h.width,height:h.height});h.waveformLayer=new g.Layer;h.background=new g.Rect({x:0,y:0,width:h.width,height:h.height});h.waveformLayer.add(h.background);h.createWaveform();h.createRefWaveform();h.createUi();var k=function(){h.stage.off("mousemove mouseup");c.seeking=!1};h.stage.on("mousedown",function(a){!a.target||a.target.attrs.draggable||a.target.parent.attrs.draggable||("mousedown"==a.type?(c.seeking=!0,c.emit("user_seek.overview",h.data.time(a.evt.layerX),a.evt.layerX),
h.stage.on("mousemove",function(a){c.emit("user_scrub.overview",h.data.time(a.evt.layerX),a.evt.layerX)}),h.stage.on("mouseup",k)):k())});c.on("player_time_update",f);c.on("user_seek.*",f);c.on("user_scrub.*",f);c.on("waveform_zoom_displaying",function(a,b){h.updateRefWaveform(a,b)});c.on("resizeEndOverview",function(a,b){h.width=a;h.data=b;h.stage.setWidth(h.width);c.emit("overview_resized")})}var b=t("peaks/waveform/waveform.axis"),a=t("peaks/waveform/waveform.mixins"),g=t("konva");"use strict";
q.prototype.createWaveform=function(){this.waveformShape=new g.Shape({fill:this.options.overviewWaveformColor,strokeWidth:0});this.waveformShape.sceneFunc(a.waveformDrawFunction.bind(this.waveformShape,this));this.waveformLayer.add(this.waveformShape);this.stage.add(this.waveformLayer)};q.prototype.createRefWaveform=function(){this.refLayer=new g.Layer;this.refWaveformRect=new g.Rect({x:0,y:11,width:0,stroke:this.options.overviewHighlightRectangleColor,strokeWidth:1,height:this.height-22,fill:this.options.overviewHighlightRectangleColor,
opacity:.3,cornerRadius:2});this.refLayer.add(this.refWaveformRect);this.stage.add(this.refLayer)};q.prototype.createUi=function(){this.playheadLine=new g.Line({points:[.5,0,.5,this.height],stroke:this.options.playheadColor,strokeWidth:1,x:0});this.uiLayer=new g.Layer({index:100});this.axis=new b(this);this.uiLayer.add(this.playheadLine);this.stage.add(this.uiLayer);this.uiLayer.moveToTop()};q.prototype.updateRefWaveform=function(a,b){if(isNaN(a))throw Error("WaveformOverview#updateRefWaveform passed a time in that is not a number: "+
a);if(isNaN(b))throw Error("WaveformOverview#updateRefWaveform passed a time out that is not a number: "+b);var c=this.data.at_time(a),f=this.data.at_time(b);this.data.set_segment(c,f,"zoom");this.refWaveformRect.setAttrs({x:this.data.segments.zoom.offset_start-this.data.offset_start,width:this.data.at_time(b)-this.data.at_time(a)});this.refLayer.draw()};q.prototype.updateUi=function(a){if(isNaN(a))throw Error("WaveformOverview#updateUi passed a value that is not a number: "+a);this.playheadLine.setAttr("x",
a);this.uiLayer.draw()};w.exports=q},{konva:3,"peaks/waveform/waveform.axis":26,"peaks/waveform/waveform.mixins":28}],23:[function(t,w,x){function q(a,f,h){var k=this;k.cur_scale=0;k.peaks=h;k.options=h.options;k.rootData=a;k.playing=!1;k.intermediateData=null;k.data=k.rootData.resample({scale:k.options.zoomLevels[h.zoom.getZoom()]});k.playheadPixel=k.data.at_time(k.options.mediaElement.currentTime);k.pixelLength=k.data.adapter.length;k.frameOffset=0;k.width=f.clientWidth;k.height=f.clientHeight||
k.options.height;k.data.offset(k.frameOffset,k.frameOffset+k.width);k.stage=new d.Stage({container:f,width:k.width,height:k.height});k.zoomWaveformLayer=new d.Layer;k.uiLayer=new d.Layer;k.background=new d.Rect({x:0,y:0,width:k.width,height:k.height});k.zoomWaveformLayer.add(k.background);k.axis=new b(k);k.createZoomWaveform();k.createUi();k.stage.on("mousedown",function(a){if(a.target&&!a.target.attrs.draggable&&!a.target.parent.attrs.draggable&&"mousedown"===a.type){var b=a.evt.layerX,c,d;h.seeking=
!0;k.stage.on("mousemove",function(a){h.seeking=!1;c=a.evt.layerX>b?b-a.evt.layerX:1*(b-a.evt.layerX);b=a.evt.layerX;d=k.frameOffset+c;d=0>d?0:d>k.pixelLength-k.width?k.pixelLength-k.width:d;k.updateZoomWaveform(d)});k.stage.on("mouseup",function(){h.seeking&&k.peaks.emit("user_seek.zoomview",k.data.time(k.frameOffset+b),k.frameOffset+b);k.stage.off("mousemove mouseup");h.seeking=!1})}});k.stage.on("dblclick",function(a){k.peaks.emit("dbclickAddSegment")});a=function(a,b){a=a||{withOffset:!0};var c=
k.data.at_time(b);k.seekFrame(c,a.withOffset?Math.round(k.width/2):0);k.playing&&k.playFrom(b,c)};k.peaks.on("player_time_update",function(a){h.seeking||k.seekFrame(k.data.at_time(a))});k.peaks.on("player_seek",a.bind(null,{withOffset:!0}));k.peaks.on("user_seek.*",a.bind(null,{withOffset:!0}));k.peaks.on("user_scrub.*",a.bind(null,{withOffset:!1}));k.peaks.on("player_play",function(a){k.playing=!0;k.playFrom(a,k.data.at_time(a))});k.peaks.on("player_pause",function(a){k.playing=!1;k.playheadLineAnimation&&
k.playheadLineAnimation.stop();k.syncPlayhead(k.data.at_time(a))});k.peaks.on("zoom.update",function(a,b){var c;if(!k.playing&&a!==b){k.data=k.rootData.resample({scale:a});c={animated:g,"static":e};if(void 0===c[k.peaks.options.zoomAdapter])throw Error("Invalid zoomAdapter: "+k.peaks.options.zoomAdapter);c=c[k.peaks.options.zoomAdapter].init(a,b,k);c.start()}});k.peaks.on("window_resized",function(a,b){k.width=a;k.data=b;k.stage.setWidth(k.width);k.updateZoomWaveform(k.frameOffset);k.peaks.emit("zoomview_resized")});
a=function(a){var b=k.options.mediaElement.currentTime,b=b+k.options.nudgeIncrement*a;k.seekFrame(k.data.at_time(b))};k.peaks.on("kybrd_left",a.bind(k,-1));k.peaks.on("kybrd_right",a.bind(k,1));k.peaks.on("kybrd_shift_left",a.bind(k,-10));k.peaks.on("kybrd_shift_right",a.bind(k,10))}var b=t("peaks/waveform/waveform.axis"),a=t("peaks/waveform/waveform.mixins"),g=t("peaks/views/zooms/animated"),e=t("peaks/views/zooms/static"),d=t("konva");"use strict";q.prototype.createZoomWaveform=function(){this.zoomWaveformShape=
new d.Shape({fill:this.options.zoomWaveformColor,strokeWidth:0});this.zoomWaveformShape.sceneFunc(a.waveformDrawFunction.bind(this.zoomWaveformShape,this));this.zoomWaveformLayer.add(this.zoomWaveformShape);this.stage.add(this.zoomWaveformLayer);this.peaks.emit("waveform_zoom_displaying",0*this.data.seconds_per_pixel,this.width*this.data.seconds_per_pixel)};q.prototype.createUi=function(){this.zoomPlayheadLine=new d.Line({points:[.5,0,.5,this.height],stroke:this.options.playheadColor,strokeWidth:1});
this.zoomPlayheadText=new d.Text({x:2,y:12,text:"00:00:00",fontSize:11,fontFamily:"sans-serif",fill:this.options.playheadTextColor,align:"right"});this.zoomPlayheadGroup=(new d.Group({x:0,y:0})).add(this.zoomPlayheadLine).add(this.zoomPlayheadText);this.uiLayer.add(this.zoomPlayheadGroup);this.stage.add(this.uiLayer);this.zoomPlayheadGroup.moveToTop()};q.prototype.updateZoomWaveform=function(b){if(isNaN(b))throw Error("WaveformZoomView#updateZoomWaveform passed a pixel offset that is not a number: "+
b);this.pixelLength=this.data.adapter.length;this.pixelLength<this.width&&(b=0);b>this.pixelLength&&(b=this.pixelLength-this.width);0>b&&(b=0);this.frameOffset=b;this.data.offset(b,Math.min(b+this.width,this.pixelLength));if(this.playheadPixel>=b&&this.playheadPixel<=b+this.width){var d=this.playheadPixel-b;this.zoomPlayheadGroup.show().setAttr("x",d);this.zoomPlayheadText.setText(a.niceTime(this.data.time(this.playheadPixel),!1))}else this.zoomPlayheadGroup.hide();this.uiLayer.draw();this.zoomWaveformLayer.draw();
this.peaks.emit("waveform_zoom_displaying",b*this.data.seconds_per_pixel,(b+this.width)*this.data.seconds_per_pixel)};q.prototype.playFrom=function(a,b){var e=this;e.playheadLineAnimation&&e.playheadLineAnimation.stop();var g=e.data.pixels_per_second;e.playheadLineAnimation=new d.Animation(function(a){e.syncPlayhead(e.frameOffset+Math.round(b-e.frameOffset+g*(a.time/1E3-0)))},e.uiLayer);e.playheadLineAnimation.start()};q.prototype.newFrame=function(a){if(isNaN(a))throw Error("WaveformZoomView#newFrame passed a frame offset that is not a number: "+
a);a+=this.width;return a<this.data.adapter.length?(this.frameOffset=a,this.updateZoomWaveform(a),!0):!1};q.prototype.syncPlayhead=function(b){if(isNaN(b))throw Error("WaveformZoomView#syncPlayhead passed a pixel index that is not a number: "+b);var d=b>=this.frameOffset&&b<=this.frameOffset+this.width;this.playheadPixel=b;d?(b=this.playheadPixel-this.frameOffset,this.zoomPlayheadGroup.show().setAttr("x",b),this.zoomPlayheadText.setText(a.niceTime(this.data.time(this.playheadPixel),!1))):this.zoomPlayheadGroup.hide();
this.uiLayer.draw()};q.prototype.seekFrame=function(a,b){if(isNaN(a))throw Error("WaveformZoomView#seekFrame passed a pixel index that is not a number: "+a);var d=this.data.adapter.length-this.width;this.data.in_offset(a)||(this.frameOffset=a-Math.round(this.width/2),0>=this.frameOffset?this.frameOffset=0:this.frameOffset+this.width>=this.data.adapter.length&&(this.frameOffset=d));this.syncPlayhead(a);this.updateZoomWaveform(this.frameOffset)};w.exports=q},{konva:3,"peaks/views/zooms/animated":24,
"peaks/views/zooms/static":25,"peaks/waveform/waveform.axis":26,"peaks/waveform/waveform.mixins":28}],24:[function(t,w,x){var q=t("konva");"use strict";w.exports={init:function(b,a,g){var e=g.peaks.time.getCurrentTime(),d=[],c=30,f;g.segmentLayer&&(g.segmentLayer.setVisible(!1),g.pointLayer.setVisible(!1));a<b&&(c=15);for(var h=0;h<c;h++){var k=Math.round(a+(h+1)*(b-a)/c);f=g.width*k/g.rootData.adapter.sample_rate;0<=e&&e<=0+f/2?f=a=0:e<=g.rootData.duration&&e>=g.rootData.duration-f/2?(f=g.rootData.duration-
f,a=f*g.rootData.adapter.sample_rate/a,f=f*g.rootData.adapter.sample_rate/k):(a=e*g.rootData.adapter.sample_rate/a-g.width/2,f=e*g.rootData.adapter.sample_rate/k-g.width/2);0>a&&(a=0);a=g.rootData.resample({scale:k,input_index:Math.floor(a),output_index:Math.floor(f),width:g.width});d.push(a);a=k}return new q.Animation(this.onFrameData(g,d),g)},onFrameData:function(b,a){b.intermediateData=null;return function(g){a.length?(b.intermediateData=a.shift(),b.zoomWaveformLayer.draw()):(this.stop(),b.intermediateData=
null,b.segmentLayer.setVisible(!0),b.pointLayer.setVisible(!0),b.seekFrame(b.data.at_time(b.peaks.time.getCurrentTime())))}}}},{konva:3}],25:[function(t,w,x){w.exports={init:function(q,b,a){return{start:function(){a.segmentLayer.draw();a.pointLayer.draw();a.seekFrame(a.data.at_time(a.peaks.time.getCurrentTime()))}}}}},{}],26:[function(t,w,x){function q(b){this.view=b;this.axisShape=new a.Shape({fill:"rgba(38, 255, 161, 1)",strokeWidth:0,opacity:1});this.axisShape.sceneFunc(this.axisDrawFunction.bind(this,
b));this.view.uiLayer.add(this.axisShape)}var b=t("peaks/waveform/waveform.mixins"),a=t("konva");"use strict";q.prototype.getAxisLabelScale=function(){for(var a=1,b=[1,2,5,10,20,30],d=0,c;;)if(c=a*b[d],60>this.view.data.at_time(c))++d==b.length&&(a*=60,d=0);else break;return c};q.prototype.axisDrawFunction=function(a,e){var d=a.data.time(a.frameOffset),c=this.getAxisLabelScale(),f;f=d%c;f=0===f?d:d+c-f;d=this.view.data.at_time(f-d);e.setAttr("strokeStyle",this.view.options.axisGridlineColor);e.setAttr("lineWidth",
1);e.setAttr("font","11px sans-serif");e.setAttr("fillStyle",this.view.options.axisLabelColor);e.setAttr("textAlign","left");e.setAttr("textBaseline","bottom");for(var h=f,k;;){k=d+this.view.data.at_time(h-f);if(k>=this.view.width)break;e.beginPath();e.moveTo(k+.5,0);e.lineTo(k+.5,10);e.moveTo(k+.5,this.view.height);e.lineTo(k+.5,this.view.height-10);e.stroke();var m=b.niceTime(h,!0),l=e._context.measureText(m).width;k-=l/2;l=this.view.height-1-10;0<=k&&e.fillText(m,k,l);h+=c}};w.exports=q},{konva:3,
"peaks/waveform/waveform.mixins":28}],27:[function(t,w,x){var q=t("waveform-data"),b=t("peaks/views/waveform.overview"),a=t("peaks/views/waveform.zoomview"),g=t("peaks/markers/waveform.segments"),e=t("peaks/markers/waveform.points");"use strict";var d="withCredentials"in new XMLHttpRequest;w.exports=function(c){return{init:function(a){this.ui=a;this.getRemoteData(c.options)},getRemoteData:function(a){var b=this,c=new XMLHttpRequest,e=null,g=null,n=null;if(a.dataUri){if("string"===typeof a.dataUri){var p=
{};p[a.dataUriDefaultFormat||"json"]=a.dataUri;a.dataUri=p}"object"===typeof a.dataUri&&["ArrayBuffer","JSON"].some(function(b){if(window[b])return g=b.toLowerCase(),e=a.dataUri[g],Boolean(e)})}!a.dataUri&&q.builders.webaudio.getAudioContext()&&(g="arraybuffer",e=a.mediaElement.currentSrc||a.mediaElement.src,n="webaudio");if(!e)throw Error("Unable to determine a compatible dataUri format for this browser.");c.open("GET",e,!0);if(d)try{c.responseType=g}catch(t){}c.onload=function(d){if(4===this.readyState)if(200===
this.status)if(n)q.builders[n](d.target.response,a.waveformBuilderOptions,b.handleRemoteData.bind(b,null));else b.handleRemoteData(null,d.target,c);else b.handleRemoteData(Error("Unable to fetch remote data. HTTP Status "+this.status))};c.send()},handleRemoteData:function(a,d,e){if(a)return c.emit("error",a);this.origWaveformData=null;try{this.origWaveformData=d instanceof q?d:q.create(d);var g=this.origWaveformData.resample(this.ui.player.clientWidth);this.waveformOverview=new b(g,this.ui.overview,
c)}catch(l){return c.emit("error",l)}c.emit("waveformOverviewReady",this.waveformOverview);this.bindResize()},openZoomView:function(){this.waveformZoomView=new a(this.origWaveformData,this.ui.zoom,c);this.segments=new g(c);this.segments.init();this.points=new e(c);this.points.init();c.emit("waveformZoomReady",this.waveformZoomView)},bindResize:function(){var a=this;window.addEventListener("resize",function(){a.ui.overview.hidden=!0;a.ui.zoom.hidden=!0;a.resizeTimeoutId&&clearTimeout(a.resizeTimeoutId);
a.resizeTimeoutId=setTimeout(function(){var b=a.ui.player.clientWidth,d=a.origWaveformData.resample(b);c.emit("resizeEndOverview",b,d);c.emit("window_resized",b,a.origWaveformData)},500)});c.on("overview_resized",function(){a.ui.overview.removeAttribute("hidden")});c.on("zoomview_resized",function(){a.ui.zoom.removeAttribute("hidden")});c.on("user_seek.*",function(a){c.player.seekBySeconds(a)});c.on("user_scrub.*",function(a){c.player.seekBySeconds(a)})}}}},{"peaks/markers/waveform.points":18,"peaks/markers/waveform.segments":19,
"peaks/views/waveform.overview":22,"peaks/views/waveform.zoomview":23,"waveform-data":14}],28:[function(t,w,x){function q(a,b){return function(f,e,k,m,l,n){var p=a/2-10.5;f=(new g.Group({draggable:f,dragBoundFunc:function(a){return{x:a.x,y:this.getAbsolutePosition().y}}})).on("dragmove",function(a){m(e,k)});if(l)f.on("dblclick",function(a){l(k)});if(n)f.on("dragend",function(a){n(k)});var q=new g.Text({x:-10,y:a/2-5,text:"",fontSize:10,fontFamily:"sans-serif",fill:"#000",textAlign:"center"});q.hide();
f.label=q;var p=new g.Rect({width:10,height:20,fill:b,x:.5,y:p}),r=new g.Line({points:[0,0,0,a],stroke:b,strokeWidth:1,x:.5,y:0});p.on("mouseover",function(a){q.show();q.setX(-10-q.getWidth());e.view.pointLayer.draw()});p.on("mouseout",function(a){q.hide();e.view.pointLayer.draw()});f.add(p);f.add(r);f.add(q);return f}}function b(a,b,f,e,g,m){a.beginPath();b.forEach(function(b,c){a.lineTo(e+c+.5,m(b)+.5)});f.reverse().forEach(function(b,c){a.lineTo(e+(g-c)+.5,m(b)+.5)});a.closePath()}function a(a){return function(b){return a-
(b+128)*a/256}}var g=t("konva");"use strict";var e=function(a,b,f){return function(e,k,m,l){var n=a/2-10.5,p=f?-9.5:.5;e=(new g.Group({draggable:e,dragBoundFunc:function(a){1<=window.zoomNodes.length&&window.zoomNodes.sort(function(a,b){return a.inMarker.attrs.x-b.inMarker.attrs.x});for(var b=0,c=0;c<window.zoomNodes.length;c++)if(window.zoomNodes[c].inMarker.attrs.x===k.inMarker.attrs.x){b=c;break}var d=c="";f?(d=k.outMarker.getX()-k.outMarker.getWidth(),c=b?window.zoomNodes[b-1].outMarker.attrs.x:
"",a.x>d&&(a.x=d),c&&a.x<c&&(a.x=c)):(c=k.inMarker.getX()+k.inMarker.getWidth(),d=b>=window.zoomNodes.length-1?"":window.zoomNodes[b+1].inMarker.attrs.x,a.x<c&&(a.x=c),d&&a.x>d&&(a.x=d));return{x:a.x,y:this.getAbsolutePosition().y}}})).on("dragmove",function(a){l(k,m)});var q=f?-24:24,r=new g.Text({x:q,y:a/2-5,text:"",fontSize:10,fontFamily:"sans-serif",fill:"#000",textAlign:"center"});r.hide();e.label=r;n=new g.Rect({width:10,height:20,fill:b,stroke:b,strokeWidth:1,x:p,y:n});p=new g.Line({points:[.5,
0,.5,a],strokeWidth:1,stroke:b,x:0,y:0});n.on("mouseover",function(a){f&&r.setX(q-r.getWidth());r.show();k.view.segmentLayer.draw()});n.on("mouseout",function(a){r.hide();k.view.segmentLayer.draw()});e.add(r);e.add(p);e.add(n);return e}};w.exports={interpolateHeight:a,drawWaveform:b,waveformDrawFunction:function(d,c){var f=d.intermediateData||d.data,e=a(d.height);b(c,f.min,f.max,0,f.offset_length,e);c.fillStrokeShape(this)},waveformOverviewMarkerDrawFunction:function(a,b,f){b.waveformShape.setPoints([a,
0,a,f.height])},niceTime:function(a,b){var f,e,g,m,l=[];f=Math.floor(a%1*100);e=Math.floor(a);g=Math.floor(e/60);m=Math.floor(g/60);0<m&&l.push(m);l.push(g%60);l.push(e%60);for(e=0;e<l.length;e++)g=l[e],l[e]=10>g?"0"+g:g;l=l.join(":");b||(10>f&&(f="0"+f),l+="."+f);return l},defaultInMarker:function(a){return e(a.height,a.outMarkerColor,!0)},defaultOutMarker:function(a){return e(a.height,a.outMarkerColor,!1)},defaultPointMarker:function(a){return q(a.height,a.pointMarkerColor)},defaultSegmentLabelDraw:function(a){return function(a,
b){return new g.Text({x:12,y:12,text:b.labelText,fontSize:12,fontFamily:"Arial, sans-serif",fill:"#000",textAlign:"center"})}}}},{konva:3}]},{},[15])(15)});